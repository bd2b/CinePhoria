

Install vsftp
sudo apt install vsftpd

sudo nano /etc/vsftpd.conf
avec 
anonymous_enable=NO
local_enable=YES
write_enable=YES
chroot_local_user=YES
user_sub_token=$USER
local_root=/home/$USER/ftp



mkdir -p /home/cinephoria/ftp/files
chown nobody:nogroup /home/cinephoria/ftp
chmod a-w /home/cinephoria/ftp
sudo chown cinephoria:cinephoria /home/cinephoria/ftp/files


Script install_vsftpd.sh
#!/bin/bash

echo "üì¶ Installation de vsftpd..."
sudo apt update
sudo apt install -y vsftpd

echo "‚öôÔ∏è Configuration de vsftpd..."

# Sauvegarde de l'ancien fichier
sudo cp /etc/vsftpd.conf /etc/vsftpd.conf.bak

# R√©√©criture minimale du fichier de conf
sudo bash -c 'cat > /etc/vsftpd.conf' <<EOF
listen=YES
anonymous_enable=NO
local_enable=YES
write_enable=YES
chroot_local_user=YES
user_sub_token=\$USER
local_root=/home/\$USER/ftp

pasv_enable=YES
pasv_min_port=10000
pasv_max_port=10100

allow_writeable_chroot=YES
EOF

echo "üîÅ Red√©marrage du service..."
sudo systemctl restart vsftpd
echo "‚úÖ vsftpd install√© et configur√©."


chmod +x install_vsftpd.sh
./install_vsftpd.sh

script setup_folders.sh
#!/bin/bash

echo "üìÅ Cr√©ation des r√©pertoires d'app et de donn√©es..."

mkdir -p /srv/cinephoria/{app,config,scripts,public,logs,uploads}
mkdir -p /srv/mysql
mkdir -p /srv/mongo

echo "üìÅ Arborescence cr√©√©e sous /srv/"
tree /srv -L 2

chmod +x setup_folders.sh
./setup_folders.sh


fix_permissions.sh
#!/bin/bash

echo "üîê Attribution des permissions sur /srv..."

# App Cinephoria : propri√©t√© √† l'utilisateur applicatif
sudo chown -R cinephoria:cinephoria /srv/cinephoria
sudo chmod -R 755 /srv/cinephoria

# Dossier FTP : r√©serv√© au groupe FTP (lecture publique possible)
sudo chown -R root:ftp /srv/ftp
sudo chmod -R 755 /srv/ftp

# Dossier MySQL : laiss√© √† mysql si service local
if id "mysql" &>/dev/null; then
  echo "‚Üí MySQL user found, assigning /srv/mysql to mysql:mysql"
  sudo chown -R mysql:mysql /srv/mysql
else
  echo "‚Üí MySQL user not found, skipping ownership"
fi
sudo chmod -R 750 /srv/mysql

# Dossier MongoDB : m√™me chose
if id "mongodb" &>/dev/null; then
  echo "‚Üí MongoDB user found, assigning /srv/mongo to mongodb:mongodb"
  sudo chown -R mongodb:mongodb /srv/mongo
else
  echo "‚Üí MongoDB user not found, skipping ownership"
fi
sudo chmod -R 750 /srv/mongo

echo "‚úÖ Permissions appliqu√©es."


create_user.sh
#!/bin/bash

USERNAME="cinephoria"
PASSWORD="ChangeThisPassword123"  # √Ä modifier manuellement apr√®s premi√®re ex√©cution

echo "üë§ Cr√©ation de l'utilisateur $USERNAME..."

# V√©rifie si l'utilisateur existe d√©j√†
if id "$USERNAME" &>/dev/null; then
  echo "‚ö†Ô∏è  L'utilisateur $USERNAME existe d√©j√†. Op√©ration annul√©e."
  exit 1
fi

# Cr√©ation de l'utilisateur avec un home d√©di√©
sudo useradd -m -s /bin/bash "$USERNAME"

# D√©finition du mot de passe
echo "$USERNAME:$PASSWORD" | sudo chpasswd

# Cr√©ation d'un groupe sp√©cifique si besoin (ici m√™me nom que l'utilisateur)
sudo usermod -aG ftp,sudo "$USERNAME"

# Cr√©ation du dossier FTP
sudo mkdir -p /home/$USERNAME/ftp/files
sudo chown nobody:nogroup /home/$USERNAME/ftp
sudo chmod a-w /home/$USERNAME/ftp
sudo chown $USERNAME:$USERNAME /home/$USERNAME/ftp/files

# Cr√©ation des r√©pertoires de service
sudo mkdir -p /srv/cinephoria/{app,config,scripts,public,logs,uploads}
sudo mkdir -p /srv/{mysql,mongo}
sudo chown -R $USERNAME:$USERNAME /srv/cinephoria
sudo chmod -R 755 /srv/cinephoria

echo "‚úÖ Utilisateur $USERNAME cr√©√© avec acc√®s FTP et arborescence app pr√™te."
echo "üîê Pense √† modifier le mot de passe avec : sudo passwd $USERNAME"

Installation de docker
curl -fsSL https://get.docker.com | sh
sudo usermod -aG docker $USER

Deconnexion et reconnextion

Creation de 
/srv/cinephoria/docker-compose.yml

services:
  mysql:
    image: mysql:8.0
    container_name: cinephoria-mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: dsc!@HH234
      MYSQL_DATABASE: cinephoria
      MYSQL_USER: cineadmin
      MYSQL_PASSWORD: studi2025
    ports:
      - "3306:3306"
    volumes:
      - /srv/mysql:/var/lib/mysql
      

cd /srv/cinephoria
docker compose up -d

