"use strict";var o=function(e,r,n,a){function l(d){return d instanceof n?d:new n(function(s){s(d)})}return new(n||(n=Promise))(function(d,s){function g(t){try{m(a.next(t))}catch(v){s(v)}}function w(t){try{m(a.throw(t))}catch(v){s(v)}}function m(t){t.done?d(t.value):l(t.value).then(g,w)}m((a=a.apply(e,r||[])).next())})};import{showCustomAlert as E}from"./Helpers.js";import{userDataController as c}from"./DataControllerUser.js";import{CinephoriaErrorCode as u,CinephoriaError as y}from"./shared-models/Error.js";import{dataController as L}from"./DataController.js";export const baseUrl=`${window.location.protocol}//${window.location.hostname}${window.location.port?":"+window.location.port:""}`;const i=window.location.pathname.split("/").pop();window.location.hostname.toUpperCase()!=="CINEPHORIA.BD2DB.COM"&&(document.title=document.title+" - dev");const p=["visiteur.html","reservation.html","films.html","mesreservations.html"],f={"visiteur.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewFilmsSortiesSemaine.js")).onLoadVisiteur()}),"reservation.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewReservation.js")).onLoadReservation()}),"mesreservations.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewMesReservations.js")).onLoadMesReservations()}),"films.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewFilms.js")).onLoadFilms()}),"manageFilms.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewManageFilms.js")).onLoadManageFilms()}),"manageSalles.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewManageSalles.js")).onLoadManageSalles()}),"manageSeances.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewManageSeances.js")).onLoadManageSeances()}),"manageAvis.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewManageAvis.js")).onLoadManageAvis()}),"manageEmployes.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewManageEmploye.js")).onLoadManageEmployes()}),"dashboard.html":()=>o(void 0,void 0,void 0,function*(){return(yield import("./ViewDashboard.js")).onLoadDashboard()})};let h=!1;export function handleApiError(e){return o(this,void 0,void 0,function*(){if(console.error("\u{1F534} Erreur API d\xE9tect\xE9e :",e),e instanceof y)switch(e.code){case u.TOKEN_EXPIRE:console.warn("\u{1F504} Token expir\xE9, redirection vers visiteur.html");case u.TOKEN_REFRESH_FAIL:console.warn("\u{1F504} Token refresh expir\xE9, redirection vers visiteur.html");case u.AUTH_REQUIRED:if(!h){console.warn("\u{1F504} Token expir\xE9 ou invalide, redirection vers visiteur.html"),h=!0,localStorage.removeItem("jwtAccessToken");const r=window.location.pathname.split("/").pop();r==="visiteur.html"?console.log("Chargement manuel de onLoadVisiteur()"):p.includes(r||"")||window.location.replace("visiteur.html")}break;case u.API_ERROR:console.error("\u274C Erreur API g\xE9n\xE9rale :",e.message),yield E(`Erreur API : ${e.message}`);break;default:console.error("\u2753 Erreur inconnue :",e)}else console.error("\u{1F6A8} Erreur non g\xE9r\xE9e :",e);throw e.message})}console.log("Chargement de Global"),document.removeEventListener("DOMContentLoaded",()=>o(void 0,void 0,void 0,function*(){})),document.addEventListener("DOMContentLoaded",()=>o(void 0,void 0,void 0,function*(){console.log("DOM Chargement de Global");const e=c.ident;e!==void 0&&(console.log("Identification chargee = ",e),yield c.init(),console.log("Compte charge = ",c.compte()));const r=c.profil();if(console.log("Profil charge = xxxx",r),console.log("Chargement dynamique de xxxx",i," "),i&&f[i]){const n=()=>o(void 0,void 0,void 0,function*(){if(console.log("\u{1F550} Ex\xE9cution du rendu dynamique pour",i),yield f[i](),p.includes(i)){const l=document.getElementById("progressIndicator");l&&(l.style.display="block")}});document.readyState==="complete"?(console.log("\u{1F550} Le chargement est d\xE9j\xE0 complet, ex\xE9cution imm\xE9diate de",i),yield n()):window.addEventListener("load",n)}else console.warn("\u26A0\uFE0F Aucune fonction associ\xE9e pour cette page.")})),console.log("Current Page = ",i),i&&p.includes(i)&&(console.log("Initialisation du DataC"),L.init());
