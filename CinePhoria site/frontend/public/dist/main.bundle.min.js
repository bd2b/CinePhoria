"use strict";(()=>{var fo=Object.defineProperty;var P=(n,e)=>()=>(n&&(e=n(n=0)),e);var ge=(n,e)=>{for(var t in e)fo(n,t,{get:e[t],enumerable:!0})};function Ke(n){var e;let i=`; ${document.cookie}`.split(`; ${n}=`);if(i.length===2)return(e=i.pop())===null||e===void 0?void 0:e.split(";").shift()}function gt(n,e,t){let i=new Date;i.setTime(i.getTime()+t*24*60*60*1e3),document.cookie=`${n}=${e}; path=/; expires=${i.toUTCString()}`}function In(n){document.cookie=`${n}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`}function An(n){let e=n.getMonth();return["JAN","FEV","MAR","AVR","MAI","JUN","JUI","AOU","SEP","OCT","NOV","DEC"][e]||"??"}function Pe(n){return new Date(n.getFullYear(),n.getMonth(),n.getDate(),12,0,0,0)}function we(n,e){let t=Pe(n);return t.setDate(t.getDate()+e),Pe(t)}function Mn(n){let e=Pe(n),i=(2-e.getDay()+7)%7;return e.setDate(e.getDate()+i),Pe(e)}function Bn(n=new Date){let e=new Date(n),t=e.getDay(),i=t>=3?t-3:7-(3-t);return e.setDate(e.getDate()-i),e}function Fn(n=new Date){let e=new Date(n),t=e.getDay(),i=t<=3?3-t:7-t+3;return e.setDate(e.getDate()+i),e}function We(n){let e=n.getDate()<10?"0"+n.getDate():n.getDate().toString(),t=n.getMonth()+1<10?"0"+(n.getMonth()+1):(n.getMonth()+1).toString();return`${e}/${t}`}function kn(n){let e=n.slice(0,10),[t,i,o]=e.split("-").map(Number);return new Date(t,i-1,o)}function U(n){let e=n.getFullYear(),t=n.getMonth()+1,i=n.getDate(),o=t<10?"0"+t:String(t),s=i<10?"0"+i:String(i);return`${e}-${o}-${s}`}function Tn(n,e,t){let i=n.getTime(),o=e.getTime();return Math.abs(i-o)/(1e3*60*60)>t}function se(n){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(n.trim())}function K(n){return/^[^\s@]+@[^\s@]+\.[a-zA-Z]{2,}$/.test(n)}function z(n){let e=`${A}/api/films/affichefile/`,t=`${A}/assets/static/`,i=n.slice(0,36);return(se(i)?e:t)+n}function Re(n){let e=n.querySelectorAll("thead tr th"),t=n.querySelector("tbody tr");if(!e.length||!t)return;let i=t.querySelectorAll("td");if(e.length!==i.length){console.error("Nombre de colonnes de l'entete et du tableau diff\xE9rent");return}else console.log("Calcul de la largeur des colonnes");i.forEach((o,s)=>{let l=o.getBoundingClientRect().width;e[s].style.width=`${l}px`})}function Un(n){let t=/[A-Z]/.test(n),i=/[a-z]/.test(n),o=/\d/.test(n),s=/[!@#$%^&*]/.test(n);return n.length>=8&&t&&i&&o&&s}function _t(n,e){if(typeof n!="object"||n===null)return!1;for(let t in e){let i=e[t],o=n[t];if(o==null){if(!i.startsWith("nullable"))return console.log(`\u26D4 ${t} est null/undefined mais ${i} requis`),!1;continue}let s=i.replace("nullable-","");if(typeof o!==s)return console.log(`\u26D4 ${t} a la valeur ${o}, mais type ${s} attendu`),!1}return!0}function Jt(n){let e=_t(n,{id:"string",titleFilm:"string",filmPitch:"string",genreArray:"string",duration:"string",linkBO:"string",dateSortieCinePhoria:"string",categorySeeing:"string",note:"number",isCoupDeCoeur:"number",isActiveForNewSeances:"number",filmDescription:"string",filmAuthor:"string",filmDistribution:"string",imageFilm128:"string",imageFilm1024:"string"});return e||console.error("Anomalie sanitize Film"),e}function Ht(n){let e=_t(n,{seanceId:"string",filmId:"string",salleId:"string",dateJour:"string",hourBeginHHSMM:"string",hourEndHHSMM:"string",qualite:"string",bo:"string",numFreeSeats:"number",numFreePMR:"number",alertAvailibility:"nullable-string",nameSalle:"string",nameCinema:"string",capacity:"number",numPMR:"number",rMax:"number",fMax:"number",seatsAbsents:"string",adresse:"string",ville:"string",postalcode:"string",emailCinema:"string",telCinema:"string"});return e||console.error("Anomalie sanitize Seance"),e}function jt(n){let e=_t(n,{nameCinema:"string",adresse:"string",ville:"string",postalcode:"string",emailCinema:"string",telCinema:"string",ligne1:"string",ligne2:"string"});return e||console.error("Anomalie sanitize Cinema"),e}function Vt(n){let e=_t(n,{id:"string",qualite:"string",nameTarif:"string",price:"number"});return e||console.error("Anomalie sanitize TarifQualite"),e}function $(n){return vo(this,void 0,void 0,function*(){return new Promise(e=>{let t=document.createElement("div");t.className="custom-alert-overlay";let i=document.createElement("div");i.className="custom-alert-modal",i.innerHTML=`<p>${n}</p>`;let o=document.createElement("button");o.textContent="OK",o.addEventListener("click",()=>{t.remove(),e()}),i.appendChild(o),t.appendChild(i),document.body.appendChild(t)})})}var vo,Me,yt,N=P(()=>{"use strict";Ze();vo=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Me=["Paris","Bordeaux","Nantes","Lille","Toulouse","Charleroi","Li\xE8ge"];yt=new Intl.DateTimeFormat("fr-FR",{timeZone:"Europe/Paris",day:"2-digit",month:"2-digit"})});var Ne,Yt=P(()=>{"use strict";Ne=class{constructor(e){Object.assign(this,e)}}});var I,Xe,Ct,ye=P(()=>{"use strict";(function(n){n.PendingChoiceSeance="PendingChoiceSeance",n.PendingChoiceSeats="PendingChoiceSeats",n.ReserveCompteToConfirm="ReserveCompteToConfirm",n.ReserveMailToConfirm="ReserveMailToConfirm",n.ReserveToConfirm="ReserveToConfirm",n.ReserveConfirmed="ReserveConfirmed",n.DoneUnevaluated="DoneUnevaluated",n.DoneEvaluated="DoneEvaluated",n.ReserveCanceled="ReserveCanceled",n.ReserveDeleted="ReserveDeleted"})(I||(I={}));Xe=class{constructor(e){Object.assign(this,e)}},Ct=class{constructor(e){Object.assign(this,e)}}});var re,Ce,zt=P(()=>{"use strict";(function(n){n.TOKEN_EXPIRE="TOKEN_EXPIRE",n.TOKEN_REFRESH_FAIL="TOKEN_REFRESH_FAIL",n.AUTH_REQUIRED="AUTH_REQUIRED",n.API_ERROR="API_ERROR",n.UNKNOWN="UNKNOWN"})(re||(re={}));Ce=class n extends Error{constructor(e,t){super(t),this.code=e,Object.setPrototypeOf(this,n.prototype)}}});function F(n,e,t){return M(this,arguments,void 0,function*(i,o,s,l=!0){try{let a=localStorage.getItem("jwtAccessToken");if(l&&!a)throw console.warn("\u26D4 Aucun token disponible, redirection imm\xE9diate."),new Ce(re.AUTH_REQUIRED,"Authentification requise et pas de token.");let c={},d;s instanceof FormData?d=s:(d=s?JSON.stringify(s):void 0,c["Content-Type"]="application/json",c["Accept-Encoding"]="gzip, deflate, br"),l&&(c.Authorization=`Bearer ${a}`);let r=yield fetch(i,{method:o,headers:c,body:d,credentials:l?"include":"same-origin"});if(l&&(r.status===401||r.status===403)){console.warn("\u{1F504} Token expir\xE9, tentative de refresh...");try{if(yield ho(),a=localStorage.getItem("jwtAccessToken"),!a)throw console.error("\u{1F534} Refresh \xE9chou\xE9, suppression du token local."),new Ce(re.TOKEN_REFRESH_FAIL,"Echec du refresh, token expir\xE9 ou invalid\xE9");r=yield fetch(i,{method:o,headers:Object.assign(Object.assign({},c),{Authorization:`Bearer ${a}`}),body:d,credentials:"include"})}catch(u){throw console.error("\u{1F534} Echec du refreshToken :",u),u}}if(!r.ok){let u=yield r.json();throw new Ce(re.API_ERROR,u.message||"Erreur inconnue")}return r.json()}catch(a){return ci(a)}})}function ho(){return M(this,void 0,void 0,function*(){try{console.log("\u{1F504} Tentative de refresh du token...");let n=yield fetch(`${A}/api/refresh`,{method:"POST",credentials:"include"});if(!n.ok)throw console.error("\u{1F534} Echec du refresh, suppression du token local"),localStorage.removeItem("jwtAccessToken"),new Ce(re.TOKEN_REFRESH_FAIL,"Echec du refresh, token expir\xE9 ou invalid\xE9");let e=yield n.json(),{accessToken:t}=e;localStorage.setItem("jwtAccessToken",t),console.log("Nouveau accessToken obtenu via /api/refresh")}catch(n){throw console.error("\u{1F534} Erreur dans refreshAccessToken :",n),localStorage.removeItem("jwtAccessToken"),n}})}function Gt(n,e){return M(this,void 0,void 0,function*(){let t={compte:n,password:e},i=yield fetch(`${A}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!i.ok){let l=yield i.json();throw new Error(l.message||"Erreur inconnue")}let s=(yield i.json()).accessToken;localStorage.setItem("jwtAccessToken",s),console.log("Login OK, accessToken stock\xE9, refreshToken dans cookie HttpOnly")})}function Pn(n,e,t,i,o){return M(this,void 0,void 0,function*(){let s={email:n,seanceId:e,tarifSeats:t,pmrSeats:i,seatsReserved:o},l=`${A}/api/reservation`,a=yield F(l,"POST",s,!1),c="";if(se(a.reservationId)||(c+="ReservationID invalide."),se(a.utilisateurId)||(c+="UtilisateurId invalide."),a.statut==="NA"&&(c="Une erreur s'est produite c\xF4t\xE9 serveur (NA)."),a.utilisateurId.startsWith("Erreur")&&(c+=" Erreur utilisateur : "+a.utilisateurId),a.reservationId.startsWith("Erreur")&&(c+=" Erreur reservation : "+a.reservationId),c!=="")throw new Error(c);return a})}function Rn(n,e,t){return M(this,void 0,void 0,function*(){let i={id:n,password:e,displayName:t},o=`${A}/api/utilisateur/confirmUtilisateur`,s=yield F(o,"POST",i,!1);return console.log("Message retour",s),s})}function Nn(n,e){return M(this,void 0,void 0,function*(){let t={email:n,codeConfirm:e},i=`${A}/api/utilisateur/confirmCompte`,o=yield F(i,"POST",t,!1);return console.log("Message retour",o),o})}function $n(n,e,t){return M(this,void 0,void 0,function*(){return F(`${A}/api/reservation/confirm`,"POST",{reservationId:n,utilisateurId:e,seanceId:t})})}function Et(n,e){return M(this,void 0,void 0,function*(){return F(`${A}/api/reservation/setstate`,"POST",{reservationId:n,stateReservation:e})})}function qn(n,e,t,i){return M(this,void 0,void 0,function*(){let o=i?"true":"false";return F(`${A}/api/reservation/setevaluation`,"POST",{reservationId:n,note:e,evaluation:t,isEvaluationMustBeReview:o})})}function bt(n){return M(this,void 0,void 0,function*(){let e={reservationId:n},t=`${A}/api/reservation/cancel`,i=yield F(t,"POST",e,!1);return console.log("Message retour",i),i})}function On(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/utilisateur/${n}`,t=yield F(e,"GET",null);if(!Array.isArray(t))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");return t.map(i=>new Ne(i))})}function Jn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/reservation/id/${n}`,t=yield F(e,"GET",void 0,!1);if(!Array.isArray(t))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");let i=t.map(o=>new Xe(o));return console.log("reservations = ",i),i})}function Hn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/seances/seats/${n}`,t=yield F(e,"GET",void 0,!1);return console.log("Liste des sieges = ",t),t})}function Qt(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/seances/seances?ids=${n}`,t=yield F(e,"GET",void 0,!1);return console.log("Liste des s\xE9ances = ",t),t})}function jn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/reservation/seats/id/${n}`,t=yield F(e,"GET",void 0,!1);if(!Array.isArray(t))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");let i=t.map(o=>new Ct(o));return console.log("places = ",i),i})}function Vn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/reservation/${n}`,t=yield F(e,"GET",null);if(!Array.isArray(t))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");return t.map(i=>new Xe(i))})}function Yn(n){return M(this,void 0,void 0,function*(){let e={mailInput:n};console.log(e);let t=`${A}/api/mail/sendmailcontact`,i=yield F(t,"POST",e,!1);return console.log("Message retour",i),i})}function zn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/reservation/qrcodeimage/${n}`,t=yield F(e,"GET",void 0,!0),i=new Uint8Array(t.qrCodeFile),o=btoa(String.fromCharCode(...i)),s=document.createElement("img");return s.src=`data:${t.contentType};base64,${o}`,s.alt="QR Code",document.body.appendChild(s),s})}function Kt(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/utilisateur/askresetpwd`,t={email:n};console.log(t);let i=yield F(e,"POST",t,!1);return console.log("Message retour",i),i})}function Gn(n,e,t){return M(this,void 0,void 0,function*(){let i=`${A}/api/utilisateur/resetpwd`,o={email:n,codeConfirm:e,newPassword:t};console.log(o);let s=yield F(i,"POST",o,!1);return console.log("Message retour",s),s})}function Qn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/films`;return yield F(e,"POST",n,!0)})}function Kn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/films/${n}`;return yield F(e,"GET",void 0,!0)})}function Wn(n,e){return M(this,void 0,void 0,function*(){let t=`${A}/api/films/${n}`;return yield F(t,"PUT",e,!0)})}function et(){return M(this,void 0,void 0,function*(){let n=`${A}/api/films`;return yield F(n,"GET",void 0,!1)})}function tt(n,e,t,i){return M(this,void 0,void 0,function*(){let o=new FormData;return o.append("filmId",n),o.append("imageFile",e),o.append("resolution",t.toString()),o.append("contentType",i),F(`${A}/api/films/affiche`,"POST",o,!1)})}function Wt(n,e,t,i){return M(this,void 0,void 0,function*(){let o=new FormData;return e&&o.append("imageFile",e),t&&o.append("resolution",t.toString()),i&&o.append("contentType",i),F(`${A}/api/films/affiche/${n}`,"PUT",o,!1)})}function St(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/salles`;return yield F(e,"POST",n,!0)})}function Zn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/salles/cinema/${n}`;return yield F(e,"GET",void 0,!0)})}function xt(n,e){return M(this,void 0,void 0,function*(){let t=`${A}/api/salles/${n}`;return yield F(t,"PUT",e,!0)})}function Xn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/salles/${n}`;return yield F(e,"DELETE",void 0,!0)})}function Zt(){return M(this,void 0,void 0,function*(){let n=`${A}/api/salles`;return yield F(n,"GET",void 0,!0)})}function ei(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/seancesseules`;return yield F(e,"POST",n,!0)})}function ti(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/seancesseules/${n}`;return yield F(e,"GET",void 0,!0)})}function ni(n,e){return M(this,void 0,void 0,function*(){let t=`${A}/api/seancesseules/${n}`;return yield F(t,"PUT",e,!0)})}function ii(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/seancesseules/${n}`;return yield F(e,"DELETE",void 0,!0)})}function Xt(n){return M(this,void 0,void 0,function*(){let e=n.map(o=>`"${o}"`).join(","),t=`${A}/api/seances/display/filter?cinemasList=${e}`;return yield F(t,"GET",void 0,!1)})}function en(n){return M(this,void 0,void 0,function*(){let e=n.map(o=>`"${o}"`).join(","),t=`${A}/api/reservation/cinema/filter?cinemasList=${e}`;return yield F(t,"GET",void 0,!0)})}function oi(n,e){return M(this,void 0,void 0,function*(){console.log(JSON.stringify(e));let t=`${A}/api/reservation/avis/${n}`;return yield F(t,"PUT",e,!0)})}function si(){return M(this,void 0,void 0,function*(){let n=`${A}/api/utilisateur/getemployes`;return yield F(n,"GET",void 0,!0)})}function tn(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/utilisateur/getemploye/${n}`;return yield F(e,"GET",void 0,!0)})}function ri(n){return M(this,arguments,void 0,function*(e,t=""){var i;let o=`${A}/api/utilisateur/createEmploye`,s=new FormData;return s.append("email",e.email),s.append("password",t),e.isAdministrateur&&e.isAdministrateur===1?s.append("isAdministrateur","true"):s.append("isAdministrateur","false"),s.append("firstnameEmploye",e.firstnameEmploye||""),s.append("lastnameEmploye",e.lastnameEmploye||""),s.append("matricule",((i=e.matricule)===null||i===void 0?void 0:i.toString(10))||""),s.append("listCinemas",e.listCinemas||""),yield F(o,"POST",s,!0)})}function li(n,e){return M(this,void 0,void 0,function*(){var t;let i=`${A}/api/utilisateur/updateemploye`,o=new FormData;return o.append("email",n.email),o.append("password",e),n.isAdministrateur&&n.isAdministrateur===1?o.append("isAdministrateur","true"):o.append("isAdministrateur","false"),o.append("firstnameEmploye",n.firstnameEmploye||""),o.append("lastnameEmploye",n.lastnameEmploye||""),o.append("matricule",((t=n.matricule)===null||t===void 0?void 0:t.toString(10))||""),o.append("listCinemas",n.listCinemas||""),yield F(i,"PUT",o,!0)})}function ai(n){return M(this,void 0,void 0,function*(){let e=`${A}/api/utilisateur/deleteemploye/${n}`;return yield F(e,"DELETE",void 0,!0)})}function di(){return M(this,void 0,void 0,function*(){let n=`${A}/api/reservation/getreservationstats`;return yield F(n,"GET",void 0,!0)})}function nt(){return M(this,void 0,void 0,function*(){let n=`${A}/api/login/version`;return yield F(n,"GET",void 0,!1)})}var M,ie=P(()=>{"use strict";N();Yt();ye();Ze();zt();M=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});var go,W,nn,k,Ee=P(()=>{"use strict";ie();N();go=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})};(function(n){n.Utilisateur="mesreservations.html",n.Administrateur="manageEmployes.html",n.Employee="manageAvis.html",n.Visiteur="visiteur.html"})(W||(W={}));nn=class{get ident(){let e=Ke("ident");return this._ident=e,Ke("ident")}set ident(e){e!==""?(console.log("Mise a jour ident = "+e),gt("ident",e,1),this._ident=e):(console.log("logout de ",this._ident),this._ident=void 0)}get comptes(){return this._comptes||[]}compte(){if(this._comptes)return this._comptes[0]}profil(){var e,t,i;return this.compte()===void 0?W.Visiteur:!((e=this.compte())===null||e===void 0)&&e.matricule?!((t=this.compte())===null||t===void 0)&&t.isAdministrateur&&((i=this.compte())===null||i===void 0?void 0:i.isAdministrateur)===1?W.Administrateur:W.Employee:W.Utilisateur}invalidate(){In("ident"),this._ident=void 0,this._comptes=void 0}init(){return go(this,void 0,void 0,function*(){try{if(this._ident!==void 0){let e=yield On(this._ident);e&&(console.log("Compte charg\xE9 pour ",this._ident),this._comptes=e)}}catch{this._ident=void 0}})}},k=new nn});var ue,it,ui=P(()=>{"use strict";ue=class n{constructor(e){Object.assign(this,e)}get film(){return n.allFilms.find(e=>e.id===this.filmId)}get titleFilm(){var e;return(e=this.film)===null||e===void 0?void 0:e.titleFilm}get filmPitch(){var e;return(e=this.film)===null||e===void 0?void 0:e.filmPitch}get genreArray(){var e;return(e=this.film)===null||e===void 0?void 0:e.genreArray}get duration(){var e;return(e=this.film)===null||e===void 0?void 0:e.duration}get linkBO(){var e;return(e=this.film)===null||e===void 0?void 0:e.linkBO}get dateSortieCinePhoria(){var e;return(e=this.film)===null||e===void 0?void 0:e.dateSortieCinePhoria}get categorySeeing(){var e;return(e=this.film)===null||e===void 0?void 0:e.categorySeeing}get note(){var e,t;return(t=(e=this.film)===null||e===void 0?void 0:e.note)===null||t===void 0?void 0:t.toString(10)}get isCoupDeCoeur(){var e;return(e=this.film)===null||e===void 0?void 0:e.isCoupDeCoeur}get isActiveForNewSeances(){var e;return(e=this.film)===null||e===void 0?void 0:e.isActiveForNewSeances}get filmDescription(){var e;return(e=this.film)===null||e===void 0?void 0:e.filmDescription}get filmAuthor(){var e;return(e=this.film)===null||e===void 0?void 0:e.filmAuthor}get filmDistribution(){var e;return(e=this.film)===null||e===void 0?void 0:e.filmDistribution}get imageFilm128(){var e;return(e=this.film)===null||e===void 0?void 0:e.imageFilm128}get imageFilm1024(){var e;return(e=this.film)===null||e===void 0?void 0:e.imageFilm1024}};ue.allFilms=[];it=class{constructor(e){Object.assign(this,e)}}});var $e,on=P(()=>{"use strict";$e=class{constructor(e){Object.assign(this,e)}}});var ot,mi=P(()=>{"use strict";ot=class{constructor(e){Object.assign(this,e)}}});var Y,sn,De,me,m,pe=P(()=>{"use strict";ui();on();ye();N();N();mi();ie();Ze();Y=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},De=new Promise(n=>{sn=n}),me=class n{constructor(){this.version={idInt:0,MAJEURE:0,MINEURE:0,BUILD:0,dateMaj:new Date("01/01/1980")},this._reservationState=I.PendingChoiceSeance,this._allSeances=[],this._Cinemas=[],this._tarifQualite=[],this._filterGenre="all"}get seances(){return this.filterNameCinema==="all"?this._allSeances:this._allSeances.filter(e=>e.nameCinema===this._filterNameCinema)}get films(){let e=new Date;return e.setDate(e.getDate()+90),this.extractFilmsFromSeances(new Date,e)}get filmsSortiesRecentes(){let e=Bn(),t=this.films.filter(l=>{if(!l.dateSortieCinePhoria)return!1;let a=new Date(l.dateSortieCinePhoria);return U(a)===U(e)}),i=t.length>0?t:this.films,o=t.length>0?"Nouveaute de la semaine":"Notre catalogue";return{films:i.filter(l=>l.dateSortieCinePhoria).sort((l,a)=>new Date(a.dateSortieCinePhoria).getTime()-new Date(l.dateSortieCinePhoria).getTime()),message:o}}get genreSet(){let e=new Set;return m.films.forEach(t=>{t.genreArray&&t.genreArray.split(",").forEach(i=>e.add(i.trim()))}),e}get filmsGenre(){let e=this.films;return this._filterGenre!=="all"&&(e=this.films.filter(t=>t.genreArray?t.genreArray.split(",").map(o=>o.trim().toLowerCase()).includes(this._filterGenre.toLowerCase()):!1)),e}get cinemas(){return this._Cinemas}get reservationState(){return this._reservationState}set reservationState(e){console.log("Mise a jour statut reservation = "+e),this._reservationState=e}get allSeances(){return this._allSeances}get seancesFutures(){return this.seances.filter(e=>new Date(e.dateJour||"")>=new Date)}get allTarifQualite(){return this._tarifQualite}get filterNameCinema(){return this._filterNameCinema||"all"}set filterNameCinema(e){if(e.trim()==="")throw new Error("Le nom du cin\xE9ma ne peut pas \xEAtre vide.");e.trim()!=="all"?(this._selectedNameCinema=e.trim(),console.log("DataC: Cinema selected = ",e)):console.log("DataC: Cinema selected = ",this._selectedNameCinema),console.log("DataC: Cinema filter = ",e),this._filterNameCinema=e,this.sauverEtatGlobal()}get selectedNameCinema(){return this._selectedNameCinema||"Paris"}get filterGenre(){return this._filterGenre}set filterGenre(e){this._filterGenre=e}get selectedFilmUUID(){return this._selectedFilmUUID||void 0}set selectedFilmUUID(e){if(!se(e))throw new Error("L'id du film n'est pas conforme.");console.log("Set selectedFilmUUID"),this._selectedFilmUUID=e}get selectedFilm(){return this._selectedFilmUUID?this.filmUUID(this._selectedFilmUUID):(console.error("selectedFilm : Film non trouv\xE9, premier film pris"),this.films[0])}get selectedSeanceDate(){return this._selectedSeanceDate||void 0}set selectedSeanceDate(e){this._selectedSeanceDate=e}get selectedSeanceUUID(){return this._selectedSeanceUUID||void 0}set selectedSeanceUUID(e){this._selectedSeanceUUID=e}get selectedUtilisateurUUID(){return this._selectedUtilisateurUUID||void 0}set selectedUtilisateurUUID(e){this._selectedUtilisateurUUID=e}get selectedUtilisateurMail(){return this._selectedUtilisateurMail||void 0}set selectedUtilisateurMail(e){this._selectedUtilisateurMail=e}get selectedUtilisateurDisplayName(){return this._selectedUtilisateurDisplayName||void 0}set selectedUtilisateurDisplayName(e){this._selectedUtilisateurDisplayName=e}get selectedReservationUUID(){return this._selectedReservationUUID||void 0}set selectedReservationUUID(e){this._selectedReservationUUID=e,e===void 0&&(this._selectedReservationCinema=void 0)}get selectedListSeats(){return this._selectedListSeats||void 0}set selectedListSeats(e){this._selectedListSeats=e,e===void 0&&(this._selectedListSeats=void 0)}get selectedReservationCinema(){return this._selectedReservationCinema||void 0}chargerDepuisAPI(){return Y(this,void 0,void 0,function*(){console.log("DataC: ChargerDepuisAPI");try{ue.allFilms=(yield et()).filter(Jt);let t=yield(yield fetch(`${A}/api/seances/filter?cinemasList="all"`)).json();if(!Array.isArray(t))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");this._allSeances=t.filter(Ht).map(a=>new ue(a)),console.log(`Pour l'ensembles des cinemas, chargement depuis l'API : ${this.seances.length} s\xE9ances, ${this.films.length} films`);let o=yield(yield fetch(`${A}/api/seances/tarif`)).json();if(!Array.isArray(o))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");this._tarifQualite=o.filter(Vt).map(a=>new it(a)),console.log(`Pour l'ensemble des tarifs : chargement depuis l'API : ${this._tarifQualite.length} tarifs`);let l=yield(yield fetch(`${A}/api/cinemas`)).json();if(!Array.isArray(l))throw new Error("La r\xE9ponse de l\u2019API n\u2019est pas un tableau.");this._Cinemas=l.filter(jt).map(a=>new ot(a)),console.log(`Pour l'ensemble des cinemas, chargement depuis l'API : ${this._Cinemas.length} cinemas`),gt(n.nomCookieDateAccess,new Date().toISOString(),1)}catch(e){console.error("Erreur lors du chargement des donn\xE9es de s\xE9ances : ",e)}finally{}})}extractFilmsFromSeances(e=new Date,t=new Date){let i=new Set(this.seances.filter(o=>{let s=o.dateJour;if(!s)return!1;let l=new Date(s);return U(l)>=U(e)&&U(l)<=U(t)}).map(o=>o.filmId).filter(o=>!!o));return ue.allFilms.filter(o=>o.id&&i.has(o.id))}premierJour(e){return new Date(this.seancesFilm(e)[0].dateJour||"")}seancesFilmJour(e,t=new Date){return this.seances.filter(i=>i.filmId===e&&U(new Date(i.dateJour||""))===U(t))}seancesFilmDureeJour(e,t=new Date,i){return this.seances.filter(o=>o.filmId===e&&U(new Date(o.dateJour||""))>=U(t)&&U(new Date(o.dateJour||""))<U(we(t,i)))}seancesJour(e=new Date){return this.seances.filter(t=>U(new Date(t.dateJour||""))===U(e))}seancesFilm(e){return this.seances.filter(t=>t.filmId===e).sort((t,i)=>new Date(t.dateJour||"").getTime()-new Date(i.dateJour||"").getTime())}filmsJour(e=new Date){return this.extractFilmsFromSeances(e,e)}filmUUID(e){let t=this.films.find(i=>i.id==e);return t||(console.error("filmUUID : Film non trouv\xE9, premier film pris"),this.films[0])}seanceSelected(){return this.seances.filter(e=>e.seanceId===this._selectedSeanceUUID)[0]}seanceById(e){return this._allSeances.filter(t=>t.seanceId===e)[0]}sauverEtatGlobal(){return Y(this,void 0,void 0,function*(){var e;let t={version:this.version,reservationState:this._reservationState,filterNameCinema:this._filterNameCinema,selectedNameCinema:this._selectedNameCinema,selectedFilmUUID:this._selectedFilmUUID,selectedSeanceDate:((e=this._selectedSeanceDate)===null||e===void 0?void 0:e.toISOString())||null,selectedSeanceUUID:this._selectedSeanceUUID,selectedUtilisateurUUID:this._selectedUtilisateurUUID,selectedUtilisateurMail:this._selectedUtilisateurMail,selectedUtilisateurDisplayName:this._selectedUtilisateurDisplayName,selectedReservationUUID:this._selectedReservationUUID,selectedListSeats:this._selectedListSeats,selectedReservationCinema:this._selectedReservationCinema},i=JSON.stringify(t);console.log(`DataC: Taille du snapshotGlobal = ${i.length} caract\xE8res`),localStorage.setItem(n.KEY_GLOBAL,i)})}sauverTarifs(){return Y(this,void 0,void 0,function*(){if(!this._tarifQualite)return;let e=this._tarifQualite,t=JSON.stringify(e);console.log(`DataC: Sauvegarde des tarifs => taille = ${t.length}`),localStorage.setItem(n.KEY_TARIFS,t)})}sauverCinemas(){return Y(this,void 0,void 0,function*(){if(!this._Cinemas)return;let e=this._Cinemas,t=JSON.stringify(e);console.log(`DataC: Sauvegarde des Cinemas => taille = ${t.length}`),localStorage.setItem(n.KEY_CINEMAS,t)})}sauverFilms(){return Y(this,void 0,void 0,function*(){if(!ue.allFilms)return;let e=ue.allFilms,t=JSON.stringify(e);console.log(`DataC: Sauvegarde des Films => taille = ${t.length}`),localStorage.setItem(n.KEY_FILMS,t)})}sauverSeancesParCinema(e){return Y(this,void 0,void 0,function*(){if(!this._allSeances)return;let t=new Map;if(this._allSeances.forEach(i=>{var o,s;let l=((o=i.nameCinema)===null||o===void 0?void 0:o.trim())||"unknown";t.has(l)||t.set(l,[]),(s=t.get(l))===null||s===void 0||s.push(i)}),e){let i=t.get(e);if(i){let o=JSON.stringify(i),s=`${n.KEY_SEANCES}_${e}`;console.log(`DataC: Sauvegarde s\xE9ances pour '${e}' => taille ${o.length} chars`),localStorage.setItem(s,o)}else console.warn(`Aucune s\xE9ance trouv\xE9e pour le cin\xE9ma '${e}'.`)}else t.forEach((i,o)=>{let s=JSON.stringify(i),l=`${n.KEY_SEANCES}_${o}`;console.log(`DataC: Sauvegarde s\xE9ances pour '${o}' => taille ${s.length} chars`),localStorage.setItem(l,s)})})}sauverComplet(){return Y(this,void 0,void 0,function*(){yield this.sauverEtatGlobal(),yield this.sauverTarifs(),yield this.sauverCinemas(),yield this.sauverFilms(),yield this.sauverSeancesParCinema()})}chargerEtatGlobal(){return Y(this,void 0,void 0,function*(){let e=localStorage.getItem(n.KEY_GLOBAL);if(!e){console.warn("DataC: Aucune donn\xE9e globale trouv\xE9e");return}try{let t=JSON.parse(e);this.version=t.version||{majeure:0,mineure:0,build:0},this._reservationState=t.reservationState||I.PendingChoiceSeance,this._filterNameCinema=t.filterNameCinema||void 0,this._selectedNameCinema=t.selectedNameCinema||void 0,this._selectedFilmUUID=t.selectedFilmUUID||void 0,this._selectedSeanceUUID=t.selectedSeanceUUID||void 0,this._selectedUtilisateurUUID=t.selectedUtilisateurUUID||void 0,this._selectedUtilisateurMail=t.selectedUtilisateurMail||void 0,this._selectedUtilisateurDisplayName=t.selectedUtilisateurDisplayName||void 0,this._selectedReservationUUID=t.selectedReservationUUID||void 0,this._selectedListSeats=t.selectedListSeats||void 0,this._selectedReservationCinema=t.selectedReservationCinema||void 0,t.selectedSeanceDate&&(this._selectedSeanceDate=new Date(t.selectedSeanceDate))}catch(t){console.error("DataC: Erreur parsing \xE9tat global",t)}})}chargerTarifs(){return Y(this,void 0,void 0,function*(){let e=localStorage.getItem(n.KEY_TARIFS);if(e)try{let t=JSON.parse(e);Array.isArray(t)&&(console.log("arr",t),this._tarifQualite=t.filter(Vt).map(i=>new it(i)))}catch(t){console.error("DataC: Erreur parsing tarifs",t)}})}chargerCinemas(){return Y(this,void 0,void 0,function*(){let e=localStorage.getItem(n.KEY_CINEMAS);if(e)try{let t=JSON.parse(e);Array.isArray(t)&&(this._Cinemas=t.filter(jt).map(i=>new ot(i)))}catch(t){console.error("DataC: Erreur parsing cinemas",t)}})}chargerFilms(){return Y(this,void 0,void 0,function*(){let e=localStorage.getItem(n.KEY_FILMS);if(e)try{let t=JSON.parse(e);Array.isArray(t)&&(ue.allFilms=t.filter(Jt).map(i=>new $e(i)))}catch(t){console.error("DataC: Erreur parsing films",t)}})}chargerSeancesPourCinema(e){return Y(this,void 0,void 0,function*(){let t=`${n.KEY_SEANCES}_${e}`,i=localStorage.getItem(t);if(!i)return[];try{let o=JSON.parse(i);if(Array.isArray(o))return o.filter(Ht).map(s=>new ue(s))}catch(o){console.error("DataC: Erreur parsing seances pour",e,o)}return[]})}chargerSeancesTousCinemas(){return Y(this,void 0,void 0,function*(){var e;if(!this._Cinemas||this._Cinemas.length===0){console.warn("DataC: Aucun cin\xE9ma n\u2019est charg\xE9, impossible de charger les s\xE9ances tous cin\xE9mas.");return}this._allSeances=[];for(let t of this._Cinemas){let i=((e=t.nameCinema)===null||e===void 0?void 0:e.trim())||"unknown",o=yield this.chargerSeancesPourCinema(i);this._allSeances.push(...o)}console.log(`DataC: Toutes les s\xE9ances de ${this._Cinemas.length} cin\xE9mas charg\xE9es. Nombre total de s\xE9ances : ${this._allSeances.length}.`)})}chargerComplet(){return Y(this,void 0,void 0,function*(){console.log("DataC: ChargerComplet multi storage"),yield this.chargerEtatGlobal(),yield this.chargerTarifs(),yield this.chargerCinemas(),yield this.chargerFilms(),yield this.chargerSeancesTousCinemas()})}init(){return Y(this,void 0,void 0,function*(){console.log("DataC: Init"),yield this.chargerComplet();try{let i=yield nt();console.log("Version du serveur = ",JSON.stringify(i)),console.log("Version du cache = ",JSON.stringify(this.version));let o=this.version.dateMaj&&i.dateMaj&&this.version.dateMaj<i.dateMaj,s=this.version.MAJEURE&&i.MAJEURE&&this.version.MAJEURE!==i.MAJEURE;if(o||s){console.log(`DataC: nouvelle version ${o?"serveur":"majeur"} - rechargement depuis l\u2019API`),yield this.chargerDepuisAPI(),sn(),this.version=i,yield this.sauverComplet();return}else console.log("Pas de mise \xE0 jour de cache")}catch(i){console.error("Impossible de versifier la mise \xE0 jour su site = ",i)}let e=!0,t=Ke(n.nomCookieDateAccess);t?Tn(new Date,new Date(t),n.validiteCache)?console.log("DataC: cookie validite expir\xE9"):(e=!1,console.log("DataC: cookie valide")):console.log("DataC: cookie validite absent"),!this._allSeances.length||e?(console.log("[init] Cache inexistant/vide ou expir\xE9 -> rechargement depuis l\u2019API"),yield this.chargerDepuisAPI(),yield this.sauverComplet()):console.log("[init] Donn\xE9es restaur\xE9es depuis localStorage"),sn()})}getSeanceFromDB(e){return Y(this,void 0,void 0,function*(){try{return yield Qt(e)}catch(t){console.error("Erreur dans la r\xE9cup\xE9ration de seances : "+t)}return[]})}updateSeances(e){return Y(this,void 0,void 0,function*(){console.log("Update s\xE9ances UUID =",e);try{let t=yield Qt(e),i=new Map;t.forEach(o=>{var s;let l=this._allSeances.findIndex(c=>c.seanceId===o.seanceId);l!==-1?this._allSeances[l]=o:console.error("S\xE9ance non trouv\xE9e : ",o.seanceId);let a=o.nameCinema||"unknown";i.has(a)||i.set(a,[]),(s=i.get(a))===null||s===void 0||s.push(o)});for(let[o,s]of i.entries()){let l=`${n.KEY_SEANCES}_${o}`,a=localStorage.getItem(l),c=[];a&&(c=JSON.parse(a)),s.forEach(d=>{let r=c.findIndex(u=>u.seanceId===d.seanceId);r!==-1?c[r]=d:c.push(d)}),localStorage.setItem(l,JSON.stringify(c)),console.log(`DataC: Cache mis \xE0 jour pour cin\xE9ma '${o}', ${s.length} s\xE9ances modifi\xE9es.`)}}catch(t){console.error("Erreur dans mise \xE0 jour des s\xE9ances : "+t)}})}};me.validiteCache=1;me.nomCookieDateAccess="dateAccess";me.nomStorage="storage";me.KEY_GLOBAL="myAppState";me.KEY_TARIFS="myAppTarifs";me.KEY_CINEMAS="myAppCinemas";me.KEY_FILMS="myAppFilms";me.KEY_SEANCES="myAppSeances";m=new me});function rn(){return fe(this,void 0,void 0,function*(){let n=m.selectedReservationUUID;if(n)try{let e=(yield Jn(n))[0];m.selectedFilmUUID=e.filmId||"",m.selectedSeanceUUID=e.seanceId,console.log("Date reservation = ",e.dateJour);let t=e.dateJour?new Date(e.dateJour):new Date;m.selectedSeanceDate=t;let i=document.getElementById("seances__cardseance-selected");if(!i){console.log("Pas de carte selectionn\xE9e");return}yield m.updateSeances([m.selectedSeanceUUID]);let o=Ie(m.seanceSelected(),m.selectedSeanceDate,"seances__cardseance-selected");i.replaceWith(o);let s=document.querySelector(".reservation__listFilms");s&&(s.style.display="none"),Lt(),qe(),yo(e)}catch(e){console.log(e)}})}function yo(n){return fe(this,void 0,void 0,function*(){let e=document.querySelector(".commande__tabtarif");if(!e)return;e.innerHTML="";let t=yield rt("",!0,m.selectedReservationUUID);e.appendChild(t);let i=document.querySelector(".panel__choisirSeats-button");if(i.classList.add("inactif"),i.disabled=!0,n.numberPMR===void 0||n.numberPMR===0){let d=document.querySelector(".commande__pmr");d.style.display="none"}else{let d=document.querySelector(".num__add-pmr"),r=document.querySelector(".num__remove-pmr");d.style.display="none",r.style.display="none";let u=document.getElementById("num__pmr");u&&(u.textContent=String(n.numberPMR))}let o=n.seatsReserved||m.selectedListSeats||"",s=document.querySelector(".commande__seats");if(o=="")s.style.display="none";else{let d=document.getElementById("text__seats");d.textContent=o,s.style.display="flex"}let l=document.getElementById("commande__mail-p");if(l){l.textContent=`R\xE9servation prise avec le mail : ${n.email}`;let d=document.getElementById("commande__mail-input");d&&(d.style.display="none");let r=document.getElementById("commande__mail-span");r&&(r.style.display="none")}let a=document.getElementById("statutMessage"),c=document.querySelector(".panel__changer-button");if(c&&(c.textContent="Annuler la reservation",c.removeEventListener("click",d=>fe(this,void 0,void 0,function*(){})),c.addEventListener("click",d=>fe(this,void 0,void 0,function*(){d.preventDefault(),d.stopPropagation();let r=yield bt(m.selectedReservationUUID||"");r.result==="OK"?(m.reservationState=I.PendingChoiceSeance,m.sauverComplet(),window.location.reload(),yield $("La reservation est annul\xE9e")):console.log("Resultat de l'annulation : ",r.message)}))),a){if(a.style.display="flex",m.reservationState===I.ReserveCompteToConfirm){a.innerHTML="<p>Vous devez finaliser la creation de votre compte</p>";let d=document.querySelector(".panel__jereserve-button");if(!d)return;d.classList.remove("inactif"),d.disabled=!1,d.textContent="Finaliser le compte",d.removeEventListener("click",r=>fe(this,void 0,void 0,function*(){})),d.addEventListener("click",r=>fe(this,void 0,void 0,function*(){r.preventDefault(),r.stopPropagation(),yield m.sauverEtatGlobal(),yield ln()}))}else if(m.reservationState===I.ReserveMailToConfirm){a.innerHTML="<p>Vous devez proceder \xE0 la v\xE9rification de votre email</p>";let d=document.querySelector(".panel__jereserve-button");if(!d)return;d.classList.remove("inactif"),d.disabled=!1,d.textContent="V\xE9rifier votre email",d.removeEventListener("click",r=>fe(this,void 0,void 0,function*(){})),d.addEventListener("click",r=>fe(this,void 0,void 0,function*(){r.preventDefault(),r.stopPropagation(),m.sauverComplet(),yield an()}))}else if(m.reservationState===I.ReserveToConfirm){a.innerHTML="<p>Vous devez vous connecter pour confirmer la reservation</p>";let d=document.querySelector(".panel__jereserve-button");if(!d)return;d.classList.remove("inactif"),d.disabled=!1,d.textContent="Connexion",d.removeEventListener("click",r=>fe(this,void 0,void 0,function*(){})),d.addEventListener("click",r=>fe(this,void 0,void 0,function*(){r.preventDefault(),r.stopPropagation(),m.sauverComplet(),yield Be("Veuillez vous connecter pour valider la r\xE9servation")}))}}})}function pi(){return fe(this,void 0,void 0,function*(){})}var fe,fi=P(()=>{"use strict";st();pe();lt();N();ye();ie();wt();fe=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});function O(){return _o(this,void 0,void 0,function*(){var n,e,t;console.log("===== chargerCinemaSites");let i=document.getElementById("footer");if(!i)return;i.innerHTML=`
    <div class="footer__container">
        <div class="container__legal">
            <a href="#" class="container__legal-a" id="linkMentions">Mentions l\xE9gales</a>
            <a href="#" class="container__legal-a" id="linkPolitique">Politique de confidentialit\xE9</a>
            <p class="container__legal-a" >&copy; 2024 - Tous droits r\xE9serv\xE9s - <span id="version">1.0(4)</span></p>
        </div>
        
        <div class="container__sites" id="container__sites">  
        </div>
    </div>
  `;let o=document.createElement("div");o.id="modalLegal",o.style.display="none",o.style.position="fixed",o.style.top="50%",o.style.left="50%",o.style.transform="translate(-50%, -50%)",o.style.backgroundColor="#fff",o.style.padding="20px",o.style.border="1px solid #ccc",o.style.zIndex="1000";let s=document.createElement("div");s.id="modalLegalContent",o.appendChild(s);let l=document.createElement("button");l.textContent="Fermer",l.onclick=()=>o.style.display="none",o.appendChild(l),document.body.appendChild(o);let a=document.getElementById("linkMentions"),c=document.getElementById("linkPolitique");a&&a.addEventListener("click",d=>{d.preventDefault(),s.innerHTML=`<h1>Mentions l\xE9gales</h1>
      <p>Le site cinephoria.bd2b.com est \xE9dit\xE9 par BD2DB</p>
      <p>Le directeur de la publication est BD2DB cinephoria@free.fr</p>
      <p>Ce site est auto h\xE9berg\xE9 par BD2DB cinephoria@free.fr</p>
      <p>D\xE9veloppement du site : BD2DB cinephoria@free.fr</p>`,o.style.display="block"}),c&&c.addEventListener("click",d=>{d.preventDefault(),s.innerHTML=`<h1>Politique de confidentialit\xE9</h1>
              <h2>1 - \xC9dition du site</h2>
<p>En vertu de l'article 6 de la loi n\xB0 2004-575 du 21 juin 2004 pour la confiance dans l'\xE9conomie num\xE9rique, il est pr\xE9cis\xE9 aux utilisateurs du site internet https://cinephoria.bd2db.com l'identit\xE9 des diff\xE9rents intervenants dans le cadre de sa r\xE9alisation et de son suivi:
</p>
<ul>
<li>Propri\xE9taire du site : BD2DB  - Contact : cinephoria@free.fr 

<li>Directeur de la publication : BD2DB - Contact : cinephoria@free.fr.

<li>H\xE9bergeur : Auto h\xE9berg\xE9 par BD2DB

<li>D\xE9l\xE9gu\xE9 \xE0 la protection des donn\xE9es : BD2DB - cinephoria@free.fr
</ul>

</p>
<h2>2 - Propri\xE9t\xE9 intellectuelle et contrefa\xE7ons.</h2>

<p>BD2DB  est propri\xE9taire des droits de propri\xE9t\xE9 intellectuelle et d\xE9tient les droits d\u2019usage sur tous les \xE9l\xE9ments accessibles sur le site internet, notamment les textes, images, graphismes, logos, vid\xE9os, architecture, ic\xF4nes et sons.
</p>
<p>Toute reproduction, repr\xE9sentation, modification, publication, adaptation de tout ou partie des \xE9l\xE9ments du site, quel que soit le moyen ou le proc\xE9d\xE9 utilis\xE9, est interdite, sauf autorisation \xE9crite pr\xE9alable de BD2DB  .
</p>
<p>Toute exploitation non autoris\xE9e du site ou de l\u2019un quelconque des \xE9l\xE9ments qu\u2019il contient sera consid\xE9r\xE9e comme constitutive d\u2019une contrefa\xE7on et poursuivie conform\xE9ment aux dispositions des articles L.335-2 et suivants du Code de Propri\xE9t\xE9 Intellectuelle.
</p>
<h2>3 - Limitations de responsabilit\xE9.</h2>

<p>BD2DB  ne pourra \xEAtre tenu pour responsable des dommages directs et indirects caus\xE9s au mat\xE9riel de l\u2019utilisateur, lors de l\u2019acc\xE8s au site https://cinephoria.bd2db.com.
</p>
<p>BD2DB  d\xE9cline toute responsabilit\xE9 quant \xE0 l\u2019utilisation qui pourrait \xEAtre faite des informations et contenus pr\xE9sents sur https://cinephoria.bd2db.com.
</p>
<p>BD2DB  s\u2019engage \xE0 s\xE9curiser au mieux le site https://cinephoria.bd2db.com, cependant sa responsabilit\xE9 ne pourra \xEAtre mise en cause si des donn\xE9es ind\xE9sirables sont import\xE9es et install\xE9es sur son site \xE0 son insu.
</p>
<p>Des espaces interactifs (espace contact ou commentaires) sont \xE0 la disposition des utilisateurs. BD2DB  se r\xE9serve le droit de supprimer, sans mise en demeure pr\xE9alable, tout contenu d\xE9pos\xE9 dans cet espace qui contreviendrait \xE0 la l\xE9gislation applicable en France, en particulier aux dispositions relatives \xE0 la protection des donn\xE9es.
</p>
<p>Le cas \xE9ch\xE9ant, BD2DB  se r\xE9serve \xE9galement la possibilit\xE9 de mettre en cause la responsabilit\xE9 civile et/ou p\xE9nale de l\u2019utilisateur, notamment en cas de message \xE0 caract\xE8re raciste, injurieux, diffamant, ou pornographique, quel que soit le support utilis\xE9 (texte, photographie \u2026).
</p>
<h2>4 - CNIL et gestion des donn\xE9es personnelles.</h2>

<p>Conform\xE9ment aux dispositions de la loi 78-17 du 6 janvier 1978 modifi\xE9e, l\u2019utilisateur du site https://cinephoria.bd2db.com dispose d\u2019un droit d\u2019acc\xE8s, de modification et de suppression des informations collect\xE9es. Pour exercer ce droit, envoyez un message \xE0 notre D\xE9l\xE9gu\xE9 \xE0 la Protection des Donn\xE9es : BD2DB - cinephoria@free.fr.
</p>

<h2>5 - Liens hypertextes et cookies</h2>

<p>Le site https://cinephoria.bd2db.com contient des liens hypertextes vers d\u2019autres sites et d\xE9gage toute responsabilit\xE9 \xE0 propos de ces liens externes ou des liens cr\xE9\xE9s par d\u2019autres sites vers https://cinephoria.bd2db.com.
</p>
<p>La navigation sur le site https://cinephoria.bd2db.com est susceptible de provoquer l\u2019installation de cookie(s) sur l\u2019ordinateur de l\u2019utilisateur.
</p>
<p>Un "cookie" est un fichier de petite taille qui enregistre des informations relatives \xE0 la navigation d\u2019un utilisateur sur un site. Les donn\xE9es ainsi obtenues permettent d'obtenir des mesures de fr\xE9quentation, par exemple.
</p>
<p>Vous avez la possibilit\xE9 d\u2019accepter ou de refuser les cookies en modifiant les param\xE8tres de votre navigateur. Aucun cookie ne sera d\xE9pos\xE9 sans votre consentement.
</p>
<p>Les cookies sont enregistr\xE9s pour une dur\xE9e maximale de 2 mois.
</p>

<h2>6 - Droit applicable et attribution de juridiction.</h2>

<p>Tout litige en relation avec l\u2019utilisation du site https://cinephoria.bd2db.com est soumis au droit fran\xE7ais. En dehors des cas o\xF9 la loi ne le permet pas, il est fait attribution exclusive de juridiction aux tribunaux comp\xE9tents de Lyon.
</p>
      
      `,o.style.display="block"}),console.log(" Version connu ",JSON.stringify(m.version)),dn(((n=m.version.MAJEURE)===null||n===void 0?void 0:n.toString(10))||"",((e=m.version.MINEURE)===null||e===void 0?void 0:e.toString(10))||"",((t=m.version.BUILD)===null||t===void 0?void 0:t.toString(10))||""),i.offsetHeight;try{let d=m.cinemas,r=document.getElementById("container__sites");if(!r){console.log("pas de container__sites");return}r.innerHTML="",d.forEach(u=>{console.log("Pied de page = ",u.nameCinema);let v=document.createElement("div");v.classList.add("container__site"),v.innerHTML=`
            <div class="site__title">
                <img src="assets/camera-150-inverse.png" alt="Logo" class="site__title-img">
                <h1 class="site__title-h1">${u.nameCinema}</h1>
            </div>
            <div class="site__adresse">
                <p class="site_adresse-p">${u.adresse}<br>${u.postalcode} ${u.ville}</p>
            </div>
            <div class="site__telephone">
                <img src="assets/tel.svg" class="site__telephone-img">
                <p class="site__telephone-p">${u.telCinema}</p>
            </div>
            <div class="site__seance">
                <p class="site__seance-p">${u.ligne1}</p>
                <p class="site__seance-p">${u.ligne2}</p>
            </div>
        </div>
        `,r.appendChild(v)})}catch(d){console.error("Erreur lors du chargement des cinemas",d)}})}function dn(n,e,t){let i=document.getElementById("version");i&&(i.textContent=`${n}.${e}(${t})`)}var _o,le=P(()=>{"use strict";pe();_o=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});var gi={};ge(gi,{afficherDetailsFilm:()=>Lt,basculerPanelChoix:()=>dt,basculerPanelReserve:()=>qe,onLoadReservation:()=>Co,seanceCardView:()=>Ie,updateCinema:()=>vi,updateContentPage:()=>Oe});function Co(){return Fe(this,void 0,void 0,function*(){if(yield De,console.log("Donn\xE9es charg\xE9es, traitement de la page reservations..."),yield J(),yield O(),m.filterNameCinema==="all"&&(m.filterNameCinema=m.selectedNameCinema),yield vi(),["ReserveCompteToConfirm","ReserveMailToConfirm","ReserveToConfirm"].includes(m.reservationState)&&(!se(m.selectedReservationUUID||"")||!se(m.selectedSeanceUUID||""))&&(m.reservationState=I.PendingChoiceSeance),["PendingChoiceSeance","PendingChoiceSeats","ReserveConfirmed"].includes(m.reservationState)){if(m.selectedFilmUUID===void 0){m.selectedReservationUUID=void 0,["PendingChoiceSeance","ReserveConfirmed"].includes(m.reservationState)&&(m.selectedSeanceUUID=void 0);let t=hi(m);if(!t[0].filmId)return;m.selectedFilmUUID=t[0].filmId}yield Oe(m),console.log(`dataController.filteredNameCinema = ${m.filterNameCinema} nombre de s\xE9ances = ${m.allSeances.length}`)}["ReserveCompteToConfirm","ReserveMailToConfirm","ReserveToConfirm"].includes(m.reservationState)&&(m.selectedReservationCinema&&m.filterNameCinema!==m.selectedReservationCinema&&(m.filterNameCinema=m.selectedReservationCinema),yield rn(),console.log("Affichage de la reservation \xE0 l'\xE9tat : ",m.reservationState)),document.querySelector("main").style.visibility="visible";let n=document.querySelector(".title__filters");n&&(n.style.visibility="visible");let e=document.getElementById("progressIndicator");e?(e.style.removeProperty("display"),e.style.display="none",e.classList.add("hidden"),console.log("Descativation progress")):console.error("Pas d'indicateur")})}function vi(){return Fe(this,void 0,void 0,function*(){let n=document.querySelectorAll(".title__filter-button-drowdown-content-complexe");function e(i){let o=document.querySelectorAll(".titre__filter-dropdown-complexe"),s=["PendingChoiceSeance","PendingChoiceSeats"].includes(m.reservationState);o.forEach(l=>{s?l.style.display="block":l.style.display="none",l.innerHTML=`${i} <span class="chevron">\u25BC</span>`})}e(m.selectedNameCinema);let t=document.getElementById("titleLeft");t&&(m.filterNameCinema==="all"?t.innerText="R\xE9servez au CinePhoria all \xE0 g\xE9rer":t.innerText=`R\xE9servez au CinePhoria de ${m.filterNameCinema}`),n.forEach(i=>{i.querySelectorAll("a").forEach(s=>{s.removeEventListener("click",l=>Fe(this,void 0,void 0,function*(){})),s.addEventListener("click",l=>Fe(this,void 0,void 0,function*(){var a;l.preventDefault();let c=(a=s.textContent)===null||a===void 0?void 0:a.trim();if(c){console.log("1 - Nouvelle valeur de cinema = ",c),e(c);let d=document.getElementById("titleLeft");d&&(d.innerText=`R\xE9servez au CinePhoria de ${c}`),m.filterNameCinema=c;let r=hi(m);if(!r[0].filmId)return;m.selectedFilmUUID=r[0].filmId,dt(),m.reservationState=I.PendingChoiceSeance,Oe(m);let u=document.getElementById("modal-cinema");u&&(console.log("2 - Fermeture de la modale "),u.classList.remove("show")),console.log(`3 - Fin du changement de cin\xE9ma : ${c}`)}}))})})})}function Oe(n){return Fe(this,void 0,void 0,function*(){console.log("UCP 1 - Update content page");let e=n.selectedFilmUUID;if(!e)return;let t=n.selectedFilm,i=n.premierJour(e),o=n.seancesFilmJour(e,i);console.log("UCP 2 - Film par defaut = ",t.titleFilm," Nombre de s\xE9ances",n.seancesFilmJour(t.id,i).length," Date : ",i),["PendingChoiceSeance","PendingChoiceSeats"].includes(n.reservationState)&&(Eo(),console.log("UCP 5 - Liste des films affich\xE9s"),Lt(),console.log("UCP 6 - Detail du film selectionn\xE9 affich\xE9s")),n.reservationState===I.PendingChoiceSeance?(console.log("ETAT : choix de la s\xE9ance"),Dt(i),console.log("UCP 7 - Lignes de tabulation des jours affich\xE9es"),at(i),console.log(`UCP 8 - S\xE9ances affich\xE9es pour ${t.titleFilm} le ${new Date(o[0].dateJour||"")}`)):(n.reservationState=I.PendingChoiceSeats)?(console.log("ETAT : choix des places"),qe(),un(),yield n.sauverEtatGlobal()):n.reservationState===I.ReserveCompteToConfirm?(console.log("On doit confirmer le compte"),qe(),rn(),pi()):n.reservationState===I.ReserveMailToConfirm?console.log("Abandon \xE0 la v\xE9rification de mail"):n.reservationState===I.ReserveToConfirm&&console.log("Abandon au login")})}function hi(n){let e=n.filmsJour();console.log("Debut affichage de la liste : ",e.length),e.length===0&&console.error("filmsDuJour est vide");let t=e.reduce((i,o)=>{let s=i.dateSortieCinePhoria?new Date(i.dateSortieCinePhoria):new Date(0),l=o.dateSortieCinePhoria?new Date(o.dateSortieCinePhoria):new Date(0);return l>s||l.getTime()===s.getTime()&&(o.note||0)>(i.note||0)?o:i},e[0]);return n.seancesFilmJour(t.id)}function Eo(){let n=document.querySelector(".reservation__listFilms");if(!n)return;let e=m.films,t=m.seancesFutures;console.log("Nombre de films dans la liste : ",e.length," nombre de seances =",t.length),n.innerHTML="",n.style.display="flex",e.forEach(i=>{var o;let s=document.createElement("div");s.classList.add("listFilms__simpleCard");let l=document.createElement("img");l.classList.add("listFilms__simpleCard-img"),i.imageFilm1024?l.src=z(i.imageFilm1024):console.log("Erreur imageFilm"),l.alt=(o=i.titleFilm)!==null&&o!==void 0?o:"Affiche";let a=document.createElement("p");a.classList.add("listFilms__simpleCard-p"),a.textContent=i.titleFilm||"",s.appendChild(l),s.appendChild(a),s.removeEventListener("click",()=>{}),s.addEventListener("click",()=>{let c=n.querySelector(".listFilms__simpleCard.selected");c&&c.classList.remove("selected"),s.classList.add("selected"),m.selectedFilmUUID=i.id,m.reservationState=I.PendingChoiceSeance,Oe(m),dt()}),i.id===m.selectedFilmUUID&&s.classList.add("selected"),n.appendChild(s)})}function Lt(){var n,e,t,i,o,s,l;let a=document.querySelector(".reservation__detailFilm");if(!a)return;let c=m.selectedFilm;if(!c){a.innerHTML="<p>Film introuvable.</p>";return}a.innerHTML=`
    <div class="detailFilm__twocolumns">
      <div class="twocolumns__left">
        <img src="${z((n=c.imageFilm1024)!==null&&n!==void 0?n:"")}" alt="Affiche" class="twocolumns__left-img">
        <button class="twocolumns__left-button-bo" id="openModal">Bande Annonce</button>
        <div class="evaluation__note">
            <p class="evaluation__note-p">Avis : ${c.note} / 5</p>
        </div>
        <div class="evaluation__coupdecoeur"  style="visibility: ${c.isCoupDeCoeur?"visible":"hidden"}">
            <p class="evaluation__coupdecoeur-p">Coup de coeur</p>
            <img src="assets/heart.svg" alt="Coeur" class="evaluation__coupdecoeur-img">
        </div>
                
      </div>
      
      <div class="twocolumns__right">
        <p class="right__title-p">${c.titleFilm}</p>
        <div class="right__caractFilm">
          <p class="caractFilm__genre-p">${(e=c.genreArray)!==null&&e!==void 0?e:""}</p>
          <p class="caractFilm__duree-p">${(t=c.duration)!==null&&t!==void 0?t:""}</p>
          <p class="caractFilm__public-p">${(i=c.categorySeeing)!==null&&i!==void 0?i:""}</p>
        </div>
        <p class="right__description-p">${(o=c.filmDescription)!==null&&o!==void 0?o:""}</p>
        <p class="right__author-p">${(s=c.filmAuthor)!==null&&s!==void 0?s:""}</p>
        <p class="right__distribution">${(l=c.filmDistribution)!==null&&l!==void 0?l:""}</p>
      </div>
    </div>
  `;let d=a.querySelector(".twocolumns__left-button-bo"),r=document.getElementById("videoModal"),u=r?.querySelector(".closeyoutube"),v=document.getElementById("youtubeVideo"),p=`${c.linkBO}?autoplay=1`;if(console.log("URL dynamique = ",p),d&&r&&u&&v&&p){d.addEventListener("click",()=>{r.style.display="flex",v.src=p,console.log("URL utilis\xE9e = ",v.src)});let f=()=>{r.style.display="none",v.src=""};u.addEventListener("click",f),r.addEventListener("click",g=>{g.target===r&&f()})}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal sont introuvables.")}function Dt(n=new Date,e=!0){let t=document.querySelector(".panel__tabs");if(!t||!m.selectedFilmUUID)return;let i=m.selectedFilmUUID;t.innerHTML="";let o=m.premierJour(m.selectedFilmUUID);U(o)<U(new Date)&&(o=new Date);let s=Pe(n),l=e?Mn(n):we(s,6);if(m.seancesFilmDureeJour(i,s,6).length===0)return;if(!e&&s.getTime()>o.getTime()){let d=document.createElement("p");d.classList.add("tabs__tab-p","tabs__tab-nav-p","tabs__tab-nav-prec-p"),d.textContent="Avant",d.addEventListener("click",()=>{let r=we(s,-7);r.getTime()<=o.getTime()?(Dt(o,!0),at(o)):(Dt(r,!1),at(r))}),t.appendChild(d)}let a=new Date(s.getTime()),c=0;for(;a.getTime()<=l.getTime();){if(a.getTime()>=o.getTime()&&m.seancesFilmJour(m.selectedFilmUUID,a).length>0){c+=1;let d=document.createElement("p");d.classList.add("tabs__tab-p","tabs__tab-day-p"),d.textContent=We(a);let r=new Date(a.getTime());d.addEventListener("click",()=>{at(r)}),t.appendChild(d)}a=we(a,1)}if(m.seancesFilmDureeJour(i,we(l,1),7).length>0){let d=document.createElement("p");d.classList.add("tabs__tab-p","tabs__tab-nav-p","tabs__tab-nav-suiv-p"),d.textContent="Apr\xE8s",d.addEventListener("click",()=>{let r=we(l,1);console.log("Apres = ",r),m.selectedSeanceDate=r,Dt(r,!1),at(r)}),t.appendChild(d)}}function at(n){return Fe(this,void 0,void 0,function*(){var e,t;m.selectedSeanceDate=n,m.selectedSeanceUUID=void 0;let i=document.getElementById("panel__choixseance-button");i&&(i.textContent="Choisissez votre s\xE9ance",i.classList.add("inactif"));let o=document.querySelector(".panel__tabs");o&&o.querySelectorAll(".tabs__tab-day-p").forEach(v=>{v.textContent&&(v.textContent.trim()===We(n).trim()?v.classList.add("selected"):v.classList.remove("selected"))});let s=document.querySelector(".panel__seances");if(!s||(s.innerHTML="",!m.selectedFilmUUID))return;let l=m.selectedFilmUUID,a=m.seancesFilmJour(m.selectedFilmUUID,n),c=cn.getFullYear()===n.getFullYear()&&cn.getMonth()===n.getMonth()&&cn.getDate()===n.getDate(),d=new Date;if(a.length===0){let u=m.allSeances.find(g=>g.filmId===l),v=(e=u?.titleFilm)!==null&&e!==void 0?e:"Film inconnu",p=(t=u?.nameCinema)!==null&&t!==void 0?t:"Cin\xE9ma inconnu",f=document.createElement("p");f.textContent=`Pas de s\xE9ance pour ${v} au cin\xE9ma ${p} ce jour.`,s.appendChild(f);return}console.log("Film = ",a[0].titleFilm," / nombre de seances = ",a.length," / date = ",U(n));let r=a.map(u=>u.seanceId);yield m.updateSeances(r),a=m.seancesFilmJour(m.selectedFilmUUID,n),a.forEach(u=>{var v;if(c){let[p,f]=((v=u.hourBeginHHSMM)!==null&&v!==void 0?v:"00:00").split(":").map(Number),g=new Date(n);g.setHours(p-1,f,0,0),u._isPast=d>g}else u._isPast=!1}),a.forEach(u=>{var v;if(parseInt((v=u.numFreeSeats)!==null&&v!==void 0?v:"10",10)>-1){let p=Ie(u,n);p.classList.remove("seances__cardseance-selected"),u._isPast?(p.style.opacity="0.2",p.style.pointerEvents="none",console.log("Dans le pass\xE9")):(console.log("Dans le futur"),p.removeEventListener("click",()=>{}),p.addEventListener("click",()=>{console.log(`S\xE9ance cliqu\xE9e : ${u.seanceId}`);let f=document.querySelector(".panel__seances");f&&f.querySelectorAll(".seances__cardseance-selected").forEach(h=>{console.log("Suppression la class selected "),h.classList.remove("seances__cardseance-selected")}),p.classList.add("seances__cardseance-selected"),m.selectedSeanceUUID=u.seanceId,console.log("SeanceId selectionnee = "+m.selectedSeanceUUID+", seance = "+m.seanceSelected().dateJour+","+m.seanceSelected().hourBeginHHSMM);let g=document.getElementById("panel__choixseance-button");if(g){let y=g.cloneNode(!0);y.classList.remove("inactif"),y.textContent="Je r\xE9serve pour cette s\xE9ance !",g.replaceWith(y),y.addEventListener("click",()=>Fe(this,void 0,void 0,function*(){g&&(qe(),m.reservationState=I.PendingChoiceSeats,un(),yield m.sauverEtatGlobal())}))}})),s.appendChild(p)}})})}function Ie(n,e,t="",i=!0){var o,s,l;let a=document.createElement("div");a.classList.add("seances__cardseance"),a.classList.add("seances__cardseance-selected"),t!==""&&(a.id=t);let c=document.createElement("div");c.classList.add("cardseance__horaire");let d=document.createElement("p");d.classList.add("horaire__hour","horaire__hour-begin-p"),d.textContent=n.hourBeginHHSMM||"";let r=document.createElement("p");r.classList.add("horaire__hour","horaire__hour-end-p"),r.textContent=n.hourEndHHSMM||"",c.appendChild(d),c.appendChild(r);let u=document.createElement("div");u.classList.add("cardseance__datesalle");let v=document.createElement("div");v.classList.add("datesalle__date");let p=document.createElement("p");p.classList.add("date__month-p"),p.textContent=An(e);let f=document.createElement("p");f.classList.add("date__day-p"),f.textContent=String(e.getDate());let g=parseInt((o=n.numFreeSeats)!==null&&o!==void 0?o:"10",10);if(i){let E=document.createElement("div");E.classList.add("cardseance__bandeau"),g===0?(E.textContent="______COMPLET_____",a.appendChild(E),a.style.pointerEvents="none"):g<=10&&(E.textContent=`Plus que ${n.numFreeSeats} places disponibles`,a.appendChild(E))}v.appendChild(p),v.appendChild(f);let y=document.createElement("p");y.classList.add("datesalle__salle-p"),y.textContent=(s=n.nameSalle)!==null&&s!==void 0?s:"Salle ?",u.appendChild(v),u.appendChild(y);let h=document.createElement("div");h.classList.add("cardseance__qualitebo");let C=document.createElement("img");C.classList.add("qualitebo-qualite-img"),C.src=`assets/${n.qualite}.png`;let b=document.createElement("p");return b.classList.add("qualitebo-bo-p"),b.textContent=(l=n.bo)!==null&&l!==void 0?l:"VF",h.appendChild(C),h.appendChild(b),a.appendChild(c),a.appendChild(u),a.appendChild(h),a}function qe(){let n=document.querySelector(".panel__choix"),e=document.querySelector(".panel__reserve");n&&e&&(n.style.display="none",e.style.display="flex")}function dt(){let n=document.querySelector(".panel__choix"),e=document.querySelector(".panel__reserve");n&&e&&(n.style.display="block",e.style.display="none")}var Fe,cn,st=P(()=>{"use strict";N();pe();ye();lt();fi();ve();le();N();Fe=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})};cn=new Date});function un(){return R(this,void 0,void 0,function*(){try{let n=document.getElementById("seances__cardseance-selected");if(!n){console.log("Pas de carte selectionn\xE9e");return}yield m.updateSeances([m.selectedSeanceUUID]);let e=Ie(m.seanceSelected(),m.selectedSeanceDate,"seances__cardseance-selected");if(n.replaceWith(e),m.reservationState===I.PendingChoiceSeance||m.reservationState===I.PendingChoiceSeats){let t=document.querySelector(".panel__changer-button");t&&(t.removeEventListener("click",()=>R(this,void 0,void 0,function*(){})),t.addEventListener("click",i=>R(this,void 0,void 0,function*(){i.preventDefault(),i.stopPropagation(),m.reservationState=I.PendingChoiceSeance,m.selectedSeanceUUID=void 0,yield m.sauverEtatGlobal(),dt(),Oe(m)}))),yield bo()}}catch(n){console.error("Erreur lors de l'affichage du content de selection des places : ",n)}})}function bo(){return R(this,void 0,void 0,function*(){var n,e,t;function i(){let h=m.selectedListSeats||"",C=document.querySelector(".commande__seats");C.style.display="flex";let b=document.getElementById("libelle__seats"),E=document.getElementById("text__seats");if(!(!b||!E))if(h==="")b.textContent="Pas de sieges pr\xE9cis\xE9s",E.textContent="";else{let L=h.includes(",")?"s":"";b.textContent=`Si\xE8ge${L} r\xE9serv\xE9${L} : `,E.textContent=h}}console.log("Affichage de la reservation de place"),m.reservationState=I.PendingChoiceSeats;let o=m.seanceSelected().qualite,s=Math.min(parseInt((n=m.seanceSelected().capacity)!==null&&n!==void 0?n:"10",10),8),l=Math.min(parseInt((e=m.seanceSelected().numPMR)!==null&&e!==void 0?e:"0",10),8),a=document.querySelector(".commande__tabtarif");if(!a)return;if(a.innerHTML="",o){let h=yield rt(o,void 0,void 0,s);a.appendChild(h)}let c=document.querySelector(".commande__pmr"),d=xo(l);if(!c)throw new Error("updateInputPMT");c.innerHTML="",c.appendChild(d);let r=document.getElementById("commande__mail-input"),u=document.getElementById("commande__mail-error");if(!r||!u)return;if(k.profil()===W.Utilisateur){let h=(t=k.compte())===null||t===void 0?void 0:t.email;h&&(r.value=h,r.disabled=!0);let C=document.getElementById("commande__mail-p");C.innerHTML="Votre email ";let b=document.getElementById("commande__mail-span");b.hidden=!0}else r.value="",r.removeEventListener("blur",()=>{}),r.addEventListener("blur",()=>{K(r.value)?u.textContent="":(u.textContent="Email invalide (exemple: utilisateur@domaine.com)",u.style.color="red")});let v=document.querySelector(".panel__choisirSeats-button");if(v.classList.add("inactif"),v.disabled=!0,!v)return;m.selectedListSeats=void 0;let p=document.querySelector(".panel__jereserve-button");if(p.classList.add("inactif"),p.disabled=!0,p.textContent="Je choisis ces places",!p)return;let f=document.getElementById("content-totalprice");if(!f)return;function g(){let h=K(r.value),C=parseInt(f?.textContent||"0",10)>0;C?(v.classList.remove("inactif"),v.disabled=!1):(v.classList.add("inactif"),v.disabled=!0),h&&C&&["PendingChoiceSeance","PendingChoiceSeats","ReserveConfirmed"].includes(m.reservationState)?(p.classList.remove("inactif"),p.disabled=!1):(p.classList.add("inactif"),p.disabled=!0)}r.addEventListener("input",g),new MutationObserver(()=>{console.log("Changement...."),g();let h=document.querySelector(".panel__choisirSeats-button");h.textContent="Choisir les fauteuils",m.selectedListSeats="",i()}).observe(f,{characterData:!0,childList:!0,subtree:!0}),v.removeEventListener("click",h=>R(this,void 0,void 0,function*(){})),v.addEventListener("click",h=>R(this,void 0,void 0,function*(){h.preventDefault(),h.stopPropagation(),console.log("Choix des si\xE8ges");let{totalPlaces:C,tarifSeatsMap:b}=yi(".tabtarif__commande-table"),E=_i(".commande__pmr");console.log(`Nombre de PMR = ${E}`);let S=m.seanceSelected().seatsAbsents.split(",").map(_=>_.trim().replace(/^"|"$/g,"")),{siegesReserves:B}=yield Hn(m.seanceSelected().seanceId);console.log("Liste des sieges 1 = ",B);let x=B?B.split(",").map(_=>_.trim().replace(/^"|"$/g,"")):[];console.log("Liste des si\xE8ges r\xE9serv\xE9s en tableau =",x),console.log("MaxPMR = ",parseInt(m.seanceSelected().numPMR,10)),console.log("Seance = ",JSON.stringify(m.seanceSelected())),Lo(C,E,x,S,parseInt(m.seanceSelected().rMax,10),parseInt(m.seanceSelected().fMax,10),parseInt(m.seanceSelected().numPMR,10)).then(_=>{if(_.length>0){m.selectedListSeats=_.join(",");let D=document.querySelector(".panel__choisirSeats-button");if(D){let T="";_.length>1&&(T="s"),D.textContent=`${_.length} si\xE8ge${T} choisi${T}`}i(),console.log("Liste des places = ",_)}}).catch(_=>{console.error("Erreur lors de la s\xE9lection des places :",_)})})),p.removeEventListener("click",h=>R(this,void 0,void 0,function*(){})),p.addEventListener("click",h=>R(this,void 0,void 0,function*(){p.disabled=!0,p.classList.add("inactif"),p.classList.add("loading"),h.preventDefault(),h.stopPropagation(),console.log("Statut Reservation "+m.reservationState);let{totalPlaces:C,tarifSeatsMap:b}=yi(".tabtarif__commande-table");console.log(`Nombre de places total = ${C}, R\xE9partition = ${b}`);let E=_i(".commande__pmr");console.log(`Nombre de PMR = ${E}`);let L=yield So(".commande__mail-input");console.log(`email = ${L}`);try{let S=m.seanceSelected().seanceId,B=m.selectedListSeats||"",{statut:x,utilisateurId:_,reservationId:D}=yield Pn(L,S,b,E,B);switch(m.selectedUtilisateurUUID=_,m.selectedReservationUUID=D,m.selectedUtilisateurMail=L,x){case"Compte Provisoire":console.log("Compte provisoire , "+_+" , "+D),m.reservationState=I.ReserveCompteToConfirm,yield m.sauverEtatGlobal(),yield ln();break;case"Compte Confirme":if(k.profil()===W.Utilisateur){k.ident=r.value.trim(),yield k.init(),yield mn(),yield k.init();let T=k.profil();window.location.href=T}console.log("Compte Confirme , "+_+" , "+D),m.reservationState=I.ReserveToConfirm,yield m.sauverEtatGlobal(),yield Be("Veuillez vous connecter pour valider la r\xE9servation");break;default:yield $(`Une erreur s'est produite : statut inconnu -> ${x} , ${_} , ${D}`);break}}catch(S){console.error("Erreur lors de la cr\xE9ation de la r\xE9servation",S),yield $(`Une erreur s'est produite : ${S?.message||"inconnue"}`)}finally{p.classList.remove("loading")}}))})}function yi(n){let e=document.querySelector(n),t=0,i={};return e?(e.querySelectorAll("tr.body__content-tr").forEach(s=>{var l;let a=s.dataset.tarifid||"";console.log("TarifId = ",a);let c=s.querySelector(".num__num-span#num__place"),d=c?parseInt((l=c.textContent)!==null&&l!==void 0?l:"0",10):0;d>0&&a&&(i[a]=d),t+=d}),{totalPlaces:t,tarifSeatsMap:i}):{totalPlaces:0,tarifSeatsMap:i}}function _i(n){var e;let t=document.querySelector(n);if(!t)return 0;let i=t.querySelector(".num__num-span#num__pmr");return i?parseInt((e=i.textContent)!==null&&e!==void 0?e:"0",10):0}function So(n){return R(this,void 0,void 0,function*(){let e=document.querySelector(n);return e?e.value.trim():""})}function rt(n){return R(this,arguments,void 0,function*(e,t=!1,i="",o=8){let s=document.createElement("table");s.classList.add("tabtarif__commande-table");let l=document.createElement("thead");l.classList.add("commande__entete-thead"),l.innerHTML=`
      <tr class="entete__content-tr">
        <th class="content-th content-id-th">#</th>
        <th class="content-th content-tarif-th">Tarif</th>
        <th class="content-th content-places-th">Places</th>
        <th class="content-th content-total-th">Total</th>
      </tr>
    `,s.appendChild(l);let a=document.createElement("tbody");a.classList.add("commande__body-tbody"),s.appendChild(a);let c=document.createElement("tfoot");c.classList.add("commande__foot-tfoot"),c.innerHTML=`
      <tr class="foot__content-tr">
      
        <td></td> <td></td> <td></td>
        <td class="content-td content-totalprice-td" id = "content-totalprice">0 \u20AC</td>
      </tr>
    `,s.appendChild(c);let d=c.querySelector(".content-totalprice-td");if(t){let u=[];i!==""?u=yield jn(i):console.error("updateTableContent : Pas de reservation communiquee pour un affichage de reservation");let v=1;u.forEach(f=>{let g=document.createElement("tr");g.classList.add("body__content-tr");let y=document.createElement("td");y.classList.add("content-td","content-id-td"),y.textContent=String(v);let h=document.createElement("td");h.classList.add("content-td","content-tarif-td"),h.textContent=`${f.nameTarif} (${f.numberSeats}\u20AC)`;let C=document.createElement("td");C.classList.add("content-td","content-num-td");let b=document.createElement("span");b.classList.add("num__num-span"),b.id="num__place",b.textContent=String(f.numberSeats)||"",C.appendChild(b);let E=document.createElement("td");E.classList.add("content-td","content-price-td"),E.textContent=`${String(f.numberSeats*f.price)} \u20AC`,g.appendChild(y),g.appendChild(h),g.appendChild(C),g.appendChild(E),a.appendChild(g),v++});let p=u.reduce((f,g)=>f+(g.numberSeats||1)*(g.price||1),0);d.textContent=`${String(p)} \u20AC`}else{let p=function(){let f=0;a.querySelectorAll("tr.body__content-tr").forEach(g=>{var y,h;let C=g.querySelector(".content-price-td");if(C){let b=(h=(y=C.textContent)===null||y===void 0?void 0:y.replace(" \u20AC",""))!==null&&h!==void 0?h:"0",E=parseFloat(b)||0;f+=E}}),d.textContent=`${f} \u20AC`};var r=p;let u=m.allTarifQualite.filter(f=>f.qualite===e),v=1;u.forEach(f=>{var g;let y=document.createElement("tr");y.setAttribute("data-tarifid",f.id),y.classList.add("body__content-tr");let h=document.createElement("td");h.classList.add("content-td","content-id-td"),h.textContent=String(v);let C=document.createElement("td");C.classList.add("content-td","content-tarif-td");let b=f.price?parseFloat(f.price):0;C.textContent=`${(g=f.nameTarif)!==null&&g!==void 0?g:""} (${b}\u20AC)`;let E=document.createElement("td");E.classList.add("content-td","content-num-td");let L=document.createElement("button");L.classList.add("num__remove-button"),L.textContent="-";let S=document.createElement("span");S.classList.add("num__num-span"),S.id="num__place",S.textContent="0";let B=document.createElement("button");B.classList.add("num__add-button"),B.textContent="+",E.appendChild(L),E.appendChild(S),E.appendChild(B);let x=document.createElement("td");x.classList.add("content-td","content-price-td"),x.textContent="0 \u20AC",y.appendChild(h),y.appendChild(C),y.appendChild(E),y.appendChild(x),a.appendChild(y);function _(){var D;let T=parseInt((D=S.textContent)!==null&&D!==void 0?D:"0",10)||0,j=b*T;x.textContent=`${j} \u20AC`,p()}B.addEventListener("click",D=>R(this,void 0,void 0,function*(){var T;D.preventDefault(),D.stopPropagation();let j=parseInt((T=S.textContent)!==null&&T!==void 0?T:"0",10)||0,Q=0;a.querySelectorAll("span#num__place").forEach(xe=>{var Le;let ht=parseInt((Le=xe.textContent)!==null&&Le!==void 0?Le:"0",10)||0;Q+=ht}),Q<o?(j++,S.textContent=String(j),_()):yield $(`Vous ne pouvez pas r\xE9server plus de ${o} places au total.`)})),L.addEventListener("click",D=>{var T;D.preventDefault(),D.stopPropagation();let j=parseInt((T=S.textContent)!==null&&T!==void 0?T:"0",10)||0;j>0&&(j--,S.textContent=String(j),_())}),v++})}return s})}function xo(n){let e=document.createElement("div");if(e.classList.add("pmr__content"),n===0)return e;let t=document.createElement("p");t.classList.add("content__libelle-p"),t.textContent="Personne \xE0 mobilit\xE9 r\xE9duite :";let i=document.createElement("div");i.classList.add("content__num-pmr");let o=document.createElement("button");o.classList.add("num__remove-button","num__remove-pmr"),o.textContent="-";let s=document.createElement("span");s.classList.add("num__num-span","num__numpmr-span"),s.id="num__pmr",s.textContent="0";let l=document.createElement("button");if(l.classList.add("num__add-button","num__add-pmr"),l.textContent="+",!l||!o||!s)throw new Error("Erreur updateInputPMR");return l.removeEventListener("click",a=>{}),o.removeEventListener("click",a=>{}),s.textContent="0",l.addEventListener("click",a=>{var c;a.preventDefault(),a.stopPropagation();let d=parseInt((c=s.textContent)!==null&&c!==void 0?c:"0",10)||0;d<n?(d++,s.textContent=String(d)):alert(`Vous ne pouvez pas r\xE9servez plus de ${n} places PMR`)}),o.addEventListener("click",a=>{var c;a.preventDefault(),a.stopPropagation();let d=parseInt((c=s.textContent)!==null&&c!==void 0?c:"0",10)||0;d>0&&(d--,s.textContent=String(d))}),i.appendChild(o),i.appendChild(s),i.appendChild(l),e.appendChild(t),e.appendChild(i),e}function ln(){return R(this,void 0,void 0,function*(){let n=`
    <!-- Modale confirmUtilisateur -->
    <div id="modal-confirmUtilisateur" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <div class="title-h2">
                    <h2>Cr\xE9ation du compte</h2>
                </div>
                <!-- Bouton (X) ou autre m\xE9canisme pour fermer la modale si besoin -->
                <span class="close-modal" id="close-confirmUtilisateur">\xD7</span>
            </div>
            <div class="modal__content">
                <div class="title-p">
                    <p>Pour r\xE9cup\xE9rer le QRCode de votre r\xE9servation, vous devez cr\xE9er un compte CinePhoria en
                        enregistrant
                        les
                        informations suivantes :</p>
                </div>
                <!-- Saisie de l'email -->
                <div class="form__group">
                    <label for="confirmUtilisateur-email">Email :</label>
                    <input type="email" id="confirmUtilisateur-email" class="input__mail" disabled>
                    <span id="email-error" class="error-message"></span>
                </div>

                <!-- Saisie du displayName -->
                <div class="form__group">
                    <label for="confirmUtilisateur-displayName">Nom ou pseudo :</label>
                    <input type="text" id="confirmUtilisateur-displayName" class="input__text" required />
                </div>

                <!-- Mot de passe 1 -->
                <div class="form__group">
                    <label for="confirmUtilisateur-password1">Mot de passe :</label>
                    <input type="password" id="confirmUtilisateur-password1" required />
                </div>
                <!-- Message d'erreur de force du mot de passe -->
                <div class="form__group">
                    <span id="password-strength-error" class="error-message">Le mot de passe doit comporter au moins 8 caract\xE8res, une majuscule, une minuscule, un chiffre et un caract\xE8re sp\xE9cial.</span>
                </div>
                <!-- Mot de passe 2 -->
                <div class="form__group">
                    <label for="confirmUtilisateur-password2">Confirmer le mot de passe :</label>
                    <input type="password" id="confirmUtilisateur-password2" required />
                    <span id="password-error" class="error-message"></span>
                </div>
                <!-- Bouton de validation -->
                <button id="confirmUtilisateur-submit" class="button button-primary" disabled>
                    Valider
                </button>
            </div>
        </div>
    </div>
    `,e=document.createElement("div");e.innerHTML=n,document.body.appendChild(e);let t=m.selectedUtilisateurMail||"";console.log("===> confirmUtilisateur action, email =",t);let i=e.querySelector("#modal-confirmUtilisateur"),o=document.getElementById("close-confirmUtilisateur"),s=document.getElementById("confirmUtilisateur-submit");if(i&&o&&s){i.style.display="flex";let c=()=>{i.style.display="none",window.location.reload()};o.addEventListener("click",c),i.addEventListener("click",d=>{d.target===i&&c()}),yield l()}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal modal-confirmUtilisateur sont introuvables.");function l(){return R(this,void 0,void 0,function*(){let c=m.selectedUtilisateurMail||"",d=e.querySelector("#confirmUtilisateur-displayName"),r=e.querySelector("#confirmUtilisateur-email"),u=e.querySelector("#confirmUtilisateur-password1"),v=e.querySelector("#confirmUtilisateur-password2"),p=e.querySelector("#confirmUtilisateur-submit"),f=e.querySelector("#email-error"),g=e.querySelector("#password-error"),y=e.querySelector("#password-strength-error");y.style.minHeight="1.2em",g.style.minHeight="1.2em",d.value="",r.value=c;function h(){return u.value===v.value&&u.value.length>0}function C(){return d.value.trim()!==""&&r.value.trim()!==""&&u.value.trim()!==""&&v.value.trim()!==""}function b(){let E=K(r.value),L=u.value===v.value&&u.value.length>0,S=C(),B=!1;L&&(B=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(u.value)),L?B?y.textContent="":(y.textContent="Le mot de passe doit comporter au moins 8 caract\xE8res, une majuscule, une minuscule, un chiffre et un caract\xE8re sp\xE9cial.",y.style.color="red"):y.textContent="",!L&&v.value.length>0?(g.textContent="Les mots de passe ne correspondent pas.",g.style.color="red"):g.textContent="",E&&B&&L&&S?(p.classList.remove("inactif"),p.disabled=!1):(p.classList.add("inactif"),p.disabled=!0)}r.value=c,p.classList.add("inactif"),r.addEventListener("blur",()=>{K(r.value)?f.textContent="":(f.textContent="Email invalide (exemple: utilisateur@domaine.com)",f.style.color="red")}),d.addEventListener("input",b),u.addEventListener("input",b),v.addEventListener("input",b),p.removeEventListener("click",E=>R(this,void 0,void 0,function*(){})),p.addEventListener("click",E=>R(this,void 0,void 0,function*(){E.preventDefault(),E.stopPropagation(),m.selectedUtilisateurUUID&&(yield a(m.selectedUtilisateurUUID,r.value.trim(),u.value.trim(),d.value.trim()))&&(i&&(i.style.display="none"),m.reservationState=I.ReserveMailToConfirm,yield an(),yield m.sauverEtatGlobal())}))})}function a(c,d,r,u){return R(this,void 0,void 0,function*(){return(yield Rn(c,r,u)).statut==="OK"?(m.reservationState=I.ReserveMailToConfirm,m.selectedUtilisateurDisplayName=u,m.selectedUtilisateurMail=d,!0):!1})}})}function an(){return R(this,void 0,void 0,function*(){let n=`
    <!-- Modale confirmMail -->
    <div id="modal-confirmMail" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <div class="title-h2">
                    <h2>Verification adresse email</h2>
                </div>
                <!-- Bouton (X) ou autre m\xE9canisme pour fermer la modale si besoin -->
                <span class="close-modal" id="close-confirmMail">\xD7</span>
            </div>
            <div class="modal__content">
                <div class="confirmMail-title title-p" id="confirmMail-title">
                    <p>Vous avez du recevoir un email contenant un code de confirmation \xE0 six chiffres.</p>
                </div>
                <!-- Saisie du code de confirmation -->
                <div class="form__group">
                    <label for="confirmMail-code">Code de confirmation :</label>
                    <input type="text" id="confirmMail-code" class="input__code">
                    <span id="code-error" class="error-message"></span>
                </div>

                <!-- Bouton de validation -->
                <button id="confirmMail-submit" class="button button-primary" disabled>
                    Valider
                </button>
            </div>
        </div>
    </div>
    `,e=document.createElement("div");e.innerHTML=n,document.body.appendChild(e);let t=m.selectedUtilisateurMail||"";console.log("===> confirmMail action, email =",t);let i=document.getElementById("modal-confirmMail"),o=document.getElementById("close-confirmMail"),s=document.getElementById("confirmMail-submit");if(i&&o&&s){i.style.display="flex";let a=()=>{i.style.display="none",window.location.reload()};o.addEventListener("click",a),i.addEventListener("click",c=>{c.target===i&&a()}),yield l()}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal modal-confirmMail sont introuvables.");function l(){return R(this,void 0,void 0,function*(){let a=document.getElementById("confirmMail-code"),c=document.getElementById("confirmMail-submit"),d=document.getElementById("code-error"),r=document.getElementById("confirmMail-title");if(r){let g=function(){return a.value.trim()!==""},y=function(){g()?(c.classList.remove("inactif"),c.disabled=!1):(c.classList.add("inactif"),c.disabled=!0)},h=function(C){return/^[0-9]{6}$/.test(C)};var v=g,p=y,f=h;a.value="",r.textContent=`
Nous avons envoy\xE9 \xE0 l'adresse (${m.selectedUtilisateurMail||""}) 
un code \xE0 renseigner ci-dessous.
`,c.classList.add("inactif"),a.addEventListener("blur",()=>{h(a.value)?d.textContent="":(d.textContent="Le code se compose de 6 chiffres (exemple : 123456)",d.style.color="red")}),a.addEventListener("input",y),c.removeEventListener("click",C=>R(this,void 0,void 0,function*(){})),c.addEventListener("click",C=>R(this,void 0,void 0,function*(){if(C.preventDefault(),C.stopPropagation(),!!m.selectedUtilisateurUUID)try{if(yield u(m.selectedUtilisateurMail||"",a.value.trim())){let b=document.getElementById("modal-confirmMail");b&&(b.style.display="none"),m.reservationState=I.ReserveToConfirm,yield m.sauverEtatGlobal(),yield Be("Veuillez vous connecter pour valider la r\xE9servation")}}catch(b){console.log("Erreur = ",b);let E=b;E&&(d.textContent=E)}}))}function u(g,y){return R(this,void 0,void 0,function*(){let h=yield Nn(g,y);if(h.statut==="OK")return m.reservationState=I.ReserveToConfirm,!0;throw new Error(h.statut)})}})}})}function mn(){return R(this,void 0,void 0,function*(){let n=m.selectedReservationUUID,e=m.selectedUtilisateurUUID,t=m.selectedSeanceUUID;if(n&&e&&t)try{console.log("Appel sur R U S",n," ",e," ",t),yield $n(n,e,t),yield $("votre reservation est confirm\xE9e"),m.reservationState=I.PendingChoiceSeance,m.selectedReservationUUID=void 0,m.selectedSeanceUUID=void 0,m.selectedUtilisateurUUID=void 0,m.selectedListSeats=void 0,yield m.sauverEtatGlobal()}catch(i){alert("Erreur dans la confirmation de la r\xE9servation = "+i)}})}function Lo(n,e,t){return R(this,arguments,void 0,function*(i,o,s,l=[],a=20,c=10,d=2){return new Promise(r=>{console.log("Nombre total de siege = "+i+" dont nombre de PMR = "+o);let u=`
      <div class="modal__content-wrapper">
        <div class="modal__title">
          <div class="title__displayAndSeatsReserve title-h2">
            <h2>S\xE9lectionner les places</h2>
          </div>
          <span class="close-modal" id="close-displayAndSeatsReserve">\xD7</span>
        </div>
        <div class="modal__content" id="content__displayAndSeatsReserve"></div>
        <div class="modal__footer" style="margin-top: 10px; display:flex; gap:10px; justify-content: end;">
          <button id="btnAnnulerSeats" class="button">Annuler</button>
          <button id="btnValiderSeats" class="button inactif" disabled>Valider</button>
        </div>
      </div>`,v=document.getElementById("modal-displayAndSeatsReserve");v||(v=document.createElement("div"),v.id="modal-displayAndSeatsReserve",v.classList.add("modal"),document.body.appendChild(v)),v.innerHTML=u,v.style.display="flex";let p=document.getElementById("close-displayAndSeatsReserve"),f=document.getElementById("content__displayAndSeatsReserve"),g=document.getElementById("btnAnnulerSeats"),y=document.getElementById("btnValiderSeats"),h=[],C=E=>{v.style.display="none",r(E)};p?.addEventListener("click",()=>C([])),v.addEventListener("click",E=>{E.target===v&&C([])}),g?.addEventListener("click",()=>C([])),y?.removeEventListener("click",()=>{}),y?.addEventListener("click",()=>{C([...h])});function b(){let E=h.filter(S=>S.startsWith("R0F")).filter(S=>parseInt(S.split("F")[1],10)<d).length,L=h.length-E;E===o&&L+o===i?(y?.classList.remove("inactif"),y&&(y.disabled=!1)):(y?.classList.add("inactif"),y&&(y.disabled=!0))}if(f)for(let E=0;E<a;E++){let L=document.createElement("div");L.style.display="flex",L.style.flexDirection="row",L.style.margin="2px 0";let S=document.createElement("span");S.textContent=`R${E} `,S.style.width="40px",S.style.textAlign="right",L.appendChild(S);for(let B=0;B<c;B++){let x=`R${E}F${B}`;if(l&&l.includes(x)){let D=document.createElement("div");D.style.width="30px",D.style.height="30px",D.style.marginRight="4px",D.style.border="1px solid transparent",D.style.cursor="default",L.appendChild(D);continue}let _=document.createElement("div");_.style.width="30px",_.style.height="30px",_.style.marginRight="4px",_.style.display="flex",_.style.alignItems="center",_.style.justifyContent="center",_.style.cursor="pointer",_.style.fontSize="0.7em",_.style.borderRadius="4px",E===0&&B<d&&(_.textContent="PMR"),s&&s.includes(x)?(_.style.backgroundColor="red",_.style.cursor="not-allowed"):(_.style.backgroundColor="lightgray",_.removeEventListener("click",()=>R(this,void 0,void 0,function*(){})),_.addEventListener("click",()=>R(this,void 0,void 0,function*(){let D=E===0&&B<d;if(h.includes(x))h.splice(h.indexOf(x),1),_.style.backgroundColor="lightgray";else{if(h.length>=i){yield $(`Vous ne pouvez pas d\xE9passer un total de ${i} places.`);return}let T=h.filter(Q=>Q.startsWith("R0F")).filter(Q=>parseInt(Q.split("F")[1],10)<d).length,j=h.length-T;if(D){if(T>=o){alert(`Vous ne devez s\xE9lectionner que ${o} place(s) PMR maximum.`);return}}else if(j>=i-o){alert(`Vous ne pouvez s\xE9lectionner que ${i-o} place(s) classiques maximum.`);return}h.push(x),_.style.backgroundColor="green"}b()}))),L.appendChild(_)}f.appendChild(L)}b()})})}var R,lt=P(()=>{"use strict";st();pe();N();ye();ie();Ee();wt();R=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});function Be(){return Z(this,arguments,void 0,function*(n="Veuillez vous connecter...",e=!1){let t=document.getElementById("modal-loginEmail");if(!t){let y=document.createElement("div");y.innerHTML=wo,document.body.appendChild(y),t=document.getElementById("modal-loginEmail")}if(!t){console.error("Impossible de cr\xE9er / trouver #modal-loginEmail");return}t.style.display="flex";let i=()=>{t.style.display="none"},o=document.getElementById("close-loginEmail"),s=document.getElementById("loginEmail-submit"),l=document.getElementById("loginCreateAccount"),a=document.getElementById("loginForgotPassword"),c=document.getElementById("loginCloseModal");o?.addEventListener("click",i),t.addEventListener("click",y=>{y.target===t&&i()}),c&&c.addEventListener("click",i),l&&(l.removeEventListener("click",y=>Z(this,void 0,void 0,function*(){})),l.addEventListener("click",y=>Z(this,void 0,void 0,function*(){y.preventDefault(),y.stopPropagation(),alert("La cr\xE9ation de compte sera r\xE9alis\xE9e lors de votre premi\xE8re r\xE9servation.")}))),a&&(a.removeEventListener("click",y=>Z(this,void 0,void 0,function*(){})),a.addEventListener("click",y=>Z(this,void 0,void 0,function*(){y.preventDefault(),y.stopPropagation();let h=document.getElementById("loginEmail-email");if(!h||!K(h.value.trim())){alert("Email invalide (exemple: utilisateur@domaine.com)");return}Do(h.value.trim()),i()})));let d=document.getElementById("invite-p"),r=document.getElementById("loginEmail-email"),u=document.getElementById("loginEmail-password"),v=document.getElementById("email-error"),p=document.getElementById("login-error");d?d.innerHTML="<p>"+n+"</p>":console.log("Pas d'invite dans la modale"),r.disabled=!e;function f(){return r.value.trim()!==""&&u.value.trim()!==""}function g(){let y=K(r.value),h=f();a&&l&&(y?(a.classList.remove("inactif"),a.disabled=!1,l.classList.add("inactif"),l.disabled=!0):(a.classList.add("inactif"),a.disabled=!0,l.classList.remove("inactif"),l.disabled=!1)),y&&h?(s.classList.remove("inactif"),s.disabled=!1,p.hidden=!0):(s.classList.add("inactif"),s.disabled=!0)}e||(r.value=m.selectedUtilisateurMail||""),s.classList.add("inactif"),v.textContent="",r.addEventListener("blur",()=>{K(r.value)?v.textContent="":(v.textContent="Email invalide (exemple: utilisateur@domaine.com)",v.style.color="red")}),r.addEventListener("input",g),u.addEventListener("input",g),s&&(s.removeEventListener("click",y=>Z(this,void 0,void 0,function*(){})),s.addEventListener("click",y=>Z(this,void 0,void 0,function*(){if(y.preventDefault(),y.stopPropagation(),m.reservationState===I.ReserveToConfirm)try{yield Gt(r.value.trim(),u.value.trim()),console.log("Connexion workflow reservation r\xE9ussie"),t&&(t.style.display="none"),k.ident=r.value.trim(),yield k.init(),yield mn();let h=k.profil();window.location.href=h}catch(h){console.log(h),p.hidden=!1,p.textContent=h,p.style.color="red"}else try{yield Gt(r.value.trim(),u.value.trim()),console.log("Connexion simple r\xE9ussie"),t&&(t.style.display="none"),console.log("email logu\xE9 = ",r.value.trim()),k.ident=r.value.trim(),console.log("ident stock\xE9e = ",k.ident),yield k.init(),console.log("Compte charge = ",k.compte());let h=k.profil();console.log("Page redirig\xE9e",h),window.location.href=h}catch(h){console.log(h),p.hidden=!1,p.textContent=h,p.style.color="red"}}))),g()})}function Do(n){let e=`
    <div id="modal-reinitPass" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <h2>R\xE9initialisation de votre mot de passe</h2>
                <span class="close-modal" id="close-reinitPass">\xD7</span>
            </div>
            <div class="modal__content">
                <p>Si l'email que vous avez fourni (${n}) est valide, vous allez recevoir un code pour changer votre mot de passe.</p>
                <button id="reinit-continue" class="button button-primary">Continuer</button>
            </div>
        </div>
    </div>
    `,t=document.createElement("div");t.innerHTML=e,document.body.appendChild(t);let i=document.getElementById("modal-reinitPass");i&&(i.style.display="flex");let o=document.getElementById("close-reinitPass"),s=document.getElementById("reinit-continue"),l=()=>{i&&(i.style.display="none")};o?.addEventListener("click",l),i?.addEventListener("click",a=>{a.target===i&&l()}),s?.removeEventListener("click",()=>Z(this,void 0,void 0,function*(){})),s?.addEventListener("click",()=>Z(this,void 0,void 0,function*(){Kt(n),l(),Io(n)}))}function Io(n){let e=`
    <div id="modal-newPass" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <h2>Changer votre mot de passe</h2>
                <span class="close-modal" id="close-newPass">\xD7</span>
            </div>
            <div class="modal__content">
                <p>Veuillez renseigner le code re\xE7u par email, ainsi que votre nouveau mot de passe.</p>
                <div class="form__group">
                    <label for="newPass-code">Code \xE0 6 chiffres :</label>
                    <input type="text" id="newPass-code" placeholder="123456" />
                </div>
                <div class="form__group">
                    <label for="newPass-p1">Nouveau mot de passe :</label>
                    <input type="password" id="newPass-p1" />
                </div>
                <div class="form__group">
                    <label for="newPass-p2">Confirmez le mot de passe :</label>
                    <input type="password" id="newPass-p2" />
                </div>
                <small>8 caract\xE8res minimum, incluant majuscules, minuscules, un caract\xE8re sp\xE9cial et un chiffre.</small>
                <div class="form__group" style="margin-top:10px; display:flex; gap:10px;">
                    <button id="btnResendCode" class="button">Renvoyer un code</button>
                    <button id="btnValidateNewPass" class="button inactif" disabled>Valider</button>
                </div>
            </div>
        </div>
    </div>
    `,t=document.createElement("div");t.innerHTML=e,document.body.appendChild(t);let i=document.getElementById("modal-newPass");i&&(i.style.display="flex");let o=document.getElementById("close-newPass"),s=document.getElementById("newPass-code"),l=document.getElementById("newPass-p1"),a=document.getElementById("newPass-p2"),c=document.getElementById("btnResendCode"),d=document.getElementById("btnValidateNewPass"),r=()=>{i&&(i.style.display="none")};o?.addEventListener("click",r),i?.addEventListener("click",v=>{v.target===i&&r()});function u(){if(!s||!l||!a||!d)return;let v=s.value.trim(),p=l.value.trim(),f=a.value.trim(),g=/^[0-9]{6}$/.test(v),y=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(p);g&&y&&p===f?(d.disabled=!1,d.classList.remove("inactif")):(d.disabled=!0,d.classList.add("inactif"))}s?.addEventListener("input",u),l?.addEventListener("input",u),a?.addEventListener("input",u),c.disabled=!1,c.classList.remove("inactif"),c?.removeEventListener("click",()=>Z(this,void 0,void 0,function*(){})),c?.addEventListener("click",()=>Z(this,void 0,void 0,function*(){Kt(n),yield $("Nous vous avons renvoy\xE9 un code."),c.disabled=!0,c.classList.add("inactif")})),d?.addEventListener("click",()=>Z(this,void 0,void 0,function*(){if(!s||!l)return;let v=s.value.trim(),p=l.value.trim(),f=yield Ao(n,v,p);f==="OK"?(yield $("Changement de mot de passe r\xE9ussi, vous pouvez vous connecter."),r(),window.location.reload()):yield $("Erreur : "+f+` 
Recommencez`)}))}function Ao(n,e,t){return Z(this,void 0,void 0,function*(){return yield Gn(n,e,t),"OK"})}function It(){return Z(this,void 0,void 0,function*(){try{localStorage.removeItem("jwtAccessToken"),k.invalidate(),window.location.href="visiteur.html"}catch(n){console.error(n)}})}var Z,wo,wt=P(()=>{"use strict";N();N();pe();Ee();ie();lt();ye();Z=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},wo=`
  <!-- Modale loginWithEmail -->  
  <div id="modal-loginEmail" class="modal">
    <div class="modal__content-wrapper">
      <div class="modal__title">
        <div class="title__loginEmail title-h2">
          <h2>Connexion</h2>
        </div>
        <span class="close-modal" id="close-loginEmail">\xD7</span>
      </div>
      <div class="modal__content">
        <div class="title-p" id="invite-p">
            <p>Veuillez vous connecter pour valider la r\xE9servation.</p>
        </div>
        <div class="form__group">
            <label for="loginEmail-email">Email :</label>
            <input type="email" id="loginEmail-email" class="input__mail" disabled />
            <span id="email-error" class="error-message"></span>
        </div>
        <div class="form__group">
            <label for="loginEmail-password">Mot de passe :</label>
            <input type="password" id="loginEmail-password" />
        </div>
        <span id="login-error" class="error-message" hidden="true">-</span>
  
        <div class="form__group" style="margin-top: 15px; display: flex; flex-direction: row; gap: 10px;">
            <button id="loginCreateAccount" class="button button-secondary">Cr\xE9er votre compte</button>
            <button id="loginForgotPassword" class="button button-secondary">Mot de passe oubli\xE9</button>
            <button id="loginCloseModal" class="button">Fermer</button>
            <button id="loginEmail-submit" class="button button-primary inactif" disabled>Valider</button>
        </div>
      </div>
    </div>
  </div>
  `});var At,Ci=P(()=>{"use strict";At=class{constructor(e,t,i,o,s=!1,l,a){this.emailDest=e,this.subject=t,this.body=i,this.emailFrom=o,this.isHtml=s,this.cc=l,this.bcc=a}}});function pn(){var n;let e=document.getElementById("modal-contact");if(e||(e=document.createElement("div"),e.id="modal-contact",e.classList.add("modal"),document.body.appendChild(e)),!e)return;let t=(n=k.compte())===null||n===void 0?void 0:n.email,i="";t&&K(t)&&(i=t);let o=`
  <div class="modal__content-wrapper">
    <div class="modal__title">
      <div class="title__Contact title-h2">
        <h2>Formulaire de contact</h2>
      </div>
      <span class="close-modal" id="close-contact">\xD7</span>
    </div>
    <div class="modal__content" id="content__Contact">
    <div class="form__group">
      
      <input type="text" id="contact-mail" placeholder="Adresse mail de r\xE9ponse (facultatif)" value="${i}" />
      <input type="text" id="contact-titre" placeholder="Quel est le sujet de votre demande ?" />
      <div>
      <label for="contact-desc">Dites nous en plus</label>
      <textarea id="contact-desc" rows="4" cols="40" placeholder="D\xE9tailler votre demande"></textarea>
      </div>
      <div class="modal__btns">
        <button id="contactAnnulerBtn" class="button">Annuler</button>
        <button id="contactEnvoyerBtn" class="button inactif" disabled>Envoyer votre demande</button>
      </div>
      <div>
      <span id="contact-error" style="color: red; font-size: 0.9em; display: none;"></span>
      </div>
    </div>
    </div>
  </div>
  `;e.innerHTML=o,document.body.appendChild(e),e.style.display="flex";let s=document.getElementById("close-contact"),l=document.getElementById("contact-mail"),a=document.getElementById("contact-titre"),c=document.getElementById("contact-desc"),d=document.getElementById("contactAnnulerBtn"),r=document.getElementById("contactEnvoyerBtn"),u=document.getElementById("contact-error"),v=()=>{e.style.display="none"};function p(){let h=l?.value.trim()||"";if(h&&!K(h)){f("Veuillez indiquer un email valide si vous souhaitez un retour."),y(!0);return}if(!(a?.value.trim()||"").split(/\s+/).some(x=>x.length>=3)){f("Veuillez pr\xE9ciser le sujet de votre demande"),y(!0);return}if((c?.value.trim()||"").split(/\s+/).filter(Boolean).filter(x=>x.length>=2).length<3){f("Veuillez d\xE9crire plus pr\xE9cis\xE9ment votre demande en 3 mots."),y(!0);return}g(),y(!1)}function f(h){u&&(u.style.display="inline",u.textContent=h)}function g(){u&&(u.style.display="none",u.textContent="")}function y(h){r&&(h?(r.classList.add("inactif"),r.disabled=!0):(r.classList.remove("inactif"),r.disabled=!1))}l?.addEventListener("input",p),a?.addEventListener("input",p),c?.addEventListener("input",p),s?.addEventListener("click",v),e.addEventListener("click",h=>{h.target===e&&v()}),d?.addEventListener("click",v),r?.addEventListener("click",()=>Mo(this,void 0,void 0,function*(){y(!0),r.classList.add("loading");let h=l?.value.trim()||"",C=a?.value.trim()||"",b=c?.value.trim()||"",E=new At(h,C,b,"false");try{let L=yield Yn(E);console.log("Resultat envoi mail = "+L.statut),L.statut.startsWith("OK")?yield $(`
        Votre demande a bien \xE9t\xE9 envoy\xE9e !

        Mail : ${h||"Pas de mail"}
        Titre : ${C}
        Description : ${b}`):yield $(`
        Nous n'avons pas pu envoyer votre demande.
        Merci de la renouveler ult\xE9rieurement.`)}catch(L){yield $("Erreur r\xE9seau ou serveur, veuillez r\xE9essayer."),console.error("Erreur lors de l'envoi du mail",L)}finally{r.classList.remove("loading"),y(!1),v()}})),p()}var Mo,Ei=P(()=>{"use strict";N();Ee();Ci();ie();N();Mo=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});function J(){return Si(this,void 0,void 0,function*(){console.log("===== chargerMenu");let n=k.profil();console.log("Profil charge depuis global= ",n);let e=document.querySelector(".header");if(!e){console.warn("Aucun \xE9l\xE9ment .header trouv\xE9");return}let t=document.querySelector(".nav__logo-img");switch(n){case W.Visiteur:bi(),e.style.background="linear-gradient(90deg, #F8F8FF 0%, #999999 100%)";break;case W.Utilisateur:{if(!localStorage.getItem("jwtAccessToken")){k.invalidate(),window.location.href="visiteur.html";return}Bo(),e.style.background="linear-gradient(90deg, #F8F8FF 0%, rgba(218, 165, 32, 0.25) 100%)";break}case W.Administrateur:{if(!localStorage.getItem("jwtAccessToken")){k.invalidate(),window.location.href="visiteur.html";return}Fo(),e.style.background="linear-gradient(90deg, #F8F8FF 0%, rgba(178, 34, 34, 0.3) 100%)",t||console.error("Pas de logo"),t.src="assets/camera-cinephoria-admin.png";break}case W.Employee:{if(!localStorage.getItem("jwtAccessToken")){k.invalidate(),window.location.href="visiteur.html";return}ko(),e.style.background="linear-gradient(90deg, #F8F8FF 0%, rgba(34, 139, 34, 0.25) 100%)",t||console.error("Pas de logo"),t.src="assets/camera-cinephoria-employe.png";break}default:console.error("Profil inconnu, on consid\xE8re Visiteur"),bi(),e.style.background="linear-gradient(90deg, #F8F8FF 0%, #999999 100%)";break}})}function bi(){let n=document.querySelector(".nav__actions"),e=document.querySelector(".mobile-menu__nav");if(!n||!e)return;n.innerHTML="",e.innerHTML="";let t=ke("R\xE9servation","reservation.html"),i=ke("Films","films.html"),o=ke("Contact","#");o.addEventListener("click",l=>{l.preventDefault(),pn()});let s=document.createElement("button");s.classList.add("nav__actions-button","nav__actions-button--signin"),s.textContent="Connexion",s.addEventListener("click",()=>{Be("Saisissez votre email et votre mot de passe",!0)}),n.append(t,i,o,s),e.append(t.cloneNode(!0),i.cloneNode(!0),o.cloneNode(!0),s.cloneNode(!0))}function Bo(){let n=document.querySelector(".nav__actions"),e=document.querySelector(".mobile-menu__nav");if(!n||!e)return;n.innerHTML="",e.innerHTML="";let t=ke("Mes R\xE9servations","mesreservations.html"),i=ke("Reservation","reservation.html"),o=ke("Films","films.html"),s=ke("Contact","#");s.addEventListener("click",c=>{c.preventDefault(),pn()});let l=fn(),a=document.createElement("button");a.classList.add("nav__actions-button","nav__actions-button--signin"),a.textContent=l,a.addEventListener("click",()=>Si(this,void 0,void 0,function*(){yield It()})),n.append(t,i,o,s,a),e.append(t.cloneNode(!0),i.cloneNode(!0),o.cloneNode(!0),s.cloneNode(!0),a.cloneNode(!0))}function Fo(){let n=document.querySelector(".nav__actions"),e=document.querySelector(".mobile-menu__nav");if(!n||!e)return;n.innerHTML="",e.innerHTML="";let t=To(),i=fn(),o=document.createElement("button");o.classList.add("nav__actions-button","nav__actions-button--signin"),o.textContent=i,o.addEventListener("click",()=>{It()}),n.append(t,o),e.append(t.cloneNode(!0),o.cloneNode(!0))}function ko(){let n=document.querySelector(".nav__actions"),e=document.querySelector(".mobile-menu__nav");if(!n||!e)return;n.innerHTML="",e.innerHTML="";let t=Uo(),i=fn(),o=document.createElement("button");o.classList.add("nav__actions-button","nav__actions-button--signin"),o.textContent=i,o.addEventListener("click",()=>{It()}),n.append(t,o),e.append(t.cloneNode(!0),o.cloneNode(!0))}function To(){let n=document.createElement("div");n.style.position="relative";let e=document.createElement("button");e.textContent="Intranet",e.classList.add("nav__actions-button","nav__actions-button--link");let t=document.createElement("div");t.style.display="none",t.style.position="absolute",t.style.zIndex="1000",t.style.top="100%",t.style.left="0",t.style.backgroundColor="#F8F8FF",t.style.border="1px solid #999";let i=be("Mod\xE9rer les avis","manageAvis.html"),o=be("G\xE9rer les films","manageFilms.html"),s=be("G\xE9rer les salles","manageSalles.html"),l=be("G\xE9rer les comptes employ\xE9s","manageEmployes.html"),a=be("Dashboard","dashboard.html");return t.append(i,o,s,l,a),e.addEventListener("mouseover",()=>{t.style.display="block"}),e.addEventListener("mouseout",c=>{let d=c.relatedTarget;t.contains(d)||(t.style.display="none")}),t.addEventListener("mouseleave",()=>{t.style.display="none"}),n.append(e,t),n}function Uo(){let n=document.createElement("div");n.style.position="relative";let e=document.createElement("button");e.textContent="Intranet",e.classList.add("nav__actions-button","nav__actions-button--link");let t=document.createElement("div");t.style.display="none",t.style.position="absolute",t.style.zIndex="1000",t.style.top="100%",t.style.left="0",t.style.backgroundColor="#F8F8FF",t.style.border="1px solid #999";let i=be("G\xE9rer les films","manageFilms.html"),o=be("G\xE9rer les salles","manageSalles.html"),s=be("G\xE9rer les s\xE9ances","manageSeances.html"),l=be("Moderer les avis","manageAvis.html");return t.append(i,o,s,l),e.addEventListener("mouseover",()=>{t.style.display="block"}),e.addEventListener("mouseout",a=>{let c=a.relatedTarget;t.contains(c)||(t.style.display="none")}),t.addEventListener("mouseleave",()=>{t.style.display="none"}),n.append(e,t),n}function ke(n,e){let t=document.createElement("a");return t.classList.add("nav__actions-button","nav__actions-button--link"),t.textContent=n,t.href=e,t}function fn(){let n=k.compte(),e=n?.utilisateurDisplayName||"??",t=e.trim().split(" "),i="";return t.forEach(o=>{o.length>0&&(i+=o[0].toUpperCase())}),i.length===0&&(i=e.slice(0,2).toUpperCase()),i==="?"&&(i="D\xE9connexion"),i}function be(n,e){let t=document.createElement("div");t.classList.add("submenu-level2-item");let i=document.createElement("a");return i.href=e,i.textContent=n,i.style.textDecoration="none",i.style.color="#000000",t.appendChild(i),t}var Si,ve=P(()=>{"use strict";Ee();wt();Ei();Si=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});var xi={};ge(xi,{onLoadVisiteur:()=>Po});function Po(){return Mt(this,void 0,void 0,function*(){console.log(" ===>  onLoadVisiteur"),yield De,console.log("Donn\xE9es charg\xE9es, traitement de la page VisiteurFilms..."),yield J(),yield O();let n=document.getElementById("films-container");if(n){n.innerHTML="";try{let{films:e,message:t}=m.filmsSortiesRecentes,i=document.querySelector(".title__left-h1");i&&(i.textContent=t),e.forEach(s=>{let l=document.createElement("div");l.classList.add("filmsreservation__film"),l.innerHTML="",l.innerHTML=`
          <div class="film__cardreservation"> <!-- Card pour chaque film-->
            <div class="cardreservation__image">
              <img src="${z(s.imageFilm1024)}" class="cardreservation__image-img" alt="Affiche du film ${s.titleFilm}">
            </div>
            <div class="cardreservation__description">
                <h2 class="cardreservation__description-title">${s.titleFilm}</h2>
                <div class="description__evaluation">
                ${s.isCoupDeCoeur?'<div class="evaluation__coupdecoeur"><p class="evaluation__coupdecoeur-p">Coup de coeur</p><img src="assets/heart.svg" alt="Coeur" class="evaluation__coupdecoeur-img"></div>':""}
                    <div class="evaluation__note">
                        <p class="evaluation__note-p">Avis : ${s.note} / 5</p>
                    </div>
                </div>
                <div class="description__pitch">
                    <p class="description__pitch-p">${s.filmPitch}</p>
                </div>
            </div>
            <div class="cardreservation__reserver">
                <button class="cardreservation__reserver-button">Bande Annonce</button>
            </div>
          </div>
        `,n.appendChild(l);let a=l.querySelector(".cardreservation__reserver-button");a&&(a.removeEventListener("click",d=>Mt(this,void 0,void 0,function*(){})),a.addEventListener("click",d=>Mt(this,void 0,void 0,function*(){d.preventDefault(),d.stopPropagation();let r=`modalyoutube-${s.id}`,u=document.getElementById(r);u||(u=document.createElement("div"),u.id=r,u.className="modalyoutube",document.body.appendChild(u)),s.linkBO&&Ro(s.linkBO,u)})));let c=l.querySelector(".cardreservation__image-img");c&&(c.style.cursor="pointer",c.addEventListener("click",d=>Mt(this,void 0,void 0,function*(){d.preventDefault(),d.stopPropagation(),m.selectedFilmUUID=s.id||"",console.log("Visiteur ",s.id),m.filterNameCinema="all",yield m.sauverEtatGlobal(),window.location.href="films.html"})))});let o=document.getElementById("progressIndicator");o&&(o.style.display="none")}catch(e){console.error("Erreur lors du chargement des films",e)}finally{let e=document.getElementById("progressIndicator");e?(e.style.removeProperty("display"),e.style.display="none",e.classList.add("hidden"),console.log("Descativation progress")):console.error("Pas d'indicateur")}}})}function Ro(n,e){let t=`
        <div class="modalyoutube-content">
            <span class="closeyoutube">&times;</span>
            <!-- Vid\xE9o YouTube -->
            <iframe id="youtubeVideo" width="560" height="315" src="${n}?autoplay=1" title="YouTube video player" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
            </iframe>
        </div>
  `;e.innerHTML="",e.innerHTML=t;let i=e?.querySelector(".closeyoutube");if(e&&i){let o=()=>{e.style.display="none";let s=e.querySelector("iframe");s&&(s.src="")};i.removeEventListener("click",o),i.addEventListener("click",o),e.addEventListener("click",s=>{s.target===e&&o()}),e.style.display="flex"}}var Mt,Li=P(()=>{"use strict";pe();ve();le();N();Mt=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});var Di={};ge(Di,{onLoadMesReservations:()=>hn,updateTableMesReservations:()=>wi});function hn(){return Se(this,void 0,void 0,function*(){var n,e;console.log("=====> chargement onLoadMesReservations");try{yield De,console.log("Donn\xE9es charg\xE9es, traitement de la page Mes reservations..."),yield J(),yield O();let t;if(!((n=k.compte())===null||n===void 0)&&n.utilisateurid)t=((e=k.compte())===null||e===void 0?void 0:e.utilisateurid)||"";else{console.error("Pas d'utilisateur connu");return}try{let i=yield Vn(t);if(i=i.filter(o=>![I.ReserveCanceled,I.ReserveDeleted].includes(o.stateReservation)),console.log(i),i.length===0){let o=document.getElementById("mesreservations-table-container");if(o){o.innerHTML="";let s=document.createElement("p");s.textContent="Vous n'avez pas de reservation active ou historis\xE9e.",o.appendChild(s)}}else{let o=document.getElementById("mesreservations-table-container");if(o){o.innerHTML="";let s=wi(i);o.appendChild(s)}}}catch(i){console.log("Erreur recup\xE9ration des reservations = ",i)}}catch(t){console.log("Erreur recup\xE9ration des reservations = ",t)}})}function wi(n){let e=document.createElement("div");e.classList.add("tab__mesreservations-liste");let t=document.createElement("table");t.classList.add("tab__mesreservations-liste-table");let i=document.createElement("thead"),o=document.createElement("tr");["Date","Film","Complexe","Note","Vos Commentaires","Places","Montant",""].forEach(a=>{let c=document.createElement("th");c.textContent=a,o.appendChild(c)}),i.appendChild(o),t.appendChild(i);let l=document.createElement("tbody");return l.classList.add("liste-table__body"),t.appendChild(l),n.forEach(a=>{var c,d,r;let u=a.seanceId;u?console.log("resaSeanceId =",u):console.error("resa.seanceId est undefined ou null !");let v=m.allSeances.find(_=>_.seanceId===u);if(!v){console.error(`\u274C Pas de s\xE9ance trouv\xE9e pour seanceId = ${u}`);return}let p=document.createElement("tr"),f=document.createElement("td"),g=document.createElement("button");g.classList.add("tab__mesreservations-liste-button"),g.textContent=No(new Date(a.dateJour||"")),g.addEventListener("click",()=>{$o(a,v)}),f.appendChild(g),p.appendChild(f);let y=document.createElement("td");y.textContent=a.titleFilm||"",p.appendChild(y);let h=document.createElement("td");h.textContent=a.nameCinema||"",p.appendChild(h),console.log("-------"+a.dateJour+"-"+v.hourBeginHHSMM);let C=a.stateReservation;if(C===I.ReserveConfirmed){let _=new Date(a.dateJour);if(!_)return;let D=v.hourBeginHHSMM||"00:00",[T,j]=D.split(":").map(Number),Q=new Date(_.getFullYear(),_.getMonth(),_.getDate(),T,j);new Date>Q&&(C=I.DoneUnevaluated,Et(a.reservationId,I.DoneUnevaluated))}if(C===I.ReserveConfirmed){let _=document.createElement("td");_.setAttribute("colspan","2"),_.style.backgroundColor="#fff7dc",_.textContent="Vous pourrez apporter une note et un avis apr\xE8s avoir vu le film",p.appendChild(_)}else if(C===I.DoneUnevaluated){let _=document.createElement("td");_.setAttribute("colspan","2");let D=document.createElement("button");D.textContent="Donnez nous votre avis sur ce film \u270E",D.classList.add("tab__mesreservations-liste-button"),D.addEventListener("click",()=>{vn(a)}),_.appendChild(D),p.appendChild(_)}else if(C===I.DoneEvaluated){let _=document.createElement("td");_.textContent=((c=a.note)===null||c===void 0?void 0:c.toString())||"0",_.style.cursor="pointer",_.addEventListener("click",()=>{vn(a,!0)}),p.appendChild(_);let D=document.createElement("td");D.textContent=a.evaluation||"",D.style.cursor="pointer",console.log("Eval = "+a.isEvaluationMustBeReview),a.isEvaluationMustBeReview?(D.style.backgroundColor="#f0f0f0",D.title="Votre commentaire sera publi\xE9 apr\xE8s relecture"):D.title="Votre commentaire a \xE9t\xE9 valid\xE9. Vous pouvez le modifier, il sera republi\xE9 apr\xE8s relecture",D.addEventListener("click",()=>{vn(a,!0)}),p.appendChild(D)}else{let _=document.createElement("td");_.setAttribute("colspan","2"),_.textContent="",p.appendChild(_)}let b=document.createElement("td");b.textContent=((d=a.totalSeats)===null||d===void 0?void 0:d.toString())||"0",p.appendChild(b);let E=document.createElement("td"),L=((r=a.totalPrice)===null||r===void 0?void 0:r.toFixed(2))||"0.00";E.textContent=`${L} \u20AC`,p.appendChild(E);let S=document.createElement("td"),B=document.createElement("button");B.classList.add("button");let x="";if(C===I.ReserveConfirmed?x="Annuler":[I.DoneEvaluated,I.DoneUnevaluated].includes(C)&&(x="Effacer"),x!==""){if(C===I.ReserveConfirmed){let _=document.createElement("button");_.classList.add("button"),_.textContent="QRCode",_.style.marginRight="5px",_.addEventListener("click",()=>Se(this,void 0,void 0,function*(){qo(yield zn(a.reservationId))})),S.appendChild(_)}B.textContent=x,B.addEventListener("click",()=>{Oo(a,x)}),S.appendChild(B),p.appendChild(S)}l.appendChild(p)}),e.appendChild(t),e}function No(n){if(!n)return"";let e=String(n.getDate()).padStart(2,"0"),t=String(n.getMonth()+1).padStart(2,"0"),i=n.getFullYear();return`${e}/${t}/${i}`}function $o(n,e){return Se(this,void 0,void 0,function*(){let t=e;yield m.updateSeances([t.seanceId]),t=m.seanceById(e.seanceId);let i=`  
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <div class="title__detailReservation title-h2">
                    <h2>D\xE9tail de la r\xE9servation</h2>
                </div>
                <!-- Bouton (X) ou autre m\xE9canisme pour fermer la modale si besoin -->
                <span class="close-modal" id="close-detailReservation">\xD7</span>
            </div>
            <div class="modal__content" id="content__DetailReservation" >
                
            </div>
        </div>`,o=document.getElementById("modal-detailReservation");if(!o)return;o.innerHTML=i,document.body.appendChild(o);let s=document.getElementById("close-detailReservation"),l=document.getElementById("content__DetailReservation");if(o&&s&&l){let a=()=>{o.style.display="none",window.location.reload()};s.addEventListener("click",a),o.addEventListener("click",r=>{r.target===o&&a()});let c=Ie(t,new Date(n.dateJour||""),"",!1);l.appendChild(c);let d=yield rt(t.qualite||"",!0,n.reservationId);if(l.appendChild(d),n.numberPMR&&n.numberPMR>0){let r=document.createElement("p");r.textContent=n.numberPMR+" place"+(n.numberPMR>1?"s P.M.R.":" P.M.R."),l.appendChild(r)}if(n.seatsReserved&&n.seatsReserved!==""){let r=n.seatsReserved.includes(",")?"s":"",u=document.createElement("p");u.textContent=`Si\xE8ge${r} r\xE9serv\xE9${r} : ${n.seatsReserved}`,l.appendChild(u)}o.style.display="flex"}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal modal-detailReservation sont introuvables.")})}function vn(n,e=!1){let t=document.getElementById("modal-evaluationReservation"),i="Comment avez-vous trouv\xE9 le film ?",o="Votre note : ",s="Choisissez ",l="",a=null;if(e&&(i="Modifiez votre \xE9valuation",o="Changer la note ("+n.note.toString()+") : ",s=n.note.toString(),a=n.note.toString(),l=n.evaluation),!t)return;let c=`
    <div class="modal__content-wrapper">
        <div class="modal__title">
            <div class="title__evaluationReservation title-h2">
                <h2>${i}</h2>
            </div>
            <span class="close-modal" id="close-evaluationReservation">\xD7</span>
        </div>
        <div class="modal__content" id="content__EvaluationReservation">
            <div>
                <label for="eval-note">${o}<span style="color: red;">*</span></label>
                <div class="title__filter-dropdown">
                    <button class="title__filter-dropdown-button" id="eval-note-button">${s}<span class="chevron">\u25BC</span>
                    </button>
                    <div class="title__filter-button-drowdown-content" id="eval-note-dropdown">
                        ${[0,.5,1,1.5,2,2.5,3,3.5,4,4.5,5].map(h=>`<a href="#" data-value="${h}">${h}</a>`).join("")}
                    </div>
                </div>
                <span id="eval-error" style="color: red; font-size: 0.8em; display: none;">Note obligatoire</span>
            </div>
            <label for="eval-text">Commentaire :</label>
            <textarea id="eval-text" rows="4" cols="40">${l}</textarea>
            <div class="modal__btns">
                <button id="evalAnnulerBtn" class="button">Annuler</button>
                <button id="evalEnregistrerBtn" class="button inactif" disabled>Enregistrer</button>
            </div>
        </div>
    </div>`;t.innerHTML=c,document.body.appendChild(t),t.style.display="flex";let d=document.getElementById("close-evaluationReservation"),r=document.getElementById("eval-note-button"),u=document.getElementById("eval-note-dropdown"),v=document.getElementById("eval-text"),p=document.getElementById("eval-error"),f=document.getElementById("evalEnregistrerBtn"),g=document.getElementById("evalAnnulerBtn"),y=()=>{t.style.display="none"};r?.addEventListener("click",h=>{h.stopPropagation(),u.classList.toggle("show")}),e&&(p.style.display="none",f.classList.remove("inactif"),f.disabled=!1),u?.querySelectorAll("a").forEach(h=>{h.addEventListener("click",C=>{C.preventDefault(),a=h.getAttribute("data-value"),r.innerHTML=`${a} <span class="chevron">\u25BC</span>`,u.classList.remove("show"),a&&(p.style.display="none",f.classList.remove("inactif"),f.disabled=!1)})}),document.addEventListener("click",h=>{r.contains(h.target)||u.classList.remove("show")}),d?.addEventListener("click",y),t.addEventListener("click",h=>{h.target===t&&y()}),g?.addEventListener("click",y),f?.addEventListener("click",()=>Se(this,void 0,void 0,function*(){if(!a){p.style.display="inline";return}let h=v.value.trim();console.log("Note enregistr\xE9e :",a),console.log("Commentaire :",h),yield qn(n.reservationId,parseFloat(a),h,!0),yield Et(n.reservationId,I.DoneEvaluated),y(),hn()}))}function qo(n){return Se(this,void 0,void 0,function*(){let e=`
    <div class="modal__content-wrapper">
        <div class="modal__title">
            <div class="title__DisplayQRCode title-h2">
                <h2>QRCode \xE0 pr\xE9senter lors de votre venue</h2>
            </div>
            <span class="close-modal" id="close-displayQRCode">\xD7</span>
        </div>
        <div class="modal__content" id="content__DisplayQRCode">
            <div id="qrcode-img">
            </div>
        </div>
    </div>`,t=document.getElementById("modal-DisplayQRCodeLocal");t||(t=document.createElement("div")),t.classList.add("modal"),t.setAttribute("id","modal-DisplayQRCodeLocal"),t.innerHTML="",t.innerHTML=e,document.body.appendChild(t);let i=document.getElementById("qrcode-img");if(!i)return;i.appendChild(n);let o=()=>{t.style.display="none"},s=document.getElementById("close-displayQRCode");s?.addEventListener("click",o),t.addEventListener("click",l=>{l.target===t&&o()}),t.style.display="flex"})}function Oo(n,e){return Se(this,void 0,void 0,function*(){let t,i="",o="",s="";e==="Annuler"&&(t=()=>Se(this,void 0,void 0,function*(){yield bt(n.reservationId)}),i="Etes vous s\xFBr de vouloir annuler cette r\xE9servation ?",o="Annulation de la reservation",s="Je confirmer l'annulation"),e==="Effacer"&&(t=()=>Se(this,void 0,void 0,function*(){yield Et(n.reservationId,I.ReserveDeleted)}),i=`Etes vous s\xFBr de vouloir effacer cette r\xE9servation ? 
        (Nous conserverons la note anonymis\xE9e mais effacerons l'\xE9ventuel commentaire de notre site et les donn\xE9es de la r\xE9servation)`,o="Suppression de la reservation",s="Je confirmer la suppression");let l=document.getElementById("modal-suppressionReservation");if(!l)return;let a=`
    <div class="modal__content-wrapper">
        <div class="modal__title">
            <div class="title__SuppressionReservation title-h2">
                <h2>${o}</h2>
            </div>
            <span class="close-modal" id="close-suppressionReservation">\xD7</span>
        </div>
        <div class="modal__content" id="content__SuppressionReservation">
            <p>${i}</p>
            <div class="modal__btns">
            <button class="button" id="supAnnulerBtn">Annuler</button>
            <button class="button" id="supConfirmerBtn">${s}</button>
            </div>
        </div>
    </div>`;l.innerHTML=a,document.body.appendChild(l),l.style.display="flex";let c=document.getElementById("close-suppressionReservation"),d=document.getElementById("supConfirmerBtn"),r=document.getElementById("supAnnulerBtn"),u=()=>{l.style.display="none"};c?.addEventListener("click",u),l.addEventListener("click",v=>{v.target===l&&u()}),r?.addEventListener("click",u),d&&(d.onclick=()=>Se(this,void 0,void 0,function*(){console.log("Suppression demand\xE9e"),yield t(),u(),yield hn()}))})}var Se,Ii=P(()=>{"use strict";Ee();pe();ve();le();ye();ie();st();lt();Se=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})}});var Mi={};ge(Mi,{onLoadFilms:()=>Jo});function Jo(){return X(this,void 0,void 0,function*(){console.log("=====> chargement onLoadFilms"),yield De,console.log("Donn\xE9es charg\xE9es, traitement de la page Films..."),yield J(),yield O(),yield Ho(),yield Ai(),yield jo(),ct(),document.querySelector("main").style.visibility="visible";let n=document.querySelector(".title__filters");n&&(n.style.visibility="visible");let e=document.getElementById("progressIndicator");e?(e.style.removeProperty("display"),e.style.display="none",e.classList.add("hidden"),console.log("Descativation progress")):console.error("Pas d'indicateur")})}function Ho(){return X(this,void 0,void 0,function*(){function n(s){document.querySelectorAll(".titre__filter-dropdown-complexe").forEach(a=>{a.style.display="block",a.innerHTML=`${s} <span class="chevron">\u25BC</span>`})}let e=document.querySelector(".titre__filter-dropdown-cinema");if(!e)return;let t=e.querySelector(".title__filter-button-drowdown-content");if(!t)return;console.log("Init dropdown Cinema");let i=document.getElementById("titleLeft");i&&(m.filterNameCinema==="all"?i.innerText="Les films de CinePhoria":i.innerText=`Les films de CinePhoria \xE0 ${m.filterNameCinema}`),m.filterNameCinema==="all"?n("Tous les complexes"):n(m.filterNameCinema),t.querySelectorAll("a").forEach(s=>{s.removeEventListener("click",l=>X(this,void 0,void 0,function*(){})),s.addEventListener("click",l=>X(this,void 0,void 0,function*(){var a;l.preventDefault();let c=((a=s.dataset.cinema)===null||a===void 0?void 0:a.trim())||"";c==="Tous les complexes"?m.filterNameCinema="all":m.filterNameCinema=c,console.log("Choix du filtre Cinema = ",m.filterNameCinema),n(c);let d=document.getElementById("titleLeft");d&&(m.filterNameCinema==="all"?d.innerText="Les films de CinePhoria":d.innerText=`Les films de CinePhoria \xE0 ${c}`),yield m.init(),yield Ai(),yield Ft(),yield ct()}))})})}function Ai(){return X(this,void 0,void 0,function*(){function n(o){let s=document.getElementById("title__filter-dropdown-button-genre");s&&(s.innerHTML=`${o} <span class="chevron">\u25BC</span>`)}let e=document.querySelector(".titre__filter-dropdown-genre");if(!e)return;let t=e.querySelector(".title__filter-button-drowdown-content");if(!t)return;t.innerHTML="";let i=document.createElement("a");i.href="#",i.textContent="Tous les genres",i.addEventListener("click",o=>X(this,void 0,void 0,function*(){o.preventDefault(),m.filterGenre="all",n("Tous les genres"),yield Ft(),yield ct()})),t.appendChild(i),m.genreSet.forEach(o=>{let s=document.createElement("a");s.href="#",s.textContent=o,s.addEventListener("click",l=>X(this,void 0,void 0,function*(){l.preventDefault(),m.filterGenre=o,n(o),yield Ft(),yield ct()})),t.appendChild(s)})})}function jo(){return X(this,void 0,void 0,function*(){let n=document.querySelector(".title__filters-films");if(!n)return;let e=document.createElement("input");e.type="date",e.classList.add("filter-jour-input"),n.prepend(e),e.removeEventListener("change",()=>X(this,void 0,void 0,function*(){})),e.addEventListener("change",()=>X(this,void 0,void 0,function*(){gn=e.value,yield ct()})),yield Ft()})}function Ft(){return X(this,void 0,void 0,function*(){let n=document.querySelector(".filter-jour-input");if(!n)return;let e=m.filmsGenre,t=new Set(e.map(s=>s.id)),o=m.seances.filter(s=>s.filmId!==void 0&&t.has(s.filmId)).map(s=>s.dateJour).filter(Boolean).sort();if(o.length>0){let s=U(new Date(o[0])),l=U(new Date(o[o.length-1]));n.min=s,n.max=l}else n.min="",n.max=""})}function ct(){return X(this,void 0,void 0,function*(){let n=document.querySelector(".films__listFilms");if(!n)return;n.innerHTML="";let e=m.filmsGenre;if(gn&&(e=e.filter(t=>m.seancesFilm(t.id).some(o=>o.dateJour?U(new Date(o.dateJour))===gn:!1))),e.forEach(t=>{let i=Vo(t);n.appendChild(i)}),e.length>0){let t=m.selectedFilmUUID;if(t){let i=e.find(o=>o.id===t);i&&yn(i)}else yn(e[0])}else Yo()})}function Vo(n){var e,t,i,o;let s=document.createElement("div");s.classList.add("listFilms__simpleCard");let l=document.createElement("img");l.src=`${z((e=n.imageFilm1024)!==null&&e!==void 0?e:"")}`,l.alt="Affiche",l.classList.add("simpleCard__affiche-img");let a=document.createElement("div");a.classList.add("simpleCard__detail");let c=document.createElement("p");c.classList.add("simpleCard__detail-titre-p"),c.textContent=(t=n.titleFilm)!==null&&t!==void 0?t:"Sans Titre";let d=document.createElement("div");if(d.classList.add("simpleCard__evaluation"),n.isCoupDeCoeur){let p=document.createElement("div");p.classList.add("evaluation__coupdecoeur");let f=document.createElement("p");f.classList.add("evaluation__coupdecoeur-p"),f.textContent="Coup de coeur";let g=document.createElement("img");g.src="assets/heart.svg",g.alt="Coeur",g.classList.add("evaluation__coupdecoeur-img"),p.append(f,g),d.appendChild(p)}let r=document.createElement("div");r.classList.add("evaluation__note");let u=document.createElement("p");u.classList.add("evaluation__note-p"),u.textContent=`Avis : ${(i=n.note)!==null&&i!==void 0?i:0} / 5`,r.appendChild(u),d.appendChild(r);let v=document.createElement("p");return v.classList.add("simpleCard__detail-pitch-p"),v.textContent=(o=n.filmPitch)!==null&&o!==void 0?o:"",a.append(c,d,v),s.append(l,a),s.addEventListener("click",()=>{yn(n)}),s}function yn(n){return X(this,void 0,void 0,function*(){var e,t,i,o,s,l,a,c,d;let r=document.querySelector(".films__detailFilm");if(!r)return;let u=r.querySelector(".twocolumns__left-img");u&&(u.src=`${z((e=n.imageFilm1024)!==null&&e!==void 0?e:"")}`,u.alt=(t=n.titleFilm)!==null&&t!==void 0?t:"Affiche");let v=r.querySelector(".right__title-p");v&&(v.textContent=(i=n.titleFilm)!==null&&i!==void 0?i:"");let p=r.querySelector(".caractFilm__genre-p");p&&(p.textContent=(o=n.genreArray)!==null&&o!==void 0?o:"");let f=r.querySelector(".caractFilm__duree-p");f&&(f.textContent=(s=n.duration)!==null&&s!==void 0?s:"");let g=r.querySelector(".caractFilm__public-p");g&&(g.textContent=(l=n.categorySeeing)!==null&&l!==void 0?l:"");let y=r.querySelector(".right__description-p");y&&(y.textContent=(a=n.filmDescription)!==null&&a!==void 0?a:"");let h=r.querySelector(".right__author-p");h&&(h.textContent=(c=n.filmAuthor)!==null&&c!==void 0?c:"");let C=r.querySelector(".right__distribution");C&&(C.textContent=(d=n.filmDistribution)!==null&&d!==void 0?d:"");let b=n.linkBO;b&&Go(b);let E=r.querySelector(".right__film");if(!E)return;let L=E.querySelector(".table-scroll");L&&L.remove();let S=zo(n);E.appendChild(S);let B=r.querySelector(".right__jereserve-button");B&&(B.disabled=!0,B.addEventListener("click",()=>X(this,void 0,void 0,function*(){if(!_n)yield $("Veuillez s\xE9lectionner une s\xE9ance dans la liste.");else if(["ReserveCompteToConfirm","ReserveMailToConfirm","ReserveToConfirm"].includes(m.reservationState)&&se(m.selectedReservationUUID||"")&&se(m.selectedSeanceUUID||""))yield $("Une autre r\xE9servation est en cours, vous devez la finaliser ou l'annuler avant d'en effectuer une nouvelle"),window.location.href="reservation.html";else{let{Jour:x,Cinema:_,Horaire:D,Qualite:T,Tarifs:j,SeanceId:Q}=_n,xe=m.seances.find(po=>po.seanceId===Q),Le=yield m.getSeanceFromDB([Q]),ht=-1;Le[0].numFreeSeats&&(ht=parseInt(Le[0].numFreeSeats,10)),xe&&ht>0?(m.filterNameCinema=_,m.selectedSeanceUUID=Q,m.selectedFilmUUID=xe.filmId||"",m.selectedSeanceDate=new Date(xe.dateJour||""),m.reservationState=I.PendingChoiceSeats,yield m.sauverEtatGlobal(),window.location.href="reservation.html",yield $(`S\xE9ance s\xE9lectionn\xE9e :
Jour : ${x}
Cin\xE9ma : ${_}
Horaire : ${D}
Qualit\xE9 : ${T}
Tarifs : ${j}`)):yield $("La s\xE9ance est compl\xE8te")}})))})}function Yo(){let n=document.querySelector(".films__detailFilm");if(!n)return;let e=n.querySelector(".twocolumns__left-img");e&&(e.src="")}function zo(n){let e=document.createElement("div");e.classList.add("table-scroll");let t=document.createElement("table");t.classList.add("tabseance__commande-table");let i=document.createElement("thead"),o=document.createElement("tr");["Jour","Cin\xE9ma","Horaire","Qualit\xE9","Tarifs"].forEach(d=>{let r=document.createElement("th");r.textContent=d,o.appendChild(r)}),i.appendChild(o),t.appendChild(i);let s=document.createElement("tbody");t.appendChild(s);let l=m.seancesFilm(n.id),a=new Date,c=new Date;return l=l.filter(d=>{var r;if(d.numFreeSeats==="0")return!1;if(d.dateJour){let u=new Date(d.dateJour);if(u.getFullYear()===c.getFullYear()&&u.getMonth()===c.getMonth()&&u.getDate()===c.getDate()){let[v,p]=((r=d.hourBeginHHSMM)!==null&&r!==void 0?r:"00:00").split(":").map(Number),f=new Date(u);f.setHours(v,p,0,0);let g=new Date(a);if(g.setHours(g.getHours()+1),f<g)return!1}}return!0}),l.sort((d,r)=>{var u,v,p,f;return d.dateJour===r.dateJour?((u=d.hourBeginHHSMM)!==null&&u!==void 0?u:"").localeCompare((v=r.hourBeginHHSMM)!==null&&v!==void 0?v:""):((p=d.dateJour)!==null&&p!==void 0?p:"").localeCompare((f=r.dateJour)!==null&&f!==void 0?f:"")}),l.forEach(d=>{let r=document.createElement("tr"),u=U(new Date(d.dateJour||"")),v=d.nameCinema||"",p=`${d.hourBeginHHSMM||""} - ${d.hourEndHHSMM||""}`,f=d.qualite||"",g=m.allTarifQualite.filter(S=>S.qualite===f).map(S=>`${S.nameTarif} (${S.price}\u20AC)`).join(", "),y=d.seanceId,h=document.createElement("td");h.textContent=u;let C=document.createElement("td");C.textContent=v;let b=document.createElement("td");b.textContent=p;let E=document.createElement("td");E.textContent=f;let L=document.createElement("td");L.textContent=g,r.append(h,C,b,E,L),r.addEventListener("click",()=>{Bt&&Bt!==r&&Bt.classList.remove("selected-row"),r.classList.add("selected-row"),Bt=r,_n={Jour:u,Cinema:v,Horaire:p,Qualite:f,Tarifs:g,SeanceId:y};let S=document.querySelector(".right__jereserve-button");S&&(S.disabled=!1)}),s.appendChild(r)}),e.appendChild(t),e}function Go(n){let e=document.getElementById("openModal"),t=document.getElementById("videoModal"),i=t?.querySelector(".closeyoutube"),o=document.getElementById("youtubeVideo"),s=`${n}?autoplay=1`;if(console.log("URL dynamique = ",s),e&&t&&i&&o&&s){e.addEventListener("click",()=>{t.style.display="flex",o.src=s,console.log("URL utilis\xE9e = ",o.src)});let l=()=>{t.style.display="none",o.src=""};i.addEventListener("click",l),t.addEventListener("click",a=>{a.target===t&&l()})}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal sont introuvables.")}var X,gn,_n,Bt,Bi=P(()=>{"use strict";N();pe();N();ye();ve();le();N();X=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},gn="";_n=null,Bt=null});var V,w,Te=P(()=>{"use strict";ie();ie();le();V=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},w=class n{static majVersion(){return V(this,void 0,void 0,function*(){var e,t,i;this.version=yield nt(),dn(((e=this.version.MAJEURE)===null||e===void 0?void 0:e.toString(10))||"",((t=this.version.MINEURE)===null||t===void 0?void 0:t.toString(10))||"",((i=this.version.BUILD)===null||i===void 0?void 0:i.toString(10))||"")})}static allFilms(){return V(this,void 0,void 0,function*(){try{let e=yield nt(),t=yield et();return t.length>0&&(this._filmMustBeFetched=!1,this._allFilms=t),t}catch(e){return this._filmMustBeFetched=!0,console.error(e),this._allFilms=[],[]}})}static createOrUpdateFilm(e){return V(this,void 0,void 0,function*(){try{let t;return this._filmMustBeFetched&&(yield this.allFilms()),this._allFilms.find(o=>o.id===e.id)?t=yield Wn(e.id,e):t=yield Qn(e),t.message==="OK"?(this._filmMustBeFetched=!0,!0):(console.error(t.message),!1)}catch(t){return console.error(t),!1}})}static salleSort(e){return e.sort((t,i)=>{var o,s,l,a;let c=((o=t.nameCinema)===null||o===void 0?void 0:o.toLowerCase())||"",d=((s=i.nameCinema)===null||s===void 0?void 0:s.toLowerCase())||"",r=((l=t.nameSalle)===null||l===void 0?void 0:l.toLowerCase())||"",u=((a=i.nameSalle)===null||a===void 0?void 0:a.toLowerCase())||"";return c<d?-1:c>d?1:r<u?-1:r>u?1:0})}static allSalles(){return V(this,void 0,void 0,function*(){try{let e=this.salleSort(yield Zt());return e.length>0&&(this._salleMustBeFetched=!1,this._allSalles=e),e}catch(e){return this._salleMustBeFetched=!0,console.error(e),this._allSalles=[],[]}})}static createOrUpdateSalle(e){return V(this,void 0,void 0,function*(){try{let t;return this._salleMustBeFetched&&(yield this.allSalles()),this._allSalles.find(o=>o.id===e.id)?t=yield xt(e.id,e):t=yield St(e),t.message==="OK"?(this._salleMustBeFetched=!0,!0):(console.error(t.message),!1)}catch(t){return console.error(t),!1}})}static get filterNameCinema(){return n._filterNameCinema||"all"}static set filterNameCinema(e){if(e.trim()==="")throw new Error("Le nom du cin\xE9ma ne peut pas \xEAtre vide.");n._filterNameCinema=e.trim()}static seanceSort(e){return e.sort((t,i)=>{var o,s,l,a,c,d,r,u;let v=((o=t.titleFilm)===null||o===void 0?void 0:o.toLowerCase())||"",p=((s=i.titleFilm)===null||s===void 0?void 0:s.toLowerCase())||"",f=((l=t.nameSalle)===null||l===void 0?void 0:l.toLowerCase())||"",g=((a=i.nameSalle)===null||a===void 0?void 0:a.toLowerCase())||"",y=((c=t.dateJour)===null||c===void 0?void 0:c.toLowerCase())||"",h=((d=i.dateJour)===null||d===void 0?void 0:d.toLowerCase())||"",C=((r=t.hourBeginHHSMM)===null||r===void 0?void 0:r.toLowerCase())||"",b=((u=i.hourBeginHHSMM)===null||u===void 0?void 0:u.toLowerCase())||"";return y<h?-1:y>h?1:f<g?-1:f>g?1:C<b?-1:C>b?1:0})}static getSeancesDisplayFilter(){return V(this,void 0,void 0,function*(){try{return n.seanceSort(yield Xt([n._filterNameCinema||"all"]))}catch(e){return console.error(`Erreur dans recherche des seanceDisplay : ${e}`),[]}})}static getSeancesDisplayByCinema(e){return V(this,void 0,void 0,function*(){try{return n.seanceSort(yield Xt(e))}catch(t){return console.error(`Erreur dans recherche des seanceDisplay : ${t}`),[]}})}static createOrUpdateSeance(e){return V(this,void 0,void 0,function*(){let t={message:""};try{try{(yield ti(e.id))?t.message="update":t.message="create"}catch{t.message="create"}return t.message==="create"?t=yield ei(e):t=yield ni(e.id,e),t}catch(i){switch(t.message){case"":console.error(`Erreur dans la recherche de seance : ${i} , id = ${e.id}`);break;case"update":console.error(`Erreur dans l'update de seance : ${i}, seance = ${JSON.stringify(e)}`);break;case"create":console.error(`Erreur dans le create de seance : ${i}, seance = ${JSON.stringify(e)}`);break;default:console.error(`Erreur inconue dans le create/update de seance : ${i}, seance = ${JSON.stringify(e)}`);break}return t}})}static getListFilmsAll(){return V(this,void 0,void 0,function*(){try{let e=yield et();return Array.from(new Map(e.filter(i=>i.id&&i.titleFilm&&i.isActiveForNewSeances).map(i=>[i.id,{id:i.id,titre:i.titleFilm,duration:i.duration,affiche:i.imageFilm128}])).values())}catch(e){return console.error(`Erreur recup\xE9ration ListFilmsAll : ${e}`),[]}})}static getSallesByFilter(){return V(this,void 0,void 0,function*(){try{let e="";n._filterNameCinema?e=n._filterNameCinema:e="all";let t=[];e==="all"?t=yield Zt():t=yield Zn(e);let i;return e==="all"?i=Array.from(new Map(t.filter(o=>o.id&&o.nameSalle).map(o=>[o.id,{id:o.id,nomSalle:o.nameCinema+"-"+o.nameSalle,capacite:o.capacity,numPMR:o.numPMR,nameCinema:o.nameCinema}])).values()):i=Array.from(new Map(t.filter(o=>o.id&&o.nameSalle).map(o=>[o.id,{id:o.id,nomSalle:o.nameSalle,capacite:o.capacity,numPMR:o.numPMR}])).values()),i}catch(e){return console.error(`Erreur recup\xE9ration ListFilmsAll : ${e}`),[]}})}static reservationSort(e){return e.sort((t,i)=>{var o,s,l,a,c,d;let r=((o=t.titleFilm)===null||o===void 0?void 0:o.toLowerCase())||"",u=((s=i.titleFilm)===null||s===void 0?void 0:s.toLowerCase())||"",v=((l=t.displayName)===null||l===void 0?void 0:l.toLowerCase())||"",p=((a=i.displayName)===null||a===void 0?void 0:a.toLowerCase())||"",f=((c=t.dateJour)===null||c===void 0?void 0:c.toLowerCase())||"",g=((d=i.dateJour)===null||d===void 0?void 0:d.toLowerCase())||"";return f<g?-1:f>g?1:r<u?-1:r>u?1:v<p?-1:v>p?1:0})}static getReservationForUtilisateurFilter(){return V(this,void 0,void 0,function*(){try{return n.reservationSort(yield en([n._filterNameCinema||"all"]))}catch(e){return console.error(`Erreur dans recherche des reservations : ${e}`),[]}})}static getReservationForUtilisateurByCinema(e){return V(this,void 0,void 0,function*(){try{return n.reservationSort(yield en(e))}catch(t){return console.error(`Erreur dans recherche des reservations : ${t}`),[]}})}static updateReservationAvis(e){return V(this,void 0,void 0,function*(){let t={message:""};try{return t=yield oi(e.id,e),t}catch(i){return console.error(`Erreur inconue dans la mise \xE0 jour de l'avis : ${i}, Avis = ${JSON.stringify(e)}`),t}})}static getListEmployesAll(){return V(this,void 0,void 0,function*(){try{return yield si()}catch(e){return console.error(`Erreur recup\xE9ration ListEmployesAll : ${e}`),[]}})}static getEmployesByMatricule(e){return V(this,void 0,void 0,function*(){try{return yield tn(e)}catch(t){console.error(`Erreur recup\xE9ration ListEmployesAll : ${t}`)}})}static createOrUpdateEmploye(e,t){return V(this,void 0,void 0,function*(){let i={message:""};try{try{(yield tn(e.matricule))?i.message="update":i.message="create"}catch{i.message="create"}return i.message==="create"?i=yield ri(e,t):i=yield li(e,t),i}catch(o){switch(i.message){case"":console.error(`Erreur dans la recherche de employe : ${o} , matricule = ${e.matricule}`);break;case"update":console.error(`Erreur dans l'update de employe : ${o}, employe = ${JSON.stringify(e)}`);break;case"create":console.error(`Erreur dans le create de employe : ${o}, employe = ${JSON.stringify(e)}`);break;default:console.error(`Erreur inconue dans le create/update de employe : ${o}, employe = ${JSON.stringify(e)}`);break}throw o}})}static deleteEmploye(e){return V(this,void 0,void 0,function*(){try{yield ai(e)}catch(t){console.log("Erreur delete Employ\xE9",t)}})}static getReservationStatsAll(){return V(this,void 0,void 0,function*(){try{return yield di()}catch(e){return console.error(`Erreur recup\xE9ration ReservationState : ${e}`),[]}})}constructor(){console.log("DataCIntranet : Initialisation")}};w.version={idInt:0,MAJEURE:0,MINEURE:0,BUILD:0,dateMaj:new Date("01/01/1980")};w._filmMustBeFetched=!0;w._allFilms=[];w._salleMustBeFetched=!0;w._allSalles=[]});var Ui={};ge(Ui,{onLoadManageFilms:()=>Qo});function Qo(){return ee(this,void 0,void 0,function*(){console.log("=====> chargement onLoadManageFilms"),yield J(),yield O(),yield w.majVersion(),yield Cn(),Wo(),Ti(),mt(!1)})}function Cn(){return ee(this,void 0,void 0,function*(){let n=document.querySelector(".films__listFilms");if(!n)return;n.innerHTML="";let e=yield w.allFilms();if(e.forEach(t=>{let i=Ko(t);n.appendChild(i)}),e.length>0?(q=e[0],Tt(q)):ki(),q){let t=[...n.querySelectorAll(".listFilms__simpleCard")].find(i=>{var o,s;return(o=i.textContent)===null||o===void 0?void 0:o.includes((s=q?.titleFilm)!==null&&s!==void 0?s:"")});t&&t.scrollIntoView({behavior:"smooth",block:"center"})}})}function Ko(n){var e,t,i,o;let s=document.createElement("div");s.classList.add("listFilms__simpleCard");let l=document.createElement("img");l.src=z((e=n.imageFilm1024)!==null&&e!==void 0?e:""),l.alt="Affiche",l.classList.add("simpleCard__affiche-img");let a=document.createElement("div");a.classList.add("simpleCard__detail");let c=document.createElement("p");c.classList.add("simpleCard__detail-titre-p"),c.textContent=(t=n.titleFilm)!==null&&t!==void 0?t:"Sans Titre";let d=document.createElement("div");if(d.classList.add("simpleCard__evaluation"),n.isCoupDeCoeur){let p=document.createElement("div");p.classList.add("evaluation__coupdecoeur");let f=document.createElement("p");f.classList.add("evaluation__coupdecoeur-p"),f.textContent="Coup de coeur";let g=document.createElement("img");g.src="assets/heart.svg",g.alt="Coeur",g.classList.add("evaluation__coupdecoeur-img"),p.append(f,g),d.appendChild(p)}let r=document.createElement("div");r.classList.add("evaluation__note");let u=document.createElement("p");u.classList.add("evaluation__note-p"),u.textContent=`Avis : ${(i=n.note)!==null&&i!==void 0?i:0} / 5`,r.appendChild(u),d.appendChild(r);let v=document.createElement("p");return v.classList.add("simpleCard__detail-pitch-p"),v.textContent=(o=n.filmPitch)!==null&&o!==void 0?o:"",a.append(c,d,v),s.append(l,a),s.addEventListener("click",()=>ee(this,void 0,void 0,function*(){console.log("filmId selectionne = ",n.id),q=n,Tt(n)})),n.isActiveForNewSeances?(l.classList.remove("simpleCard__affiche-img--disabled"),s.classList.remove("listFilms__simpleCard--disabled")):(l.classList.add("simpleCard__affiche-img--disabled"),s.classList.add("listFilms__simpleCard--disabled")),s}function ki(){document.querySelector(".films__detailFilm")}function Ti(){let n=document.getElementById("upload128");n&&(n.value=""),n?.removeEventListener("change",t=>ee(this,void 0,void 0,function*(){})),n?.addEventListener("change",t=>ee(this,void 0,void 0,function*(){var i;let o=(i=n.files)===null||i===void 0?void 0:i[0];if(!o.type.startsWith("image/jpeg")&&!o.type.startsWith("image/png")){alert("Seuls les fichiers JPEG ou PNG sont autoris\xE9s.");return}if(o){ae=o;let s=document.getElementById("affiche-small");s&&(s.src=URL.createObjectURL(o))}}));let e=document.getElementById("upload1024");e&&(e.value=""),e?.removeEventListener("change",t=>ee(this,void 0,void 0,function*(){})),e?.addEventListener("change",t=>ee(this,void 0,void 0,function*(){var i;let o=(i=e.files)===null||i===void 0?void 0:i[0];if(!o.type.startsWith("image/jpeg")&&!o.type.startsWith("image/png")){alert("Seuls les fichiers JPEG ou PNG sont autoris\xE9s.");return}if(o){de=o,console.log("Selected file 1024 =>",o.name);let s=document.getElementById("affiche-large");s&&(s.src=URL.createObjectURL(o))}}))}function Wo(){let n=document.getElementById("title__right-button-Ajouter"),e=document.getElementById("title__right-button-Modifier"),t=document.getElementById("title__right-button-Annuler");if(!n||!e||!t){console.error("Missing one of the action buttons in .right__actions");return}n.style.display="inline-block",e.style.display="inline-block",t.style.display="none",n.removeEventListener("click",()=>{}),n.addEventListener("click",Zo),e.removeEventListener("click",()=>ee(this,void 0,void 0,function*(){})),e.addEventListener("click",()=>ee(this,void 0,void 0,function*(){return yield Xo()})),t.removeEventListener("click",()=>ee(this,void 0,void 0,function*(){})),t.addEventListener("click",()=>ee(this,void 0,void 0,function*(){return yield es()}))}function Zo(){ut=!0,Je=!0,ae=null,de=null;let n=new $e({id:crypto.randomUUID()});q=n,Tt(n),kt(!0),mt(!0);let e=document.getElementById("title__right-button-Modifier");e&&(e.textContent="Enregistrer")}function kt(n){let e=document.getElementById("title__right-button-Ajouter"),t=document.getElementById("title__right-button-Modifier"),i=document.getElementById("title__right-button-Annuler");!e||!t||!i||(n?(e.style.display="none",i.style.display="inline-block",t.textContent="Enregistrer",Fi(!0),t.classList.add("inactif"),t.disabled=!0):(e.style.display="inline-block",i.style.display="none",t.textContent="Modifier",Fi(!1),t.classList.remove("inactif"),t.disabled=!1))}function Xo(){return ee(this,void 0,void 0,function*(){if(Je)yield ts();else{Je=!0,ut=!1,kt(!0),mt(!0);let n=document.getElementById("title__right-button-Modifier");n&&(n.textContent="Enregistrer")}})}function es(){return ee(this,void 0,void 0,function*(){if(!Je)return;Je=!1,ut=!1,ae=null,de=null,kt(!1),mt(!1);let n=m.selectedFilmUUID;n?yield Kn(n).then(e=>Tt(e)).catch(e=>console.error(e)):ki()})}function Fi(n){["titleFilm","genreArray","duration","linkBO","note","filmDescription","filmAuthor","filmDistribution","filmPitch"].forEach(t=>{let i=document.getElementById(t);(i instanceof HTMLInputElement||i instanceof HTMLDivElement)&&(n?(i.addEventListener("input",Ue),i.addEventListener("blur",Ue)):(i.removeEventListener("input",Ue),i.removeEventListener("blur",Ue)))})}function ts(){return ee(this,void 0,void 0,function*(){let n=ns();if(n)try{let e="";if(ut?(console.log("Film created => id=",n.id),n.dateSortieCinePhoria=U(Fn()),ae&&(n.imageFilm128=n?.id+"128",yield tt(n.imageFilm128,ae,128,ae.type)),de&&(n.imageFilm1024=n?.id+"1024",yield tt(n.imageFilm1024,de,1024,de.type)),e="Film cr\xE9\xE9 avec succ\xE8s"):(console.log("Film updated => id=",n.id),ae&&(/^\d+-128\.jpg$/.test(n.imageFilm128)?(n.imageFilm128=n?.id+"128",yield tt(n.imageFilm128,ae,128,ae.type)):yield Wt(n.imageFilm128,ae,128,ae.type)),de&&(/^\d+-1024\.jpg$/.test(n.imageFilm1024)?(n.imageFilm1024=n?.id+"1024",yield tt(n.imageFilm1024,de,1024,de.type)):yield Wt(n.imageFilm1024,de,1024,de.type)),e="Film mis \xE0 jour avec succ\xE8s"),!(yield w.createOrUpdateFilm(n)))throw new Error("Erreur: dans la cr\xE9ation ou mise \xE0 jour de film");alert(e),yield Cn()}catch(e){console.error("Erreur save film =>",e),alert("Erreur => "+e)}finally{Je=!1,ut=!1,ae=null,de=null,kt(!1),mt(!1),q=n,yield Cn(),Ti()}})}function ns(){var n,e,t,i,o,s,l,a,c;if(q===void 0)return;let d=q;console.log("On sauvegarde = "+d.titleFilm);let r=document.getElementById("titleFilm");r&&(d.titleFilm=((n=r.textContent)===null||n===void 0?void 0:n.trim())||"");let u=document.getElementById("genreArray");u&&(d.genreArray=((e=u.textContent)===null||e===void 0?void 0:e.trim())||"");let v=document.getElementById("filmPitch");v&&(d.filmPitch=((t=v.textContent)===null||t===void 0?void 0:t.trim())||"");let p=document.getElementById("filmAuthor");p&&(d.filmAuthor=((i=p.textContent)===null||i===void 0?void 0:i.trim())||"");let f=document.getElementById("filmDistribution");f&&(d.filmDistribution=((o=f.textContent)===null||o===void 0?void 0:o.trim())||"");let g=document.getElementById("filmDescription");g&&(d.filmDescription=((s=g.textContent)===null||s===void 0?void 0:s.trim())||"");let y=document.getElementById("linkBO");y&&(d.linkBO=((l=y.textContent)===null||l===void 0?void 0:l.trim())||"");let h=document.getElementById("duration");h&&(d.duration=((a=h.textContent)===null||a===void 0?void 0:a.trim())||"");let C=document.getElementById("coupCoeur");C&&(d.isCoupDeCoeur=C.checked);let b=document.getElementById("title__filter-dropdown-button-genre");b&&(d.categorySeeing=((c=b.textContent)===null||c===void 0?void 0:c.replace("\u25BC","").trim())||"TP");let E=document.getElementById("isActiveForNewSeances");return E&&(d.isActiveForNewSeances=E.checked),d}function Tt(n){var e,t,i,o,s,l,a,c,d,r,u;let v=document.getElementById("affiche-small");v&&(v.src=n.imageFilm128?z(n.imageFilm128):"https://dummyimage.com/128x128/DAA520/000");let p=document.getElementById("affiche-large");p&&(p.src=n.imageFilm1024?z(n.imageFilm1024):"https://dummyimage.com/1024x1024/DAA520/000");let f=document.getElementById("titleFilm");f&&(f.textContent=(e=n.titleFilm)!==null&&e!==void 0?e:"");let g=document.getElementById("genreArray");g&&(g.textContent=(t=n.genreArray)!==null&&t!==void 0?t:"");let y=document.getElementById("filmPitch");y&&(y.textContent=(i=n.filmPitch)!==null&&i!==void 0?i:"");let h=document.getElementById("filmAuthor");h&&(h.textContent=(o=n.filmAuthor)!==null&&o!==void 0?o:"");let C=document.getElementById("filmDistribution");C&&(C.textContent=(s=n.filmDistribution)!==null&&s!==void 0?s:"");let b=document.getElementById("filmDescription");b&&(b.textContent=(l=n.filmDescription)!==null&&l!==void 0?l:"");let E=document.getElementById("linkBO");E&&(E.textContent=(a=n.linkBO)!==null&&a!==void 0?a:"");let L=document.getElementById("duration");L&&(L.textContent=(c=n.duration)!==null&&c!==void 0?c:"");let S=document.getElementById("coupCoeur");S&&(S.checked=(d=n.isCoupDeCoeur)!==null&&d!==void 0?d:!1);let B=document.getElementById("title__filter-dropdown-button-genre"),x=document.querySelector(".title__filter-button-drowdown-content");B&&x?(B.innerHTML=`${(r=n.categorySeeing)!==null&&r!==void 0?r:"TP"}<span class="chevron">\u25BC</span>`,B.addEventListener("click",D=>{D.stopPropagation(),x.classList.toggle("show")}),document.addEventListener("click",()=>{x.classList.remove("show")}),x.querySelectorAll(".categorie-item").forEach(D=>{D.removeEventListener("click",T=>{}),D.addEventListener("click",T=>{if(B.disabled)return;console.log("listener ",T.target.textContent||"TP"),T.preventDefault();let j=T.target.textContent||"TP";B.innerHTML=`${j}<span class="chevron">\u25BC</span>`,x.classList.remove("show"),Ue()})})):console.error("Pas de dropdown");let _=document.getElementById("isActiveForNewSeances");_&&(_.checked=(u=n.isActiveForNewSeances)!==null&&u!==void 0?u:!1),S?.addEventListener("change",Ue),_?.addEventListener("change",Ue)}function mt(n){["titleFilm","genreArray","filmAuthor","duration","filmPitch","filmDistribution","linkBO","filmDescription"].forEach(o=>{let s=document.getElementById(o);s&&(s.contentEditable=n?"true":"false",s.style.border=n?"1px solid #000":"none",s.style.background=n?"rgba(255, 215, 0, 0.1)":"#FFF")}),document.getElementById("upload128").hidden=!n,document.getElementById("upload1024").hidden=!n,["isActiveForNewSeances","coupCoeur"].forEach(o=>{let s=document.getElementById(o);s&&(s.disabled=!n)});let t=document.getElementById("title__filter-dropdown-button-genre");t&&(n?(t.classList.remove("inactif"),t.disabled=!1):(t.classList.add("inactif"),t.disabled=!0));let i=document.getElementById("title__filter-listcategorie")}function is(){return["titleFilm","genreArray","filmAuthor","duration","filmDistribution","linkBO","filmDescription"].every(e=>{let t=document.getElementById(e);if(t)return t?.innerText.trim().length>0})}function os(){if(!q)return!1;let n=(o,s)=>{let l=document.getElementById(o);return l?.innerText.trim()!==(s||"")};if(n("titleFilm",q.titleFilm)||n("genreArray",q.genreArray)||n("filmAuthor",q.filmAuthor)||n("duration",q.duration)||n("filmDistribution",q.filmDistribution)||n("linkBO",q.linkBO)||n("filmDescription",q.filmDescription)||n("filmPitch",q.filmPitch))return!0;let e=document.getElementById("title__filter-dropdown-button-genre");if(e?.innerText.trim().split("\u25BC")[0].trim()!==(q.categorySeeing||"TP"))return!0;let t=document.getElementById("coupCoeur");if(t?.checked!==!!q.isCoupDeCoeur)return!0;let i=document.getElementById("isActiveForNewSeances");return i?.checked!==!!q.isActiveForNewSeances}function Ue(){let n=document.getElementById("title__right-button-Modifier");n&&(n.disabled=!(is()&&os()),n.classList.toggle("inactif",n.disabled))}var ee,Je,ut,ae,de,q,Pi=P(()=>{"use strict";pe();Te();N();on();ve();le();ie();ee=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Je=!1,ut=!1,ae=null,de=null});var Ut,Ri=P(()=>{"use strict";Ut=class{constructor(e){Object.assign(this,e)}}});var ji={};ge(ji,{createCinemaDropdown:()=>qi,initFormulaireSalles:()=>bn,onClickDisplaySiegeAbsent:()=>Hi,onLoadManageSalles:()=>Pt,updateTableSalles:()=>$i});function Pt(){return oe(this,void 0,void 0,function*(){var n;console.log("=====> chargement onLoadManageSalles"),yield J(),yield O(),yield w.majVersion();let e;k&&(e=k.compte(),e&&e.listCinemas&&(je=(n=e.listCinemas)===null||n===void 0?void 0:n.split(",").map(t=>t.trim().replace(/^"|"$/g,"")),Ni=e.listCinemas)),console.log("List Cinemas autoris\xE9s = ",Ni,je),yield ss()})}function ss(){return oe(this,void 0,void 0,function*(){let n=document.getElementById("salles-table-container");if(!n){console.error("Pas de container");return}n.innerHTML="";let e=(yield w.allSalles()).filter(i=>je.includes(i.nameCinema)),t=yield $i(e);n.appendChild(t),Re(t),bn("create")})}function $i(n){return oe(this,void 0,void 0,function*(){let e=document.createElement("div");e.classList.add("tab__salles-liste");let t=document.createElement("table");t.classList.add("tab__salles-liste-table");let i=document.createElement("thead"),o=document.createElement("tr");["Complexe","Salle","Capacit\xE9","# places PMR","# rang\xE9s","# fauteuils","Plan salle","Actions"].forEach(r=>{let u=document.createElement("th");u.textContent=r,o.appendChild(u)}),i.appendChild(o),t.appendChild(i);let l=document.createElement("tbody");l.classList.add("liste-table__body"),t.appendChild(l);let a=yield Oi("tr","td","create");a.classList.add("sticky-row"),l.appendChild(a);let c=document.createElement("td"),d=document.createElement("button");return d.textContent="Ajouter une salle",d.classList.add("tab__salles-liste-button"),d.addEventListener("click",()=>oe(this,void 0,void 0,function*(){let r=yield Ji(crypto.randomUUID(),"create");yield St(r),Pt()})),c.appendChild(d),c.appendChild(d),a.appendChild(c),l.appendChild(a),n.forEach(r=>{var u,v,p,f;let g=document.createElement("tr"),y=document.createElement("td");y.textContent=r.nameCinema||"",g.appendChild(y);let h=document.createElement("td");h.textContent=r.nameSalle||"",g.appendChild(h);let C=document.createElement("td");C.textContent=((u=r.capacity)===null||u===void 0?void 0:u.toString(10))||"",g.appendChild(C);let b=document.createElement("td");b.textContent=((v=r.numPMR)===null||v===void 0?void 0:v.toString(10))||"",g.appendChild(b);let E=document.createElement("td");E.textContent=((p=r.rMax)===null||p===void 0?void 0:p.toString(10))||"",g.appendChild(E);let L=document.createElement("td");L.textContent=((f=r.fMax)===null||f===void 0?void 0:f.toString(10))||"",g.appendChild(L);let S=document.createElement("td"),B=He(r?.seatsAbsents||"");S.textContent=B===0?"Plan rectangulaire":`${B} desactiv\xE9(s)`,g.appendChild(S);let x=document.createElement("td"),_=document.createElement("div");_.classList.add("modal-content-btns");let D=document.createElement("button");D.classList.add("tab__salles-liste-button"),D.textContent="Editer",D.addEventListener("click",()=>oe(this,void 0,void 0,function*(){yield rs(r)})),_.appendChild(D);let T=document.createElement("button");T.classList.add("tab__salles-liste-button"),T.textContent="Supprimer",T.addEventListener("click",()=>{ls(r.id)}),_.appendChild(T),x.appendChild(_),g.appendChild(x),l.appendChild(g)}),e.appendChild(t),e})}function bn(n){function e(){let a=document.getElementById("seatsAbsentInput"+n),c=document.getElementById("nbSeatsAbsentLabel"+n),d=document.getElementById("divtnPlaces"+n),r=parseInt(t.value,10),u=parseInt(i.value,10),v=a.value,p=0;!Number.isNaN(r)&&!Number.isNaN(u)?(v&&(p=He(v)),d.textContent=(r*u-p).toString(10),c&&(c.textContent=p===0?"Plan rectangulaire":`${p} desactiv\xE9(s)`)):d.textContent=""}let t=document.getElementById("nrMaxInput"+n),i=document.getElementById("nfMaxInput"+n);t.addEventListener("input",e),i.addEventListener("input",e);let o=document.getElementById("planBtn"+n);o.addEventListener("click",()=>oe(this,void 0,void 0,function*(){En=!0;let a=parseInt(document.getElementById("nPlacesPMRInput"+n).value,10),c=parseInt(document.getElementById("nrMaxInput"+n).value,10),d=parseInt(document.getElementById("nfMaxInput"+n).value,10),r=document.getElementById("seatsAbsentInput"+n),u=r.value;if(Number.isNaN(c)||Number.isNaN(d))alert("D\xE9finissez d'abord le rectangle de la salle.");else{let v=yield Hi(c,d,u,a),p=document.getElementById("planBtn"+n),f=He(v);p.textContent=f===0?"Plan rectangulaire":`${f} desactiv\xE9(s)`,v&&(r.value=v),e()}}));let s=document.getElementById("seatsAbsentInput"+n),l=He(s.value);o.textContent=l===0?"Plan rectangulaire":`${l} desactiv\xE9(s)`}function qi(n,e){let t=document.createElement("div");t.style.position="relative";let i=document.createElement("button");i.className="title__filter-dropdown-button titre__filter-dropdown-complexe",i.style.display="block",i.id="titre__filter-dropdown-complexe"+e,i.innerHTML=`${n} <span class="chevron">\u25BC</span>`,t.appendChild(i);let o=document.createElement("div");return o.className="title__filter-button-drowdown-content title__filter-button-drowdown-content-complexe",o.style.display="none",o.style.position="absolute",o.style.zIndex="1000",o.style.backgroundColor="#fff",je.forEach(l=>{let a=document.createElement("a");a.href="#",a.textContent=l,a.dataset.cinema=l,a.addEventListener("click",c=>{c.preventDefault(),i.innerHTML=`${l} <span class="chevron">\u25BC</span>`,o.style.display="none"}),o.appendChild(a)}),t.appendChild(o),i.addEventListener("click",l=>{l.stopPropagation(),o.style.display=o.style.display==="block"?"none":"block"}),document.addEventListener("click",()=>o.style.display="none"),t}function rs(n){return oe(this,void 0,void 0,function*(){let e=document.getElementById("modal-editSalle");e||(e=document.createElement("div"),e.id="modal-editSalle",e.classList.add("modal"),document.body.appendChild(e),e.innerHTML="");let i=`
    <div class="modal__content-wrapper">
        <div class="modal__title">
            <div class="title__editSalle title-h2">
                <h2>${`${n.nameSalle} \xE0 ${n.nameCinema}`}</h2>
            </div>
            <span class="close-modal" id="close-editSalle">\xD7</span>
        </div>
        <div class="modal__content form__group" id="content__editSalle" flex-direction>
        </div>
    </div>`;e.innerHTML=i,e.style.zIndex="1000",document.body.appendChild(e),e.style.display="flex";let o=document.getElementById("close-editSalle"),s=()=>{e.style.display="none",e.remove};o?.addEventListener("click",s),e.addEventListener("click",u=>{u.target===e&&s()});let l=document.getElementById("content__editSalle"),a=yield Oi("div","div","table",n);l.appendChild(a),bn("table");let c=document.createElement("div");c.classList.add("modal-content-btns");let d=document.createElement("button");d.classList.add("button"),d.id="annBtn",d.textContent="Annuler",c.appendChild(d),d?.addEventListener("click",s);let r=document.createElement("button");r.classList.add("button"),r.id="saveButton",c.appendChild(r),r.textContent="Enregistrer",c.appendChild(r),r.removeEventListener("click",()=>oe(this,void 0,void 0,function*(){})),r.addEventListener("click",()=>oe(this,void 0,void 0,function*(){let u=yield Ji(n.id,"table");yield xt(n.id,u),s(),Pt()})),l.appendChild(c)})}function ls(n){return oe(this,void 0,void 0,function*(){try{yield Xn(n),Pt()}catch(e){alert("Suppression impossible "+e)}})}function Oi(n,e,t,i){return oe(this,void 0,void 0,function*(){let o=document.createElement(n),s=document.createElement(e);s.appendChild(qi(i?.nameCinema||je[0],t)),t==="table"&&s.classList.add("form__group"),o.appendChild(s);let l=document.createElement(e),a=document.createElement("input");if(a.type="text",a.id="nameSalleInput"+t,a.placeholder="Nom de la salle",i?.nameSalle&&(a.value=i.nameSalle),a.required=!0,t==="table"){l.classList.add("form__group");let E=document.createElement("label");E.htmlFor="nameSalleInput"+t,E.textContent="Nom de la salle :",l.appendChild(E)}l.appendChild(a),o.appendChild(l);let c=document.createElement(e),d=document.createElement("label");d.id="divtnPlaces"+t,d.textContent=((i?.fMax||0)*(i?.rMax||0)-He(i?.seatsAbsents||"")).toString(10),t==="table"&&(l.classList.add("form__group"),d.textContent="Capacit\xE9 : "+d.textContent),c.appendChild(d),o.appendChild(c);let r=document.createElement(e),u=document.createElement("input");if(u.type="numeric",u.id="nPlacesPMRInput"+t,u.placeholder="Places PMR",u.required=!0,u.step="1",u.max="20",u.min="0",i?.numPMR&&(u.value=i.numPMR.toString(10)),t==="table"){r.classList.add("form__group");let E=document.createElement("label");E.htmlFor="nPlacesPMRInput"+t,E.textContent="Nombre de places PMR :",r.appendChild(E)}r.appendChild(u),o.appendChild(r);let v=document.createElement(e),p=document.createElement("input");if(p.type="numeric",p.id="nrMaxInput"+t,p.placeholder="Nombre rang\xE9es",p.required=!0,p.step="1",p.max="50",p.min="5",i?.rMax&&(p.value=i.rMax.toString(10)),t==="table"){v.classList.add("form__group");let E=document.createElement("label");E.htmlFor="nrMaxInput"+t,E.textContent="Nombre de rang\xE9es :",v.appendChild(E)}v.appendChild(p),o.appendChild(v);let f=document.createElement(e),g=document.createElement("input");if(g.type="numeric",g.id="nfMaxInput"+t,g.placeholder="Nombre fauteuils par rang\xE9e",g.required=!0,g.step="1",g.max="50",g.min="5",t==="table"){f.classList.add("form__group");let E=document.createElement("label");E.htmlFor="nfMaxInput"+t,E.textContent="Nombre de fauteuils par rang\xE9es :",f.appendChild(E)}i?.fMax&&(g.value=i.fMax.toString(10)),f.appendChild(g);let y=document.createElement(e),h=document.createElement("input");h.type="hidden",h.id="seatsAbsentInput"+t,i?.seatsAbsents&&(h.value=i.seatsAbsents),f.appendChild(h),o.appendChild(f);let C=document.createElement("td"),b=document.createElement("button");return b.classList.add("tab__salles-liste-button"),b.textContent="D\xE9finir...",b.id="planBtn"+t,C.appendChild(b),o.appendChild(C),o})}function Ji(n,e){return oe(this,void 0,void 0,function*(){var t,i,o,s,l,a;let c=new Ut({id:n}),d=document.getElementById("titre__filter-dropdown-complexe"+e);d&&(c.nameCinema=((t=d.textContent)===null||t===void 0?void 0:t.replace("\u25BC","").trim())||je[0]),console.log("Nom cinema = ",c.nameCinema);let r=document.getElementById("nameSalleInput"+e);r&&(c.nameSalle=((i=r.value)===null||i===void 0?void 0:i.trim())||"");let u=document.getElementById("nPlacesPMRInput"+e);u&&(c.numPMR=parseInt(((o=u.value)===null||o===void 0?void 0:o.trim())||"0",10)||0);let v=document.getElementById("nrMaxInput"+e);v&&(c.rMax=parseInt(((s=v.value)===null||s===void 0?void 0:s.trim())||"0",10)||0);let p=document.getElementById("nfMaxInput"+e);p&&(c.fMax=parseInt(((l=p.value)===null||l===void 0?void 0:l.trim())||"0",10)||0);let f=document.getElementById("seatsAbsentInput"+e);return f&&(c.seatsAbsents=((a=f.value)===null||a===void 0?void 0:a.trim())||""),c.capacity=(c?.fMax||0)*(c?.rMax||0)-He(c?.seatsAbsents||""),console.log("Salle du formulaire",JSON.stringify(c)),c})}function Hi(n,e,t,i){return oe(this,void 0,void 0,function*(){let o=t.length>0?t.split(",").map(s=>s.trim().replace(/^"|"$/g,"")):[];return new Promise(s=>{let l=`
      <div class="modal__content-wrapper" id="modal-displayAndSeatsSuppr">
        <div class="modal__title">
          <div class="title__displayAndSeatsSuppr title-h2">
            <h2>S\xE9lectionner les places absentes</h2>
          </div>
          <span class="close-modal" id="close-displayAndSeatsSuppr">\xD7</span>
        </div>
        <div class="modal__content" id="content__displayAndSeatsSuppr"></div>
        <div class="modal__footer" style="margin-top: 10px; display:flex; gap:10px; justify-content: end;">
          <button id="btnAnnulerSeats" class="button">Annuler</button>
          <button id="btnValiderSeats" class="button">Valider</button>
        </div>
      </div>`,a=document.getElementById("modal-displayAndSeatsSuppr");a||(a=document.createElement("div"),a.id="modal-displayAndSeatsSuppr",a.classList.add("modal"),a.style.zIndex="2000",document.body.appendChild(a),a.innerHTML=""),a.innerHTML=l,a.style.display="flex";let c=document.getElementById("close-displayAndSeatsSuppr"),d=document.getElementById("content__displayAndSeatsSuppr"),r=document.getElementById("btnAnnulerSeats"),u=document.getElementById("btnValiderSeats"),v=o,p=f=>{if(a.style.display="none",En)En=!1;else{let g=document.getElementById("modal-editSalle");g&&g.style.display==="none"&&(g.style.display="flex")}a.remove,f.length===0?s(""):s(f.join(","))};if(c?.addEventListener("click",f=>{f.stopPropagation(),p([])}),a.addEventListener("click",f=>{f.stopPropagation(),f.target===a&&p([])}),r?.addEventListener("click",f=>{f.stopPropagation(),p([])}),u?.removeEventListener("click",()=>{}),u?.addEventListener("click",f=>{f.stopPropagation(),p([...v])}),d)for(let f=0;f<n;f++){let g=document.createElement("div");g.style.display="flex",g.style.flexDirection="row",g.style.margin="2px 0";let y=document.createElement("span");y.textContent=`R${f} `,y.style.width="40px",y.style.textAlign="right",g.appendChild(y);for(let h=0;h<e;h++){let C=`R${f}F${h}`,b=document.createElement("div");b.style.width="30px",b.style.height="30px",b.style.marginRight="4px",b.style.display="flex",b.style.alignItems="center",b.style.justifyContent="center",b.style.cursor="pointer",b.style.fontSize="0.7em",b.style.borderRadius="4px",f===0&&h<i&&(b.textContent="PMR"),o&&o.includes(C)?b.style.backgroundColor="white":b.style.backgroundColor="lightgray",b.removeEventListener("click",()=>{}),b.addEventListener("click",()=>{v.includes(C)?(v.splice(v.indexOf(C),1),b.style.backgroundColor="lightgray"):(v.push(C),b.style.backgroundColor="white")}),g.appendChild(b)}d.appendChild(g)}})})}function He(n){return n.length>0?(n.match(/,/g)||[]).length+1:0}var oe,En,je,Ni,Vi=P(()=>{"use strict";Te();Ri();ve();le();ie();N();Ee();oe=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},En=!1,je=[],Ni=""});var Rt,Yi=P(()=>{"use strict";Rt=class{constructor(e){Object.assign(this,e)}}});var Ki={};ge(Ki,{onLoadManageSeances:()=>as,updateTableSeances:()=>Qi});function as(){return G(this,void 0,void 0,function*(){var n;console.log("=====> chargement onLoadManageSeances"),yield J(),yield O(),yield w.majVersion();let e;k&&(e=k.compte(),e&&e.listCinemas&&!e.isAdministrateur&&(pt=(n=e.listCinemas)===null||n===void 0?void 0:n.split(",").map(i=>i.trim().replace(/^"|"$/g,"")),zi=e.listCinemas)),console.log("List Cinemas autoris\xE9s = ",zi,pt);let t=document.querySelector(".titre__filter-dropdown-cinema");if(t){let i=t.querySelector(".title__filter-button-drowdown-content");if(i){i.innerHTML="";let o=document.createElement("a");o.href="#",o.dataset.cinema="Tous les complexes",o.textContent="Tous les complexes",i.appendChild(o),pt.forEach(s=>{let l=document.createElement("a");l.href="#",l.dataset.cinema=s,l.textContent=s,i.appendChild(l)})}}yield ds(),yield cs(),yield ft()})}function ft(){return G(this,void 0,void 0,function*(){let n=document.getElementById("seances-table-container");if(!n){console.error("Pas de container");return}n.innerHTML="";let e=(yield w.getSeancesDisplayFilter()).filter(i=>pt.includes(i.nameCinema));Sn&&(e=e.filter(i=>i.dateJour?U(new Date(i.dateJour))===Sn:!1));let t=yield Qi(e);n.appendChild(t),Re(t),Nt=yield w.getListFilmsAll(),Ve=(yield w.getSallesByFilter()).filter(i=>pt.includes(i.nameCinema))})}function ds(){return G(this,void 0,void 0,function*(){function n(s){document.querySelectorAll(".titre__filter-dropdown-complexe").forEach(a=>{a.style.display="block",a.innerHTML=`${s} <span class="chevron">\u25BC</span>`})}let e=document.querySelector(".titre__filter-dropdown-cinema");if(!e)return;let t=e.querySelector(".title__filter-button-drowdown-content");if(!t)return;console.log("Init dropdown Cinema");let i=document.getElementById("titleLeft");i&&(w.filterNameCinema==="all"?i.innerText="Les s\xE9ances de CinePhoria":i.innerText=`Les s\xE9ances de CinePhoria \xE0 ${w.filterNameCinema}`),w.filterNameCinema==="all"?n("Tous les complexes"):n(w.filterNameCinema),t.querySelectorAll("a").forEach(s=>{s.removeEventListener("click",l=>G(this,void 0,void 0,function*(){})),s.addEventListener("click",l=>G(this,void 0,void 0,function*(){var a;l.preventDefault();let c=((a=s.dataset.cinema)===null||a===void 0?void 0:a.trim())||"";c==="Tous les complexes"?w.filterNameCinema="all":w.filterNameCinema=c,Ve=yield w.getSallesByFilter(),console.log("Choix du filtre Cinema = ",w.filterNameCinema),n(c);let d=document.getElementById("titleLeft");d&&(w.filterNameCinema==="all"?d.innerText="Les s\xE9ances de CinePhoria":d.innerText=`Les s\xE9ances de CinePhoria \xE0 ${c}`),yield ft()}))})})}function cs(){return G(this,void 0,void 0,function*(){let n=document.querySelector(".title__filters-films");if(!n)return;let e=document.createElement("input");e.type="date",e.classList.add("filter-jour-input"),n.prepend(e),e.removeEventListener("change",()=>G(this,void 0,void 0,function*(){})),e.addEventListener("change",()=>G(this,void 0,void 0,function*(){Sn=e.value,yield ft()})),yield us()})}function us(){return G(this,void 0,void 0,function*(){let n=document.querySelector(".filter-jour-input");if(!n)return;let e=(yield w.getSeancesDisplayFilter()).map(t=>t.dateJour).filter(Boolean).sort();if(e.length>0){let t=U(new Date(e[0])),i=U(new Date(e[e.length-1]));n.min=t,n.max=i}else n.min="",n.max=""})}function Qi(n){return G(this,void 0,void 0,function*(){let e=document.createElement("div");e.classList.add("tab__seances-liste");let t=document.createElement("table");t.classList.add("tab__seances-liste-table");let i=document.createElement("thead"),o=document.createElement("tr");["Date","Salle","H. D\xE9but","H. Fin","Affiche","Titre","Dur\xE9e","Capacit\xE9","Bande","Qualit\xE9","Actions"].forEach(a=>{let c=document.createElement("th");c.textContent=a,o.appendChild(c)}),i.appendChild(o),t.appendChild(i);let l=document.createElement("tbody");return l.classList.add("liste-table__body"),t.appendChild(l),n.forEach(a=>{var c,d;let r=document.createElement("tr"),u=document.createElement("td");u.textContent=yt.format(new Date(a.dateJour||"")),r.appendChild(u);let v=document.createElement("td");!w.filterNameCinema||w.filterNameCinema==="all"?v.textContent=a.nameCinema+"-"+a.nameSalle||"":v.textContent=a.nameSalle||"",r.appendChild(v);let p=document.createElement("td");p.textContent=a.hourBeginHHSMM||"",r.appendChild(p);let f=document.createElement("td");f.textContent=a.hourEndHHSMM||"",r.appendChild(f);let g=document.createElement("td"),y=document.createElement("img");y.src=z((c=a.imageFilm128)!==null&&c!==void 0?c:""),y.alt="Affiche",y.classList.add("content-img-td"),g.appendChild(y),r.appendChild(g);let h=document.createElement("td");h.textContent=a.titleFilm||"",r.appendChild(h);let C=document.createElement("td");C.textContent=a.duration||"",r.appendChild(C);let b=document.createElement("td");b.textContent=((d=a.capacity)===null||d===void 0?void 0:d.toString(10))||"",r.appendChild(b);let E=document.createElement("td");E.textContent=a.bo||"",r.appendChild(E);let L=document.createElement("td");L.textContent=a.qualite||"",r.appendChild(L);let S=document.createElement("td"),B=xn("edit",r,a);S.appendChild(B),r.appendChild(S),r.dataset.seanceId=a.seanceId,l.appendChild(r)}),e.appendChild(t),e})}function xn(n,e,t){let i=document.createElement("div");if(n==="edit"){i.classList.add("table-content-btns");let o=document.createElement("button");o.classList.add("tab__salles-liste-button"),o.textContent="Editer",o.addEventListener("click",()=>G(this,void 0,void 0,function*(){let l=e.querySelectorAll("td"),a=[];l.forEach(c=>{a.push(c.offsetWidth-30)}),yield ms(e,t,a)})),i.appendChild(o);let s=document.createElement("button");s.classList.add("tab__salles-liste-button"),s.textContent="Supprimer",s.addEventListener("click",()=>{fs(e)}),i.appendChild(s)}if(n==="save"){i.classList.add("table-content-btns");let o=document.createElement("button");o.classList.add("tab__salles-liste-button"),o.textContent="Annuler",o.addEventListener("click",()=>{ps(e,t)});let s=document.createElement("button");s.classList.add("tab__salles-liste-button"),s.textContent="Dupliquer",s.addEventListener("click",()=>G(this,void 0,void 0,function*(){yield Gi(e,t,!0)})),i.appendChild(s);let l=document.createElement("button");l.classList.add("tab__salles-liste-button"),l.textContent="Modifier",l.addEventListener("click",()=>G(this,void 0,void 0,function*(){yield Gi(e,t)})),i.appendChild(l),i.appendChild(o)}return i}function ms(n,e,t){return G(this,void 0,void 0,function*(){let i=n.querySelectorAll("td");console.log("Date Entr\xE9e = ",e.dateJour);let o=i[0],s=document.createElement("input");s.type="date",s.valueAsDate=new Date(e.dateJour||""),s.style.width=`${t[0]}px`,s.style.boxSizing="border-box",s.style.textAlign="center",o.textContent="",o.appendChild(s);let l=i[1],a=document.createElement("select");Ve.forEach(x=>{let _=document.createElement("option");_.value=x.nomSalle,_.textContent=x.nomSalle,x.id===e.salleId&&(_.selected=!0),a.appendChild(_)}),a.style.width=`${t[1]}px`,a.style.boxSizing="border-box",a.style.textAlign="center",a.addEventListener("change",()=>{let x=Ve.find(_=>_.nomSalle===a.value);x&&(i[7].textContent=x.capacite.toString())}),l.textContent="",l.appendChild(a);function c(x,_){let D=[],T=x*60,j=_*60;for(;T<=j;){let Q=Math.floor(T/60)%24,xe=T%60,Le=`${Q.toString().padStart(2,"0")}:${xe.toString().padStart(2,"0")}`;D.push(Le),T+=5}return D}let d=i[2],r=document.createElement("select");c(10,24).forEach(x=>{let _=document.createElement("option");_.value=x,_.textContent=x,x===e.hourBeginHHSMM&&(_.selected=!0),r.appendChild(_)}),r.style.width=`${t[2]}px`,r.style.boxSizing="border-box",r.style.textAlign="center",d.textContent="",d.appendChild(r);let u=i[3],v=document.createElement("select");c(11,26).forEach(x=>{let _=document.createElement("option");_.value=x,_.textContent=x,x===e.hourEndHHSMM&&(_.selected=!0),v.appendChild(_)}),v.style.width=`${t[3]}px`,v.style.boxSizing="border-box",v.style.textAlign="center",u.textContent="",u.appendChild(v);let p=i[4];p.style.width=`${t[4]}px`,p.style.boxSizing="border-box";let f=i[5],g=document.createElement("select");Nt.forEach(x=>{let _=document.createElement("option");_.value=x.titre,_.textContent=x.titre,x.id===e.filmId&&(_.selected=!0),g.appendChild(_)}),g.style.width=`${t[5]}px`,g.style.boxSizing="border-box",g.style.textAlign="center";let y=i[6];y.style.width=`${t[6]}px`,y.style.boxSizing="border-box",g.addEventListener("change",()=>{let x=Nt.find(_=>_.titre===g.value);x&&(i[4].querySelector("img").src=z(x.affiche),i[6].textContent=x.duration)}),f.textContent="",f.appendChild(g);let h=i[7];h.style.width=`${t[7]}px`,h.style.boxSizing="border-box";let C=i[8],b=document.createElement("select");["VF","VOST"].forEach(x=>{let _=document.createElement("option");_.value=x,_.textContent=x,x===e.bo&&(_.selected=!0),b.appendChild(_)}),b.style.width=`${t[8]}px`,b.style.boxSizing="border-box",b.style.textAlign="center",C.textContent="",C.appendChild(b);let E=i[9],L=document.createElement("select");["4DX","3D","4K"].forEach(x=>{let _=document.createElement("option");_.value=x,_.textContent=x,x===e.qualite&&(_.selected=!0),L.appendChild(_)}),L.style.width=`${t[9]}px`,L.style.boxSizing="border-box",L.style.textAlign="center",E.textContent="",E.appendChild(L);let S=i[10];S.textContent="";let B=xn("save",n,e);S.appendChild(B),n.appendChild(S)})}function ps(n,e){var t,i;let o=n.querySelectorAll("td");o[0].textContent=We(kn(e.dateJour||""))||"",!w.filterNameCinema||w.filterNameCinema==="all"?o[1].textContent=e.nameCinema+"-"+e.nameSalle||"":o[1].textContent=e.nameSalle||"",o[2].textContent=e.hourBeginHHSMM||"",o[3].textContent=e.hourEndHHSMM||"",o[4].querySelector("img").src=z((t=e.imageFilm128)!==null&&t!==void 0?t:""),o[5].textContent=e.titleFilm||"",o[6].textContent=e.duration||"",o[7].textContent=((i=e.capacity)===null||i===void 0?void 0:i.toString(10))||"",o[8].textContent=e.bo||"",o[9].textContent=e.qualite||"";let s=o[10];s.textContent="";let l=xn("edit",n,e);s.appendChild(l)}function Gi(n,e){return G(this,arguments,void 0,function*(t,i,o=!1){var s,l,a,c;let d=t.querySelectorAll("td"),r=t.dataset.seanceId,u=new Rt({id:r}),v=d[0].querySelector("input");u.dateJour=v?.value||"";let p=d[1].querySelector("select"),f=((s=Ve.find(S=>S.nomSalle===p?.value))===null||s===void 0?void 0:s.id)||"";u.salleId=f;let g=((l=Ve.find(S=>S.nomSalle===p?.value))===null||l===void 0?void 0:l.numPMR)||"0";u.numFreePMR=g.toString(10);let y=d[2].querySelector("select"),h=d[3].querySelector("select");u.hourBeginHHSMM=y?.value||"",u.hourEndHHSMM=h?.value||"";let C=d[5].querySelector("select").value,b=((a=Nt.find(S=>S.titre===C))===null||a===void 0?void 0:a.id)||"";u.filmId=b,u.numFreeSeats=((c=d[7].textContent)===null||c===void 0?void 0:c.trim())||"0";let E=d[8].querySelector("select");u.bo=E?.value||"";let L=d[9].querySelector("select");u.qualite=L?.value||"",u.alertAvailibility="",o&&(u.id=crypto.randomUUID());try{(yield w.createOrUpdateSeance(u)).message==="create"?alert("S\xE9ance dupliqu\xE9e"):alert("S\xE9ance modifi\xE9e"),yield ft()}catch(S){alert("Une erreur est survenue : "+S)}})}function fs(n){return G(this,void 0,void 0,function*(){let e=n.dataset.seanceId;try{let t=yield ii(e);alert("Suppression r\xE9ussie :"+t.message),yield ft()}catch(t){console.error("Erreur dans la suppression "+t),alert("Suppression impossible : "+t)}})}var G,Nt,Ve,Sn,pt,zi,Wi=P(()=>{"use strict";Te();ve();le();N();Yi();ie();Ee();G=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Sn="",pt=[],zi=""});var eo={};ge(eo,{onLoadManageAvis:()=>Zi,updateTableAvis:()=>Xi});function Zi(){return te(this,arguments,void 0,function*(n="",e="all"){console.log("=====> chargement onLoadManageAvis"),yield w.majVersion(),yield J(),yield O(),yield w.majVersion(),yield vs(),yield hs(),Ye=n,w.filterNameCinema=e,yield Ln()})}function Ln(){return te(this,void 0,void 0,function*(){let n=document.getElementById("avis-table-container");if(!n){console.error("Pas de container");return}n.innerHTML="";let e=yield w.getReservationForUtilisateurFilter();e=e.filter(o=>o.stateReservation===I.DoneEvaluated&&o.isEvaluationMustBeReview),Ye&&(e=e.filter(o=>o.dateJour?U(new Date(o.dateJour))===Ye:!1));let t=yield Xi(e);n.appendChild(t),Re(t);let i=ys();n.appendChild(i)})}function vs(){return te(this,void 0,void 0,function*(){function n(s){document.querySelectorAll(".titre__filter-dropdown-complexe").forEach(a=>{a.style.display="block",a.innerHTML=`${s} <span class="chevron">\u25BC</span>`})}let e=document.querySelector(".titre__filter-dropdown-cinema");if(!e)return;let t=e.querySelector(".title__filter-button-drowdown-content");if(!t)return;console.log("Init dropdown Cinema");let i=document.getElementById("titleLeft");i&&(w.filterNameCinema==="all"?i.innerText="Mod\xE9rer tous les avis":i.innerText=`Mod\xE9rer les avis pour le cin\xE9ma de ${w.filterNameCinema}`),w.filterNameCinema==="all"?n("Tous les complexes"):n(w.filterNameCinema),t.querySelectorAll("a").forEach(s=>{s.removeEventListener("click",l=>te(this,void 0,void 0,function*(){})),s.addEventListener("click",l=>te(this,void 0,void 0,function*(){var a;l.preventDefault();let c=((a=s.dataset.cinema)===null||a===void 0?void 0:a.trim())||"";c==="Tous les complexes"?w.filterNameCinema="all":w.filterNameCinema=c,console.log("Choix du filtre Cinema = ",w.filterNameCinema),n(c);let d=document.getElementById("titleLeft");d&&(w.filterNameCinema==="all"?d.innerText="Mod\xE9rer tous les avis":d.innerText=`Mod\xE9rer les avis pour le cin\xE9ma de ${c}`),yield Ln()}))})})}function hs(){return te(this,void 0,void 0,function*(){let n=document.querySelector(".title__filters-films");if(!n)return;let e=document.querySelector(".filter-jour-input");e||(e=document.createElement("input"),e.classList.add("filter-jour-input"),e.type="date"),e.value=Ye,n.prepend(e),e.removeEventListener("change",()=>te(this,void 0,void 0,function*(){})),e.addEventListener("change",()=>te(this,void 0,void 0,function*(){Ye=e.value,yield Ln()})),yield gs()})}function gs(){return te(this,void 0,void 0,function*(){let n=document.querySelector(".filter-jour-input");if(!n)return;let e=(yield w.getReservationForUtilisateurFilter()).map(t=>t.dateJour).filter(Boolean).sort();if(e.length>0){let t=U(new Date(e[0])),i=U(new Date(e[e.length-1]));n.min=t,n.max=i}else n.min="",n.max=""})}function Xi(n){return te(this,void 0,void 0,function*(){let e=document.createElement("div");e.classList.add("tab__avis-liste");let t=document.createElement("table");t.classList.add("tab__avis-liste-table"),t.id="tab__avis-liste-table";let i=document.createElement("thead"),o=document.createElement("tr");["Date","Film","Utilisateur","Note","Commentaire","Mod\xE9r\xE9","A Supprimer"].forEach(a=>{let c=document.createElement("th");c.textContent=a,o.appendChild(c)}),i.appendChild(o),t.appendChild(i);let l=document.createElement("tbody");return l.classList.add("liste-table__body"),t.appendChild(l),n.forEach(a=>{var c;let d=document.createElement("tr"),r=document.createElement("td");r.textContent=yt.format(new Date(a.dateJour||"")),d.appendChild(r);let u=document.createElement("td");u.textContent=a.titleFilm||"",d.appendChild(u);let v=document.createElement("td");v.textContent=a.displayName||"",d.appendChild(v);let p=document.createElement("td");p.textContent=((c=a.note)===null||c===void 0?void 0:c.toString(10))||"",d.appendChild(p);let f=document.createElement("td");f.textContent=a.evaluation||"",d.appendChild(f);let g=document.createElement("td"),y=document.createElement("input");y.type="checkbox",y.checked=!0,a.isEvaluationMustBeReview&&(y.checked=!1),g.dataset.ischecked=y.checked?"true":"false",g.appendChild(y),d.appendChild(g);let h=document.createElement("td"),C=document.createElement("input");C.type="checkbox",C.checked=!1,h.appendChild(C),d.appendChild(h),d.dataset.reservationId=a.reservationId,l.appendChild(d)}),l.querySelectorAll("tr").forEach(a=>{let c=a.querySelector('td:nth-child(7) input[type="checkbox"]'),d=a.querySelector('td:nth-child(6) input[type="checkbox"]');c.addEventListener("change",()=>{c.checked?d.disabled=!0:d.disabled=!1}),d.addEventListener("change",()=>{d.checked?c.disabled=!0:c.disabled=!1})}),e.appendChild(t),e})}function ys(){let n=document.createElement("div");n.classList.add("table-content-btns");let e=document.createElement("button");e.classList.add("tab__salles-liste-button"),e.textContent="Appliquer",e.addEventListener("click",()=>te(this,void 0,void 0,function*(){yield _s()})),n.appendChild(e);let t=document.createElement("button");return t.classList.add("tab__salles-liste-button"),t.textContent="Remise \xE0 z\xE9ro",t.addEventListener("click",()=>te(this,void 0,void 0,function*(){yield Cs()})),n.appendChild(t),n}function _s(){return te(this,void 0,void 0,function*(){let n=document.getElementById("tab__avis-liste-table");if(!n)return;let e=n.querySelectorAll("tbody tr"),t=[],i=0,o=0;e.forEach(s=>{var l,a,c,d;let r=s.dataset.reservationId;if(!r)return;let u=s.querySelector('td:nth-child(6) input[type="checkbox"]'),v=u?.parentElement,p=(l=u?.checked)!==null&&l!==void 0?l:!1,f=v?.dataset.ischecked==="true",g=s.querySelector('td:nth-child(7) input[type="checkbox"]'),y=(a=g?.checked)!==null&&a!==void 0?a:!1,h=s.querySelector("td:nth-child(4)"),C=s.querySelector("td:nth-child(5)");y?(t.push({id:r,evaluation:"Evaluation supprim\xE9e car non conforme aux usages",isEvaluationMustBeReview:!1,note:void 0}),o++):p&&!f&&(t.push({id:r,evaluation:((c=C?.textContent)===null||c===void 0?void 0:c.trim())||"",isEvaluationMustBeReview:!1,note:!((d=h?.textContent)===null||d===void 0)&&d.trim()?parseFloat(h.textContent.trim()):void 0}),i++)});for(let s of t)yield w.updateReservationAvis(s);alert(`${i} validation(s) r\xE9alis\xE9e(s) et ${o} avis supprim\xE9(s)`),Zi(Ye,w.filterNameCinema)})}function Cs(){return te(this,void 0,void 0,function*(){let n=document.getElementById("tab__avis-liste-table");if(!n)return;n.querySelectorAll("tbody tr").forEach(t=>{let i=t.querySelector('td:nth-child(6) input[type="checkbox"]'),o=t.querySelector('td:nth-child(7) input[type="checkbox"]'),s=i?.parentElement;o&&(o.checked=!1),i&&s&&(i.checked=s.dataset.ischecked==="true"),o&&(o.disabled=!1),i&&(i.disabled=!1)})})}var te,Ye,to=P(()=>{"use strict";Te();ve();le();N();ye();te=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Ye=""});var oo={};ge(oo,{onLoadManageEmployes:()=>Ss});function Ss(){return ce(this,void 0,void 0,function*(){console.log("=====> chargement onLoadManageEmployes"),yield J(),yield O(),yield w.majVersion(),yield qt(),Ls(),Qe(!1),document.querySelector("main").style.visibility="visible"})}function qt(){return ce(this,void 0,void 0,function*(){let n=document.querySelector(".employes__listEmployes");if(n&&(n.innerHTML="",ze=yield w.getListEmployesAll(),io=ze.reduce((e,t)=>{var i;return Math.max(e,(i=t.matricule)!==null&&i!==void 0?i:0)},0),ze.forEach(e=>{let t=xs(e);n.appendChild(t)}),ze.length>0?(H=ze[0],Ot(H)):wn(),H)){let e=[...n.querySelectorAll(".listEmployes__simpleCard")].find(t=>{var i,o;return(i=t.textContent)===null||i===void 0?void 0:i.includes(((o=H.matricule)===null||o===void 0?void 0:o.toString(10))||"")});e&&e.scrollIntoView({behavior:"smooth",block:"center"})}})}function xs(n){var e;let t=document.createElement("div");t.classList.add("listEmployes__simpleCard");let i=document.createElement("p");i.classList.add("simpleCard__detail-titre-p"),i.textContent=((e=n.lastnameEmploye)===null||e===void 0?void 0:e.toUpperCase())+" "+n.firstnameEmploye+" ("+n.matricule+")",t.appendChild(i);let o=document.createElement("p");if(o.classList.add("simpleCard__detail-titre-p"),o.textContent=n.email+(n.isAdministrateur===1?" - administrateur":""),t.appendChild(o),n.numConnexions>0){let s=document.createElement("p");s.classList.add("simpleCard__detail-titre-p"),s.classList.add("numConnexions"),s.textContent=n.numConnexions+" connexions",t.appendChild(s)}else{let s=document.createElement("button");s.classList.add("simpleCard__detail-titre-p"),s.classList.add("supprimer-button"),s.textContent="Supprimer",t.appendChild(s),s.removeEventListener("click",()=>ce(this,void 0,void 0,function*(){})),s.addEventListener("click",()=>ce(this,void 0,void 0,function*(){try{yield w.deleteEmploye(n.matricule),yield qt()}catch{alert("Erreur dans la suppression")}}))}return t.addEventListener("click",()=>ce(this,void 0,void 0,function*(){console.log("employe = ",n.matricule),wn(),H=n,Ot(n)})),t}function wn(){document.querySelector(".employes__detailEmploye")&&(Ge=!1,he=!1,vt(!1),Qe(!1))}function Ls(){let n=document.getElementById("title__right-button-Ajouter"),e=document.getElementById("title__right-button-Modifier"),t=document.getElementById("title__right-button-Annuler");if(!n||!e||!t){console.error("Missing one of the action buttons in .right__actions");return}n.style.display="inline-block",e.style.display="inline-block",t.style.display="none",n.removeEventListener("click",()=>{}),n.addEventListener("click",ws),e.removeEventListener("click",()=>ce(this,void 0,void 0,function*(){})),e.addEventListener("click",()=>ce(this,void 0,void 0,function*(){return yield Ds()})),t.removeEventListener("click",()=>ce(this,void 0,void 0,function*(){})),t.addEventListener("click",()=>ce(this,void 0,void 0,function*(){return yield Is()}))}function ws(){he=!0,Ge=!0;let n=new Ne({matricule:io+1});H=n,Ot(n),vt(!0),Qe(!0);let e=document.getElementById("title__right-button-Modifier");e&&(e.textContent="Enregistrer")}function vt(n){let e=document.getElementById("title__right-button-Ajouter"),t=document.getElementById("title__right-button-Modifier"),i=document.getElementById("title__right-button-Annuler");!e||!t||!i||(n?(e.style.display="none",i.style.display="inline-block",t.textContent="Enregistrer",no(!0),t.classList.add("inactif"),t.disabled=!0):(e.style.display="inline-block",i.style.display="none",t.textContent="Modifier",no(!1),t.classList.remove("inactif"),t.disabled=!1))}function Ds(){return ce(this,void 0,void 0,function*(){if(Ge)yield As();else{Ge=!0,he=!1,vt(!0),Qe(!0);let n=document.getElementById("title__right-button-Modifier");n&&(n.textContent="Enregistrer")}})}function Is(){return ce(this,void 0,void 0,function*(){he&&(H=ze[0]),Ge=!1,he=!1,vt(!1),Qe(!1);let n=H?.matricule;n?yield w.getEmployesByMatricule(n).then(e=>Ot(e)).catch(e=>console.error(e)):wn()})}function no(n){["firstNameEmploye","lastNameEmploye","email","isAdministrateur","matricule","firstPassword","confirmPassword"].concat(Me).forEach(t=>{let i=document.getElementById(t);(i instanceof HTMLInputElement||i instanceof HTMLDivElement)&&(n?(i.addEventListener("input",$t),i.addEventListener("blur",$t)):(i.removeEventListener("input",$t),i.removeEventListener("blur",$t)))})}function As(){return ce(this,void 0,void 0,function*(){let{employe:n,password:e}=Ms();if(n)try{yield w.createOrUpdateEmploye(n,e),he?(console.log("Employe created => matricule",n.matricule),alert("Employe cr\xE9\xE9 avec succ\xE8s")):(console.log("Employe updated => matricule",n.matricule),alert("Employe mis \xE0 jour avec succ\xE8s")),yield qt()}catch(t){let i="";he?i="Erreur dans la cr\xE9ation du compte ":i="Erreur dans la modification du compte ",console.error(i,t);let o=t.replace(/^Error:\s*Erreur\s*:\s*/,"");alert(i+" => "+o)}finally{Ge=!1,he=!1,vt(!1),Qe(!1),H=n,yield qt()}})}function Ms(){var n,e,t,i;if(H===void 0)return{employe:void 0,password:""};let o=H;console.log("On sauvegarde = "+o.matricule);let s=document.getElementById("lastNameEmploye");s&&(o.lastnameEmploye=((n=s.textContent)===null||n===void 0?void 0:n.trim())||"");let l=document.getElementById("firstNameEmploye");l&&(o.firstnameEmploye=((e=l.textContent)===null||e===void 0?void 0:e.trim())||"");let a=document.getElementById("email");a&&(o.email=((t=a.textContent)===null||t===void 0?void 0:t.trim())||"");let c=document.getElementById("matricule");c&&(o.matricule=parseInt(((i=c.textContent)===null||i===void 0?void 0:i.trim())||"",10));let d=document.getElementById("isAdministrateur");d&&(o.isAdministrateur=d.checked?1:0);let r=document.getElementById("firstPassword"),u=document.getElementById("confirmPassword"),v="";if(r&&u){let f=r.value.trim(),g=u.value.trim();f===g&&(v=f)}let p="";return Me.forEach(f=>{let g=document.getElementById(f);g&&g.checked&&(p+=p.length>0?","+f:f)}),o.listCinemas=p,{employe:o,password:v}}function Ot(n){var e;let t=document.getElementById("email");t&&(t.textContent=n.email||null);let i=document.getElementById("matricule");i&&(i.textContent=((e=n.matricule)===null||e===void 0?void 0:e.toString(10))||"");let o=document.getElementById("lastNameEmploye");o&&(o.textContent=n.lastnameEmploye||null);let s=document.getElementById("firstNameEmploye");s&&(s.textContent=n.firstnameEmploye||null);let l=document.getElementById("isAdministrateur");l&&(l.checked=n.isAdministrateur===1);let a=document.getElementById("firstPassword");a.value="";let c=document.getElementById("confirmPassword");c.value="",Me.forEach(d=>{var r;let u=document.getElementById(d);!((r=n.listCinemas)===null||r===void 0)&&r.includes(d)?u.checked=!0:u.checked=!1})}function Bs(n){let e=document.querySelector(".passwordEdit");e.style.display=n?"block":"none"}function Qe(n){let e=["lastNameEmploye","firstNameEmploye","firstPassword","confirmPassword"];he&&(e.push("email"),e.push("matricule")),n||(e.push("email"),e.push("matricule")),e.forEach(i=>{let o=document.getElementById(i);o&&(o instanceof HTMLInputElement?o.disabled=!n:o.contentEditable=n?"true":"false",o.style.border=n?"1px solid #000":"none",o.style.background=n?"rgba(255, 215, 0, 0.1)":"#FFF")}),[...Me,"isAdministrateur"].forEach(i=>{let o=document.getElementById(i);o&&(o.disabled=!n)}),Bs(n);let t=document.getElementsByClassName("span-password");n&&!he?Array.from(t).forEach(i=>{i.style.display="none"}):Array.from(t).forEach(i=>{i.style.display="inline"})}function Fs(){function n(d){let r=document.getElementById("messageErreur");r.innerHTML=d}n("");let e=!0,t="<h3>Consignes \xE0 respecter :</h3> <ul>",i=["lastNameEmploye","firstNameEmploye","email","matricule"],o=!1;for(let d of i){let r=document.getElementById(d);r&&r?.innerText.trim().length===0&&(o=!0)}o&&(e=!1,t+="<li>Nom, Pr\xE9nom, email et matricule sont obligatoires");let s=!1;for(let d of Me){let r=document.getElementById(d);if(r?.checked){s=!0;break}}s||(e=!1,t+="<li>Un cin\xE9ma au moins doit etre s\xE9lectionn\xE9");let l=document.getElementById("firstPassword"),a=document.getElementById("confirmPassword");l&&a&&l.value.trim()!==a.value.trim()&&(e=!1,t+="<li>Les deux champs de saisie du mot de passe doivent \xEAtre identiques"),he&&l&&a&&(l.value.trim().length===0||a.value.trim().length===0)&&(e=!1,t+="<li>En mode ajout, vous devez fournir un mot de passe valide");let c=document.getElementById("email");return K(c.textContent||"")||(e=!1,t+="<li>L'email doit \xEAtre valide"),l&&l.value.trim().length>0&&!Un(l.value.trim())&&(e=!1,t+="<li>Le mot de passe doit avoir 8 caract\xE8res, une majuscule, un caract\xE8re sp\xE9cial et un nombre"),e?!0:(t+="</ul>",n(t),!1)}function ks(){var n;if(!H)return!1;let e=(l,a)=>{let c=document.getElementById(l);return c?.innerText.trim()!==(a||"")};if(e("lastNameEmploye",H.lastnameEmploye)||e("firstNameEmploye",H.firstnameEmploye)||e("email",H.email)||e("matricule",(n=H.matricule)===null||n===void 0?void 0:n.toString(10)))return!0;let t=document.getElementById("firstPassword"),i=document.getElementById("confirmPassword");if(t?.value.trim()!==Es||i?.value.trim()!==bs)return!0;let s=(H.listCinemas||"").split(",").map(l=>l.trim());H.isAdministrateur===1&&s.push("isAdministrateur");for(let l of[...Me,"isAdministrateur"]){let a=document.getElementById(l);if(a){let c=a.checked?1:0,d=s.includes(l)?1:0;if(c!==d)return!0}}return!1}function $t(){let n=document.getElementById("title__right-button-Modifier");n&&(n.disabled=!(Fs()&&ks()),n.classList.toggle("inactif",n.disabled))}var ce,Ge,he,H,ze,Es,bs,io,so=P(()=>{"use strict";Te();Yt();ve();le();N();ce=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Ge=!1,he=!1,ze=[],Es="",bs="",io=0});var ao={};ge(ao,{onLoadDashboard:()=>Ts});function Ts(){return lo(this,void 0,void 0,function*(){console.log("=====> chargement onLoadDashboard"),yield J(),yield O(),yield w.majVersion(),yield Us()})}function Us(){return lo(this,void 0,void 0,function*(){let n=null,e=yield w.getReservationStatsAll();console.log(e),e.length&&(console.log("Cl\xE9s du premier objet :",Object.keys(e[0])),console.log("Valeur filmTitre =",e[0].filmTitre)),Ae.clear(),e.filter(p=>p.filmTitre).forEach(p=>Ae.add(p.filmTitre));let t=document.getElementById("dashboard__listFilms");t.innerHTML="",Array.from(new Set(e.map(p=>p.filmTitre).filter(p=>!!p))).sort((p,f)=>p.localeCompare(f,"fr")).forEach(p=>{let f=document.createElement("button");f.className="listFilms__simpleCard",f.textContent=p,f.classList.add("selected"),f.removeEventListener("click",()=>{}),f.addEventListener("click",()=>{o(p,f),console.log("clic =",p),console.log(Ae)}),t.appendChild(f)});function o(p,f){Ae.has(p)?(Ae.delete(p),f.classList.remove("selected")):(Ae.add(p),f.classList.add("selected")),u()}let s=document.querySelector(".graph__date");s&&(s.innerHTML="");let l=document.createElement("input");s.classList.add("filter-jour-input");let a=new Date().toISOString().substring(0,10);l.type="date",l.value=a,l.removeEventListener("change",()=>{}),l.addEventListener("change",()=>{u(),c()}),s.appendChild(l);function c(){let p=e.map(f=>f.jour).filter(Boolean).sort();if(p.length>0){let f=U(new Date(p[0])),g=U(new Date(p[p.length-1]));l.min=f,l.max=g}else l.min="",l.max=""}let d=document.querySelector(".graph__chart");d.innerHTML="";let r=document.createElement("canvas");r.id="reservationChart",d.appendChild(r),n=new Chart(r,{type:"bar",data:{labels:[],datasets:[{label:"R\xE9servations",data:[]}]},options:{maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}}}});function u(){if(!n)return;let p=new Date(l.value);if(isNaN(p.getTime()))return;let f=[];for(let h=0;h<7;h++){let C=new Date(p);C.setDate(p.getDate()+h),f.push(C.toISOString().substring(0,10))}let y=(Ae.size?Array.from(Ae):Array.from(new Set(e.map(h=>h.filmTitre)))).map((h,C)=>{let b=f.map(E=>e.filter(L=>L.filmTitre===h&&new Date(L.jour).toISOString().substring(0,10)===E).reduce((L,S)=>L+Number(S.totalPlaces),0));return{label:h,data:b,backgroundColor:ro[C%ro.length],stack:"total"}});n.data={labels:f.map(h=>v(new Date(h))),datasets:y},n.options.scales.x={stacked:!0},n.options.scales.y={stacked:!0,beginAtZero:!0},n.update()}function v(p){return p.toLocaleDateString("fr-FR",{weekday:"short"})}u(),c()})}var lo,Ae,ro,co=P(()=>{"use strict";Te();ve();le();N();lo=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},Ae=new Set,ro=["#4e79a7","#f28e2b","#e15759","#76b7b2","#59a14f","#edc949","#af7aa1","#ff9da7"]});function ci(n){return ne(this,void 0,void 0,function*(){if(console.error("\u{1F534} Erreur API d\xE9tect\xE9e :",n),n instanceof Ce)switch(n.code){case re.TOKEN_EXPIRE:console.warn("\u{1F504} Token expir\xE9, redirection vers visiteur.html");case re.TOKEN_REFRESH_FAIL:console.warn("\u{1F504} Token refresh expir\xE9, redirection vers visiteur.html");case re.AUTH_REQUIRED:if(!mo){console.warn("\u{1F504} Token expir\xE9 ou invalide, redirection vers visiteur.html"),mo=!0,localStorage.removeItem("jwtAccessToken");let e=window.location.pathname.split("/").pop();e==="visiteur.html"?console.log("Chargement manuel de onLoadVisiteur()"):Dn.includes(e||"")||window.location.replace("visiteur.html")}break;case re.API_ERROR:console.error("\u274C Erreur API g\xE9n\xE9rale :",n.message),yield $(`Erreur API : ${n.message}`);break;default:console.error("\u2753 Erreur inconnue :",n)}else console.error("\u{1F6A8} Erreur non g\xE9r\xE9e :",n);throw n.message})}var ne,A,_e,Dn,uo,mo,Ze=P(()=>{"use strict";N();Ee();zt();pe();ne=function(n,e,t,i){function o(s){return s instanceof t?s:new t(function(l){l(s)})}return new(t||(t=Promise))(function(s,l){function a(r){try{d(i.next(r))}catch(u){l(u)}}function c(r){try{d(i.throw(r))}catch(u){l(u)}}function d(r){r.done?s(r.value):o(r.value).then(a,c)}d((i=i.apply(n,e||[])).next())})},A=`${window.location.protocol}//${window.location.hostname}${window.location.port?":"+window.location.port:""}`,_e=window.location.pathname.split("/").pop();window.location.hostname.toUpperCase()!=="CINEPHORIA.BD2DB.COM"&&(document.title=document.title+" - dev");Dn=["visiteur.html","reservation.html","films.html","mesreservations.html"],uo={"visiteur.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Li(),xi))).onLoadVisiteur()}),"reservation.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(st(),gi))).onLoadReservation()}),"mesreservations.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Ii(),Di))).onLoadMesReservations()}),"films.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Bi(),Mi))).onLoadFilms()}),"manageFilms.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Pi(),Ui))).onLoadManageFilms()}),"manageSalles.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Vi(),ji))).onLoadManageSalles()}),"manageSeances.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(Wi(),Ki))).onLoadManageSeances()}),"manageAvis.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(to(),eo))).onLoadManageAvis()}),"manageEmployes.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(so(),oo))).onLoadManageEmployes()}),"dashboard.html":()=>ne(void 0,void 0,void 0,function*(){return(yield Promise.resolve().then(()=>(co(),ao))).onLoadDashboard()})},mo=!1;console.log("Chargement de Global");document.removeEventListener("DOMContentLoaded",()=>ne(void 0,void 0,void 0,function*(){}));document.addEventListener("DOMContentLoaded",()=>ne(void 0,void 0,void 0,function*(){console.log("DOM Chargement de Global");let n=k.ident;n!==void 0&&(console.log("Identification chargee = ",n),yield k.init(),console.log("Compte charge = ",k.compte()));let e=k.profil();if(console.log("Profil charge = xxxx",e),console.log("Chargement dynamique de xxxx",_e," "),_e&&uo[_e]){let t=()=>ne(void 0,void 0,void 0,function*(){if(console.log("\u{1F550} Ex\xE9cution du rendu dynamique pour",_e),yield uo[_e](),Dn.includes(_e)){let o=document.getElementById("progressIndicator");o&&(o.style.display="block")}});document.readyState==="complete"?(console.log("\u{1F550} Le chargement est d\xE9j\xE0 complet, ex\xE9cution imm\xE9diate de",_e),yield t()):window.addEventListener("load",t)}else console.warn("\u26A0\uFE0F Aucune fonction associ\xE9e pour cette page.")}));console.log("Current Page = ",_e);_e&&Dn.includes(_e)&&(console.log("Initialisation du DataC"),m.init())});Ze();var Ps=()=>{let n=document.getElementById("navMobileMenu"),e=document.getElementById("mobileMenu"),t=document.getElementById("mobileMenuClose"),i=()=>{e?.classList.add("mobile-menu--open")},o=()=>{e?.classList.remove("mobile-menu--open")};n?.addEventListener("click",i),t?.addEventListener("click",o)},Rs=()=>{let n=[{selector:".container__filmsreservation",transform:!1},...Array.from(document.querySelectorAll(".container__filmsreservation")).map(t=>({element:t,transform:!0}))],e=(t,i=0,o=!1)=>{setTimeout(()=>{t.style.opacity="1",o&&(t.style.transform="translateY(0)")},i)};n.forEach((t,i)=>{let o="element"in t?t.element:document.querySelector(t.selector);o&&e(o,i*50,t.transform)})};Ps();Rs();})();
