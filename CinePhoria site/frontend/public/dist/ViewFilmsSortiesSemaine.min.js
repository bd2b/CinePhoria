"use strict";var m=function(l,e,c,i){function a(t){return t instanceof c?t:new c(function(o){o(t)})}return new(c||(c=Promise))(function(t,o){function d(n){try{r(i.next(n))}catch(s){o(s)}}function u(n){try{r(i.throw(n))}catch(s){o(s)}}function r(n){n.done?t(n.value):a(n.value).then(d,u)}r((i=i.apply(l,e||[])).next())})};import{dataController as p,dataReady as v}from"./DataController.js";import{chargerMenu as f}from"./ViewMenu.js";import{chargerCinemaSites as y}from"./ViewFooter.js";import{imageFilm as _}from"./Helpers.js";export function onLoadVisiteur(){return m(this,void 0,void 0,function*(){console.log(" ===>  onLoadVisiteur"),yield v,console.log("Donn\xE9es charg\xE9es, traitement de la page VisiteurFilms..."),yield f(),yield y();const l=document.getElementById("films-container");if(l){l.innerHTML="";try{let{films:e,message:c}=p.filmsSortiesRecentes;const i=document.querySelector(".title__left-h1");i&&(i.textContent=c),e.forEach(t=>{const o=document.createElement("div");o.classList.add("filmsreservation__film"),o.innerHTML="",o.innerHTML=`
          <div class="film__cardreservation"> <!-- Card pour chaque film-->
            <div class="cardreservation__image">
              <img src="${_(t.imageFilm1024)}" class="cardreservation__image-img" alt="Affiche du film ${t.titleFilm}">
            </div>
            <div class="cardreservation__description">
                <h2 class="cardreservation__description-title">${t.titleFilm}</h2>
                <div class="description__evaluation">
                ${t.isCoupDeCoeur?'<div class="evaluation__coupdecoeur"><p class="evaluation__coupdecoeur-p">Coup de coeur</p><img src="assets/heart.svg" alt="Coeur" class="evaluation__coupdecoeur-img"></div>':""}
                    <div class="evaluation__note">
                        <p class="evaluation__note-p">Avis : ${t.note} / 5</p>
                    </div>
                </div>
                <div class="description__pitch">
                    <p class="description__pitch-p">${t.filmPitch}</p>
                </div>
            </div>
            <div class="cardreservation__reserver">
                <button class="cardreservation__reserver-button">Bande Annonce</button>
            </div>
          </div>
        `,l.appendChild(o);const d=o.querySelector(".cardreservation__reserver-button");d&&(d.removeEventListener("click",r=>m(this,void 0,void 0,function*(){})),d.addEventListener("click",r=>m(this,void 0,void 0,function*(){r.preventDefault(),r.stopPropagation();const n=`modalyoutube-${t.id}`;let s=document.getElementById(n);s||(s=document.createElement("div"),s.id=n,s.className="modalyoutube",document.body.appendChild(s)),t.linkBO&&g(t.linkBO,s)})));const u=o.querySelector(".cardreservation__image-img");u&&(u.style.cursor="pointer",u.addEventListener("click",r=>m(this,void 0,void 0,function*(){r.preventDefault(),r.stopPropagation(),p.selectedFilmUUID=t.id||"",console.log("Visiteur ",t.id),p.filterNameCinema="all",yield p.sauverEtatGlobal(),window.location.href="films.html"})))});const a=document.getElementById("progressIndicator");a&&(a.style.display="none")}catch(e){console.error("Erreur lors du chargement des films",e)}finally{const e=document.getElementById("progressIndicator");e?(e.style.removeProperty("display"),e.style.display="none",e.classList.add("hidden"),console.log("Descativation progress")):console.error("Pas d'indicateur")}}})}function g(l,e){const c=`
        <div class="modalyoutube-content">
            <span class="closeyoutube">&times;</span>
            <!-- Vid\xE9o YouTube -->
            <iframe id="youtubeVideo" width="560" height="315" src="${l}?autoplay=1" title="YouTube video player" frameborder="0"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                referrerpolicy="strict-origin-when-cross-origin" allowfullscreen>
            </iframe>
        </div>
  `;e.innerHTML="",e.innerHTML=c;const i=e?.querySelector(".closeyoutube");if(e&&i){const a=()=>{e.style.display="none";const t=e.querySelector("iframe");t&&(t.src="")};i.removeEventListener("click",a),i.addEventListener("click",a),e.addEventListener("click",t=>{t.target===e&&a()}),e.style.display="flex"}}
