"use strict";var l=function(B,e,r,t){function i(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(o){try{n(t.next(o))}catch(d){a(d)}}function u(o){try{n(t.throw(o))}catch(d){a(d)}}function n(o){o.done?s(o.value):i(o.value).then(c,u)}n((t=t.apply(B,e||[])).next())})};import{filmsSelectAllApi as g,filmsUpdateApi as M,filmsCreateApi as L,employeUpdateApi as $,getVersionApi as F}from"./NetworkController.js";import{sallesSelectAllApi as _,sallesUpdateApi as U,sallesCreateApi as N,seancesDisplayByCinemaApi as E,seancesseulesCreateApi as R,seancesseulesUpdateApi as J,seancesseulesSelectApi as O,sallesSelectCinemaApi as k,reservationsByCinemaApi as C,reservationAvisUpdateApi as b,employesSelectAllApi as j,getEmployeByMatriculeApi as w,employeCreateApi as H,employeDeleteApi as V,getReservationStatsApi as x}from"./NetworkController.js";import{majFooterVersion as K}from"./ViewFooter.js";export class DataControllerIntranet{static majVersion(){return l(this,void 0,void 0,function*(){var e,r,t;this.version=yield F(),K(((e=this.version.MAJEURE)===null||e===void 0?void 0:e.toString(10))||"",((r=this.version.MINEURE)===null||r===void 0?void 0:r.toString(10))||"",((t=this.version.BUILD)===null||t===void 0?void 0:t.toString(10))||"")})}static allFilms(){return l(this,void 0,void 0,function*(){try{const e=yield F(),r=yield g();return r.length>0&&(this._filmMustBeFetched=!1,this._allFilms=r),r}catch(e){return this._filmMustBeFetched=!0,console.error(e),this._allFilms=[],[]}})}static createOrUpdateFilm(e){return l(this,void 0,void 0,function*(){try{let r;return this._filmMustBeFetched&&(yield this.allFilms()),this._allFilms.find(i=>i.id===e.id)?r=yield M(e.id,e):r=yield L(e),r.message==="OK"?(this._filmMustBeFetched=!0,!0):(console.error(r.message),!1)}catch(r){return console.error(r),!1}})}static salleSort(e){return e.sort((r,t)=>{var i,s,a,c;const u=((i=r.nameCinema)===null||i===void 0?void 0:i.toLowerCase())||"",n=((s=t.nameCinema)===null||s===void 0?void 0:s.toLowerCase())||"",o=((a=r.nameSalle)===null||a===void 0?void 0:a.toLowerCase())||"",d=((c=t.nameSalle)===null||c===void 0?void 0:c.toLowerCase())||"";return u<n?-1:u>n?1:o<d?-1:o>d?1:0})}static allSalles(){return l(this,void 0,void 0,function*(){try{const e=this.salleSort(yield _());return e.length>0&&(this._salleMustBeFetched=!1,this._allSalles=e),e}catch(e){return this._salleMustBeFetched=!0,console.error(e),this._allSalles=[],[]}})}static createOrUpdateSalle(e){return l(this,void 0,void 0,function*(){try{let r;return this._salleMustBeFetched&&(yield this.allSalles()),this._allSalles.find(i=>i.id===e.id)?r=yield U(e.id,e):r=yield N(e),r.message==="OK"?(this._salleMustBeFetched=!0,!0):(console.error(r.message),!1)}catch(r){return console.error(r),!1}})}static get filterNameCinema(){return DataControllerIntranet._filterNameCinema||"all"}static set filterNameCinema(e){if(e.trim()==="")throw new Error("Le nom du cin\xE9ma ne peut pas \xEAtre vide.");DataControllerIntranet._filterNameCinema=e.trim()}static seanceSort(e){return e.sort((r,t)=>{var i,s,a,c,u,n,o,d;const f=((i=r.titleFilm)===null||i===void 0?void 0:i.toLowerCase())||"",h=((s=t.titleFilm)===null||s===void 0?void 0:s.toLowerCase())||"",m=((a=r.nameSalle)===null||a===void 0?void 0:a.toLowerCase())||"",v=((c=t.nameSalle)===null||c===void 0?void 0:c.toLowerCase())||"",p=((u=r.dateJour)===null||u===void 0?void 0:u.toLowerCase())||"",y=((n=t.dateJour)===null||n===void 0?void 0:n.toLowerCase())||"",S=((o=r.hourBeginHHSMM)===null||o===void 0?void 0:o.toLowerCase())||"",A=((d=t.hourBeginHHSMM)===null||d===void 0?void 0:d.toLowerCase())||"";return p<y?-1:p>y?1:m<v?-1:m>v?1:S<A?-1:S>A?1:0})}static getSeancesDisplayFilter(){return l(this,void 0,void 0,function*(){try{return DataControllerIntranet.seanceSort(yield E([DataControllerIntranet._filterNameCinema||"all"]))}catch(e){return console.error(`Erreur dans recherche des seanceDisplay : ${e}`),[]}})}static getSeancesDisplayByCinema(e){return l(this,void 0,void 0,function*(){try{return DataControllerIntranet.seanceSort(yield E(e))}catch(r){return console.error(`Erreur dans recherche des seanceDisplay : ${r}`),[]}})}static createOrUpdateSeance(e){return l(this,void 0,void 0,function*(){let r={message:""};try{try{(yield O(e.id))?r.message="update":r.message="create"}catch{r.message="create"}return r.message==="create"?r=yield R(e):r=yield J(e.id,e),r}catch(t){switch(r.message){case"":console.error(`Erreur dans la recherche de seance : ${t} , id = ${e.id}`);break;case"update":console.error(`Erreur dans l'update de seance : ${t}, seance = ${JSON.stringify(e)}`);break;case"create":console.error(`Erreur dans le create de seance : ${t}, seance = ${JSON.stringify(e)}`);break;default:console.error(`Erreur inconue dans le create/update de seance : ${t}, seance = ${JSON.stringify(e)}`);break}return r}})}static getListFilmsAll(){return l(this,void 0,void 0,function*(){try{const e=yield g();return Array.from(new Map(e.filter(t=>t.id&&t.titleFilm&&t.isActiveForNewSeances).map(t=>[t.id,{id:t.id,titre:t.titleFilm,duration:t.duration,affiche:t.imageFilm128}])).values())}catch(e){return console.error(`Erreur recup\xE9ration ListFilmsAll : ${e}`),[]}})}static getSallesByFilter(){return l(this,void 0,void 0,function*(){try{let e="";DataControllerIntranet._filterNameCinema?e=DataControllerIntranet._filterNameCinema:e="all";let r=[];e==="all"?r=yield _():r=yield k(e);let t;return e==="all"?t=Array.from(new Map(r.filter(i=>i.id&&i.nameSalle).map(i=>[i.id,{id:i.id,nomSalle:i.nameCinema+"-"+i.nameSalle,capacite:i.capacity,numPMR:i.numPMR,nameCinema:i.nameCinema}])).values()):t=Array.from(new Map(r.filter(i=>i.id&&i.nameSalle).map(i=>[i.id,{id:i.id,nomSalle:i.nameSalle,capacite:i.capacity,numPMR:i.numPMR}])).values()),t}catch(e){return console.error(`Erreur recup\xE9ration ListFilmsAll : ${e}`),[]}})}static reservationSort(e){return e.sort((r,t)=>{var i,s,a,c,u,n;const o=((i=r.titleFilm)===null||i===void 0?void 0:i.toLowerCase())||"",d=((s=t.titleFilm)===null||s===void 0?void 0:s.toLowerCase())||"",f=((a=r.displayName)===null||a===void 0?void 0:a.toLowerCase())||"",h=((c=t.displayName)===null||c===void 0?void 0:c.toLowerCase())||"",m=((u=r.dateJour)===null||u===void 0?void 0:u.toLowerCase())||"",v=((n=t.dateJour)===null||n===void 0?void 0:n.toLowerCase())||"";return m<v?-1:m>v?1:o<d?-1:o>d?1:f<h?-1:f>h?1:0})}static getReservationForUtilisateurFilter(){return l(this,void 0,void 0,function*(){try{return DataControllerIntranet.reservationSort(yield C([DataControllerIntranet._filterNameCinema||"all"]))}catch(e){return console.error(`Erreur dans recherche des reservations : ${e}`),[]}})}static getReservationForUtilisateurByCinema(e){return l(this,void 0,void 0,function*(){try{return DataControllerIntranet.reservationSort(yield C(e))}catch(r){return console.error(`Erreur dans recherche des reservations : ${r}`),[]}})}static updateReservationAvis(e){return l(this,void 0,void 0,function*(){let r={message:""};try{return r=yield b(e.id,e),r}catch(t){return console.error(`Erreur inconue dans la mise \xE0 jour de l'avis : ${t}, Avis = ${JSON.stringify(e)}`),r}})}static getListEmployesAll(){return l(this,void 0,void 0,function*(){try{return yield j()}catch(e){return console.error(`Erreur recup\xE9ration ListEmployesAll : ${e}`),[]}})}static getEmployesByMatricule(e){return l(this,void 0,void 0,function*(){try{return yield w(e)}catch(r){console.error(`Erreur recup\xE9ration ListEmployesAll : ${r}`)}})}static createOrUpdateEmploye(e,r){return l(this,void 0,void 0,function*(){let t={message:""};try{try{(yield w(e.matricule))?t.message="update":t.message="create"}catch{t.message="create"}return t.message==="create"?t=yield H(e,r):t=yield $(e,r),t}catch(i){switch(t.message){case"":console.error(`Erreur dans la recherche de employe : ${i} , matricule = ${e.matricule}`);break;case"update":console.error(`Erreur dans l'update de employe : ${i}, employe = ${JSON.stringify(e)}`);break;case"create":console.error(`Erreur dans le create de employe : ${i}, employe = ${JSON.stringify(e)}`);break;default:console.error(`Erreur inconue dans le create/update de employe : ${i}, employe = ${JSON.stringify(e)}`);break}throw i}})}static deleteEmploye(e){return l(this,void 0,void 0,function*(){try{yield V(e)}catch(r){console.log("Erreur delete Employ\xE9",r)}})}static getReservationStatsAll(){return l(this,void 0,void 0,function*(){try{return yield x()}catch(e){return console.error(`Erreur recup\xE9ration ReservationState : ${e}`),[]}})}constructor(){console.log("DataCIntranet : Initialisation")}}DataControllerIntranet.version={idInt:0,MAJEURE:0,MINEURE:0,BUILD:0,dateMaj:new Date("01/01/1980")},DataControllerIntranet._filmMustBeFetched=!0,DataControllerIntranet._allFilms=[],DataControllerIntranet._salleMustBeFetched=!0,DataControllerIntranet._allSalles=[];
