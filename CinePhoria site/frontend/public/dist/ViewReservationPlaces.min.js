"use strict";var I=function(g,o,f,n){function C(u){return u instanceof f?u:new f(function(E){E(u)})}return new(f||(f=Promise))(function(u,E){function r(m){try{l(n.next(m))}catch(b){E(b)}}function a(m){try{l(n.throw(m))}catch(b){E(b)}}function l(m){m.done?u(m.value):C(m.value).then(r,a)}l((n=n.apply(g,o||[])).next())})};import{seanceCardView as H,basculerPanelChoix as G,updateContentPage as j}from"./ViewReservation.js";import{dataController as e}from"./DataController.js";import{validateEmail as T,showCustomAlert as k}from"./Helpers.js";import{ReservationState as R}from"./shared-models/Reservation.js";import{setReservationApi as O,confirmUtilisateurApi as W,confirmCompteApi as J,confirmReserveApi as K,getPlacesReservationApi as Q,getSeatsBookedApi as X}from"./NetworkController.js";import{userDataController as B,ProfilUtilisateur as D}from"./DataControllerUser.js";import{login as V}from"./Login.js";export function updateContentPlace(){return I(this,void 0,void 0,function*(){try{const g=document.getElementById("seances__cardseance-selected");if(!g){console.log("Pas de carte selectionn\xE9e");return}yield e.updateSeances([e.selectedSeanceUUID]);const o=H(e.seanceSelected(),e.selectedSeanceDate,"seances__cardseance-selected");if(g.replaceWith(o),e.reservationState===R.PendingChoiceSeance||e.reservationState===R.PendingChoiceSeats){const f=document.querySelector(".panel__changer-button");f&&(f.removeEventListener("click",()=>I(this,void 0,void 0,function*(){})),f.addEventListener("click",n=>I(this,void 0,void 0,function*(){n.preventDefault(),n.stopPropagation(),e.reservationState=R.PendingChoiceSeance,e.selectedSeanceUUID=void 0,yield e.sauverEtatGlobal(),G(),j(e)}))),yield Z()}}catch(g){console.error("Erreur lors de l'affichage du content de selection des places : ",g)}})}function Z(){return I(this,void 0,void 0,function*(){var g,o,f;function n(){const t=e.selectedListSeats||"",c=document.querySelector(".commande__seats");c.style.display="flex";const v=document.getElementById("libelle__seats"),s=document.getElementById("text__seats");if(!(!v||!s))if(t==="")v.textContent="Pas de sieges pr\xE9cis\xE9s",s.textContent="";else{const L=t.includes(",")?"s":"";v.textContent=`Si\xE8ge${L} r\xE9serv\xE9${L} : `,s.textContent=t}}console.log("Affichage de la reservation de place"),e.reservationState=R.PendingChoiceSeats;const C=e.seanceSelected().qualite,u=Math.min(parseInt((g=e.seanceSelected().capacity)!==null&&g!==void 0?g:"10",10),8),E=Math.min(parseInt((o=e.seanceSelected().numPMR)!==null&&o!==void 0?o:"0",10),8),r=document.querySelector(".commande__tabtarif");if(!r)return;if(r.innerHTML="",C){const t=yield updateTableContent(C,void 0,void 0,u);r.appendChild(t)}const a=document.querySelector(".commande__pmr"),l=ee(E);if(!a)throw new Error("updateInputPMT");a.innerHTML="",a.appendChild(l);const m=document.getElementById("commande__mail-input"),b=document.getElementById("commande__mail-error");if(!m||!b)return;if(B.profil()===D.Utilisateur){const t=(f=B.compte())===null||f===void 0?void 0:f.email;t&&(m.value=t,m.disabled=!0);const c=document.getElementById("commande__mail-p");c.innerHTML="Votre email ";const v=document.getElementById("commande__mail-span");v.hidden=!0}else m.value="",m.removeEventListener("blur",()=>{}),m.addEventListener("blur",()=>{T(m.value)?b.textContent="":(b.textContent="Email invalide (exemple: utilisateur@domaine.com)",b.style.color="red")});const p=document.querySelector(".panel__choisirSeats-button");if(p.classList.add("inactif"),p.disabled=!0,!p)return;e.selectedListSeats=void 0;const y=document.querySelector(".panel__jereserve-button");if(y.classList.add("inactif"),y.disabled=!0,y.textContent="Je choisis ces places",!y)return;const _=document.getElementById("content-totalprice");if(!_)return;function h(){const t=T(m.value),c=parseInt(_?.textContent||"0",10)>0;c?(p.classList.remove("inactif"),p.disabled=!1):(p.classList.add("inactif"),p.disabled=!0),t&&c&&["PendingChoiceSeance","PendingChoiceSeats","ReserveConfirmed"].includes(e.reservationState)?(y.classList.remove("inactif"),y.disabled=!1):(y.classList.add("inactif"),y.disabled=!0)}m.addEventListener("input",h),new MutationObserver(()=>{console.log("Changement...."),h();const t=document.querySelector(".panel__choisirSeats-button");t.textContent="Choisir les fauteuils",e.selectedListSeats="",n()}).observe(_,{characterData:!0,childList:!0,subtree:!0}),p.removeEventListener("click",t=>I(this,void 0,void 0,function*(){})),p.addEventListener("click",t=>I(this,void 0,void 0,function*(){t.preventDefault(),t.stopPropagation(),console.log("Choix des si\xE8ges");const{totalPlaces:c,tarifSeatsMap:v}=F(".tabtarif__commande-table"),s=N(".commande__pmr");console.log(`Nombre de PMR = ${s}`);const S=e.seanceSelected().seatsAbsents.split(",").map(d=>d.trim().replace(/^"|"$/g,"")),{siegesReserves:M}=yield X(e.seanceSelected().seanceId);console.log("Liste des sieges 1 = ",M);const w=M?M.split(",").map(d=>d.trim().replace(/^"|"$/g,"")):[];console.log("Liste des si\xE8ges r\xE9serv\xE9s en tableau =",w),console.log("MaxPMR = ",parseInt(e.seanceSelected().numPMR,10)),console.log("Seance = ",JSON.stringify(e.seanceSelected())),onClickdisplayAndSeatsReserve(c,s,w,S,parseInt(e.seanceSelected().rMax,10),parseInt(e.seanceSelected().fMax,10),parseInt(e.seanceSelected().numPMR,10)).then(d=>{if(d.length>0){e.selectedListSeats=d.join(",");const x=document.querySelector(".panel__choisirSeats-button");if(x){let U="";d.length>1&&(U="s"),x.textContent=`${d.length} si\xE8ge${U} choisi${U}`}n(),console.log("Liste des places = ",d)}}).catch(d=>{console.error("Erreur lors de la s\xE9lection des places :",d)})})),y.removeEventListener("click",t=>I(this,void 0,void 0,function*(){})),y.addEventListener("click",t=>I(this,void 0,void 0,function*(){y.disabled=!0,y.classList.add("inactif"),y.classList.add("loading"),t.preventDefault(),t.stopPropagation(),console.log("Statut Reservation "+e.reservationState);const{totalPlaces:c,tarifSeatsMap:v}=F(".tabtarif__commande-table");console.log(`Nombre de places total = ${c}, R\xE9partition = ${v}`);const s=N(".commande__pmr");console.log(`Nombre de PMR = ${s}`);const L=yield Y(".commande__mail-input");console.log(`email = ${L}`);try{const S=e.seanceSelected().seanceId,M=e.selectedListSeats||"",{statut:w,utilisateurId:d,reservationId:x}=yield O(L,S,v,s,M);switch(e.selectedUtilisateurUUID=d,e.selectedReservationUUID=x,e.selectedUtilisateurMail=L,w){case"Compte Provisoire":console.log("Compte provisoire , "+d+" , "+x),e.reservationState=R.ReserveCompteToConfirm,yield e.sauverEtatGlobal(),yield confirmUtilisateur();break;case"Compte Confirme":if(B.profil()===D.Utilisateur){B.ident=m.value.trim(),yield B.init(),yield confirmReserve(),yield B.init();const U=B.profil();window.location.href=U}console.log("Compte Confirme , "+d+" , "+x),e.reservationState=R.ReserveToConfirm,yield e.sauverEtatGlobal(),yield V("Veuillez vous connecter pour valider la r\xE9servation");break;default:yield k(`Une erreur s'est produite : statut inconnu -> ${w} , ${d} , ${x}`);break}}catch(S){console.error("Erreur lors de la cr\xE9ation de la r\xE9servation",S),yield k(`Une erreur s'est produite : ${S?.message||"inconnue"}`)}finally{y.classList.remove("loading")}}))})}function F(g){const o=document.querySelector(g);let f=0;const n={};return o?(o.querySelectorAll("tr.body__content-tr").forEach(u=>{var E;const r=u.dataset.tarifid||"";console.log("TarifId = ",r);const a=u.querySelector(".num__num-span#num__place"),l=a?parseInt((E=a.textContent)!==null&&E!==void 0?E:"0",10):0;l>0&&r&&(n[r]=l),f+=l}),{totalPlaces:f,tarifSeatsMap:n}):{totalPlaces:0,tarifSeatsMap:n}}function N(g){var o;const f=document.querySelector(g);if(!f)return 0;const n=f.querySelector(".num__num-span#num__pmr");return n?parseInt((o=n.textContent)!==null&&o!==void 0?o:"0",10):0}function Y(g){return I(this,void 0,void 0,function*(){const o=document.querySelector(g);return o?o.value.trim():""})}export function updateTableContent(g){return I(this,arguments,void 0,function*(o,f=!1,n="",C=8){const u=document.createElement("table");u.classList.add("tabtarif__commande-table");const E=document.createElement("thead");E.classList.add("commande__entete-thead"),E.innerHTML=`
      <tr class="entete__content-tr">
        <th class="content-th content-id-th">#</th>
        <th class="content-th content-tarif-th">Tarif</th>
        <th class="content-th content-places-th">Places</th>
        <th class="content-th content-total-th">Total</th>
      </tr>
    `,u.appendChild(E);const r=document.createElement("tbody");r.classList.add("commande__body-tbody"),u.appendChild(r);const a=document.createElement("tfoot");a.classList.add("commande__foot-tfoot"),a.innerHTML=`
      <tr class="foot__content-tr">
      
        <td></td> <td></td> <td></td>
        <td class="content-td content-totalprice-td" id = "content-totalprice">0 \u20AC</td>
      </tr>
    `,u.appendChild(a);const l=a.querySelector(".content-totalprice-td");if(f){let b=[];n!==""?b=yield Q(n):console.error("updateTableContent : Pas de reservation communiquee pour un affichage de reservation");let p=1;b.forEach(_=>{const h=document.createElement("tr");h.classList.add("body__content-tr");const i=document.createElement("td");i.classList.add("content-td","content-id-td"),i.textContent=String(p);const t=document.createElement("td");t.classList.add("content-td","content-tarif-td"),t.textContent=`${_.nameTarif} (${_.numberSeats}\u20AC)`;const c=document.createElement("td");c.classList.add("content-td","content-num-td");const v=document.createElement("span");v.classList.add("num__num-span"),v.id="num__place",v.textContent=String(_.numberSeats)||"",c.appendChild(v);const s=document.createElement("td");s.classList.add("content-td","content-price-td"),s.textContent=`${String(_.numberSeats*_.price)} \u20AC`,h.appendChild(i),h.appendChild(t),h.appendChild(c),h.appendChild(s),r.appendChild(h),p++});const y=b.reduce((_,h)=>_+(h.numberSeats||1)*(h.price||1),0);l.textContent=`${String(y)} \u20AC`}else{let y=function(){let _=0;r.querySelectorAll("tr.body__content-tr").forEach(h=>{var i,t;const c=h.querySelector(".content-price-td");if(c){const v=(t=(i=c.textContent)===null||i===void 0?void 0:i.replace(" \u20AC",""))!==null&&t!==void 0?t:"0",s=parseFloat(v)||0;_+=s}}),l.textContent=`${_} \u20AC`};var m=y;const b=e.allTarifQualite.filter(_=>_.qualite===o);let p=1;b.forEach(_=>{var h;const i=document.createElement("tr");i.setAttribute("data-tarifid",_.id),i.classList.add("body__content-tr");const t=document.createElement("td");t.classList.add("content-td","content-id-td"),t.textContent=String(p);const c=document.createElement("td");c.classList.add("content-td","content-tarif-td");const v=_.price?parseFloat(_.price):0;c.textContent=`${(h=_.nameTarif)!==null&&h!==void 0?h:""} (${v}\u20AC)`;const s=document.createElement("td");s.classList.add("content-td","content-num-td");const L=document.createElement("button");L.classList.add("num__remove-button"),L.textContent="-";const S=document.createElement("span");S.classList.add("num__num-span"),S.id="num__place",S.textContent="0";const M=document.createElement("button");M.classList.add("num__add-button"),M.textContent="+",s.appendChild(L),s.appendChild(S),s.appendChild(M);const w=document.createElement("td");w.classList.add("content-td","content-price-td"),w.textContent="0 \u20AC",i.appendChild(t),i.appendChild(c),i.appendChild(s),i.appendChild(w),r.appendChild(i);function d(){var x;const U=parseInt((x=S.textContent)!==null&&x!==void 0?x:"0",10)||0,P=v*U;w.textContent=`${P} \u20AC`,y()}M.addEventListener("click",x=>I(this,void 0,void 0,function*(){var U;x.preventDefault(),x.stopPropagation();let P=parseInt((U=S.textContent)!==null&&U!==void 0?U:"0",10)||0,q=0;r.querySelectorAll("span#num__place").forEach($=>{var A;const z=parseInt((A=$.textContent)!==null&&A!==void 0?A:"0",10)||0;q+=z}),q<C?(P++,S.textContent=String(P),d()):yield k(`Vous ne pouvez pas r\xE9server plus de ${C} places au total.`)})),L.addEventListener("click",x=>{var U;x.preventDefault(),x.stopPropagation();let P=parseInt((U=S.textContent)!==null&&U!==void 0?U:"0",10)||0;P>0&&(P--,S.textContent=String(P),d())}),p++})}return u})}function ee(g){const o=document.createElement("div");if(o.classList.add("pmr__content"),g===0)return o;const f=document.createElement("p");f.classList.add("content__libelle-p"),f.textContent="Personne \xE0 mobilit\xE9 r\xE9duite :";const n=document.createElement("div");n.classList.add("content__num-pmr");const C=document.createElement("button");C.classList.add("num__remove-button","num__remove-pmr"),C.textContent="-";const u=document.createElement("span");u.classList.add("num__num-span","num__numpmr-span"),u.id="num__pmr",u.textContent="0";const E=document.createElement("button");if(E.classList.add("num__add-button","num__add-pmr"),E.textContent="+",!E||!C||!u)throw new Error("Erreur updateInputPMR");return E.removeEventListener("click",r=>{}),C.removeEventListener("click",r=>{}),u.textContent="0",E.addEventListener("click",r=>{var a;r.preventDefault(),r.stopPropagation();let l=parseInt((a=u.textContent)!==null&&a!==void 0?a:"0",10)||0;l<g?(l++,u.textContent=String(l)):alert(`Vous ne pouvez pas r\xE9servez plus de ${g} places PMR`)}),C.addEventListener("click",r=>{var a;r.preventDefault(),r.stopPropagation();let l=parseInt((a=u.textContent)!==null&&a!==void 0?a:"0",10)||0;l>0&&(l--,u.textContent=String(l))}),n.appendChild(C),n.appendChild(u),n.appendChild(E),o.appendChild(f),o.appendChild(n),o}export function confirmUtilisateur(){return I(this,void 0,void 0,function*(){const g=`
    <!-- Modale confirmUtilisateur -->
    <div id="modal-confirmUtilisateur" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <div class="title-h2">
                    <h2>Cr\xE9ation du compte</h2>
                </div>
                <!-- Bouton (X) ou autre m\xE9canisme pour fermer la modale si besoin -->
                <span class="close-modal" id="close-confirmUtilisateur">\xD7</span>
            </div>
            <div class="modal__content">
                <div class="title-p">
                    <p>Pour r\xE9cup\xE9rer le QRCode de votre r\xE9servation, vous devez cr\xE9er un compte CinePhoria en
                        enregistrant
                        les
                        informations suivantes :</p>
                </div>
                <!-- Saisie de l'email -->
                <div class="form__group">
                    <label for="confirmUtilisateur-email">Email :</label>
                    <input type="email" id="confirmUtilisateur-email" class="input__mail" disabled>
                    <span id="email-error" class="error-message"></span>
                </div>

                <!-- Saisie du displayName -->
                <div class="form__group">
                    <label for="confirmUtilisateur-displayName">Nom ou pseudo :</label>
                    <input type="text" id="confirmUtilisateur-displayName" class="input__text" required />
                </div>

                <!-- Mot de passe 1 -->
                <div class="form__group">
                    <label for="confirmUtilisateur-password1">Mot de passe :</label>
                    <input type="password" id="confirmUtilisateur-password1" required />
                </div>
                <!-- Message d'erreur de force du mot de passe -->
                <div class="form__group">
                    <span id="password-strength-error" class="error-message">Le mot de passe doit comporter au moins 8 caract\xE8res, une majuscule, une minuscule, un chiffre et un caract\xE8re sp\xE9cial.</span>
                </div>
                <!-- Mot de passe 2 -->
                <div class="form__group">
                    <label for="confirmUtilisateur-password2">Confirmer le mot de passe :</label>
                    <input type="password" id="confirmUtilisateur-password2" required />
                    <span id="password-error" class="error-message"></span>
                </div>
                <!-- Bouton de validation -->
                <button id="confirmUtilisateur-submit" class="button button-primary" disabled>
                    Valider
                </button>
            </div>
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=g,document.body.appendChild(o);const f=e.selectedUtilisateurMail||"";console.log("===> confirmUtilisateur action, email =",f);const n=o.querySelector("#modal-confirmUtilisateur"),C=document.getElementById("close-confirmUtilisateur"),u=document.getElementById("confirmUtilisateur-submit");if(n&&C&&u){n.style.display="flex";const a=()=>{n.style.display="none",window.location.reload()};C.addEventListener("click",a),n.addEventListener("click",l=>{l.target===n&&a()}),yield E()}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal modal-confirmUtilisateur sont introuvables.");function E(){return I(this,void 0,void 0,function*(){const a=e.selectedUtilisateurMail||"",l=o.querySelector("#confirmUtilisateur-displayName"),m=o.querySelector("#confirmUtilisateur-email"),b=o.querySelector("#confirmUtilisateur-password1"),p=o.querySelector("#confirmUtilisateur-password2"),y=o.querySelector("#confirmUtilisateur-submit"),_=o.querySelector("#email-error"),h=o.querySelector("#password-error"),i=o.querySelector("#password-strength-error");i.style.minHeight="1.2em",h.style.minHeight="1.2em",l.value="",m.value=a;function t(){return b.value===p.value&&b.value.length>0}function c(){return l.value.trim()!==""&&m.value.trim()!==""&&b.value.trim()!==""&&p.value.trim()!==""}function v(){const s=T(m.value),L=b.value===p.value&&b.value.length>0,S=c();let M=!1;L&&(M=/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(b.value)),L?M?i.textContent="":(i.textContent="Le mot de passe doit comporter au moins 8 caract\xE8res, une majuscule, une minuscule, un chiffre et un caract\xE8re sp\xE9cial.",i.style.color="red"):i.textContent="",!L&&p.value.length>0?(h.textContent="Les mots de passe ne correspondent pas.",h.style.color="red"):h.textContent="",s&&M&&L&&S?(y.classList.remove("inactif"),y.disabled=!1):(y.classList.add("inactif"),y.disabled=!0)}m.value=a,y.classList.add("inactif"),m.addEventListener("blur",()=>{T(m.value)?_.textContent="":(_.textContent="Email invalide (exemple: utilisateur@domaine.com)",_.style.color="red")}),l.addEventListener("input",v),b.addEventListener("input",v),p.addEventListener("input",v),y.removeEventListener("click",s=>I(this,void 0,void 0,function*(){})),y.addEventListener("click",s=>I(this,void 0,void 0,function*(){s.preventDefault(),s.stopPropagation(),e.selectedUtilisateurUUID&&(yield r(e.selectedUtilisateurUUID,m.value.trim(),b.value.trim(),l.value.trim()))&&(n&&(n.style.display="none"),e.reservationState=R.ReserveMailToConfirm,yield confirmMail(),yield e.sauverEtatGlobal())}))})}function r(a,l,m,b){return I(this,void 0,void 0,function*(){return(yield W(a,m,b)).statut==="OK"?(e.reservationState=R.ReserveMailToConfirm,e.selectedUtilisateurDisplayName=b,e.selectedUtilisateurMail=l,!0):!1})}})}export function confirmMail(){return I(this,void 0,void 0,function*(){const g=`
    <!-- Modale confirmMail -->
    <div id="modal-confirmMail" class="modal">
        <div class="modal__content-wrapper">
            <div class="modal__title">
                <div class="title-h2">
                    <h2>Verification adresse email</h2>
                </div>
                <!-- Bouton (X) ou autre m\xE9canisme pour fermer la modale si besoin -->
                <span class="close-modal" id="close-confirmMail">\xD7</span>
            </div>
            <div class="modal__content">
                <div class="confirmMail-title title-p" id="confirmMail-title">
                    <p>Vous avez du recevoir un email contenant un code de confirmation \xE0 six chiffres.</p>
                </div>
                <!-- Saisie du code de confirmation -->
                <div class="form__group">
                    <label for="confirmMail-code">Code de confirmation :</label>
                    <input type="text" id="confirmMail-code" class="input__code">
                    <span id="code-error" class="error-message"></span>
                </div>

                <!-- Bouton de validation -->
                <button id="confirmMail-submit" class="button button-primary" disabled>
                    Valider
                </button>
            </div>
        </div>
    </div>
    `,o=document.createElement("div");o.innerHTML=g,document.body.appendChild(o);const f=e.selectedUtilisateurMail||"";console.log("===> confirmMail action, email =",f);const n=document.getElementById("modal-confirmMail"),C=document.getElementById("close-confirmMail"),u=document.getElementById("confirmMail-submit");if(n&&C&&u){n.style.display="flex";const r=()=>{n.style.display="none",window.location.reload()};C.addEventListener("click",r),n.addEventListener("click",a=>{a.target===n&&r()}),yield E()}else console.error("Un ou plusieurs \xE9l\xE9ments requis pour le fonctionnement de la modal modal-confirmMail sont introuvables.");function E(){return I(this,void 0,void 0,function*(){const r=document.getElementById("confirmMail-code"),a=document.getElementById("confirmMail-submit"),l=document.getElementById("code-error"),m=document.getElementById("confirmMail-title");if(m){let h=function(){return r.value.trim()!==""},i=function(){h()?(a.classList.remove("inactif"),a.disabled=!1):(a.classList.add("inactif"),a.disabled=!0)},t=function(c){return/^[0-9]{6}$/.test(c)};var p=h,y=i,_=t;r.value="",m.textContent=`
Nous avons envoy\xE9 \xE0 l'adresse (${e.selectedUtilisateurMail||""}) 
un code \xE0 renseigner ci-dessous.
`,a.classList.add("inactif"),r.addEventListener("blur",()=>{t(r.value)?l.textContent="":(l.textContent="Le code se compose de 6 chiffres (exemple : 123456)",l.style.color="red")}),r.addEventListener("input",i),a.removeEventListener("click",c=>I(this,void 0,void 0,function*(){})),a.addEventListener("click",c=>I(this,void 0,void 0,function*(){if(c.preventDefault(),c.stopPropagation(),!!e.selectedUtilisateurUUID)try{if(yield b(e.selectedUtilisateurMail||"",r.value.trim())){const v=document.getElementById("modal-confirmMail");v&&(v.style.display="none"),e.reservationState=R.ReserveToConfirm,yield e.sauverEtatGlobal(),yield V("Veuillez vous connecter pour valider la r\xE9servation")}}catch(v){console.log("Erreur = ",v);const s=v;s&&(l.textContent=s)}}))}function b(h,i){return I(this,void 0,void 0,function*(){const t=yield J(h,i);if(t.statut==="OK")return e.reservationState=R.ReserveToConfirm,!0;throw new Error(t.statut)})}})}})}export function confirmReserve(){return I(this,void 0,void 0,function*(){const g=e.selectedReservationUUID,o=e.selectedUtilisateurUUID,f=e.selectedSeanceUUID;if(g&&o&&f)try{console.log("Appel sur R U S",g," ",o," ",f),yield K(g,o,f),yield k("votre reservation est confirm\xE9e"),e.reservationState=R.PendingChoiceSeance,e.selectedReservationUUID=void 0,e.selectedSeanceUUID=void 0,e.selectedUtilisateurUUID=void 0,e.selectedListSeats=void 0,yield e.sauverEtatGlobal()}catch(n){alert("Erreur dans la confirmation de la r\xE9servation = "+n)}})}export function onClickdisplayAndSeatsReserve(g,o,f){return I(this,arguments,void 0,function*(n,C,u,E=[],r=20,a=10,l=2){return new Promise(m=>{console.log("Nombre total de siege = "+n+" dont nombre de PMR = "+C);const b=`
      <div class="modal__content-wrapper">
        <div class="modal__title">
          <div class="title__displayAndSeatsReserve title-h2">
            <h2>S\xE9lectionner les places</h2>
          </div>
          <span class="close-modal" id="close-displayAndSeatsReserve">\xD7</span>
        </div>
        <div class="modal__content" id="content__displayAndSeatsReserve"></div>
        <div class="modal__footer" style="margin-top: 10px; display:flex; gap:10px; justify-content: end;">
          <button id="btnAnnulerSeats" class="button">Annuler</button>
          <button id="btnValiderSeats" class="button inactif" disabled>Valider</button>
        </div>
      </div>`;let p=document.getElementById("modal-displayAndSeatsReserve");p||(p=document.createElement("div"),p.id="modal-displayAndSeatsReserve",p.classList.add("modal"),document.body.appendChild(p)),p.innerHTML=b,p.style.display="flex";const y=document.getElementById("close-displayAndSeatsReserve"),_=document.getElementById("content__displayAndSeatsReserve"),h=document.getElementById("btnAnnulerSeats"),i=document.getElementById("btnValiderSeats"),t=[],c=s=>{p.style.display="none",m(s)};y?.addEventListener("click",()=>c([])),p.addEventListener("click",s=>{s.target===p&&c([])}),h?.addEventListener("click",()=>c([])),i?.removeEventListener("click",()=>{}),i?.addEventListener("click",()=>{c([...t])});function v(){const s=t.filter(S=>S.startsWith("R0F")).filter(S=>parseInt(S.split("F")[1],10)<l).length,L=t.length-s;s===C&&L+C===n?(i?.classList.remove("inactif"),i&&(i.disabled=!1)):(i?.classList.add("inactif"),i&&(i.disabled=!0))}if(_)for(let s=0;s<r;s++){const L=document.createElement("div");L.style.display="flex",L.style.flexDirection="row",L.style.margin="2px 0";const S=document.createElement("span");S.textContent=`R${s} `,S.style.width="40px",S.style.textAlign="right",L.appendChild(S);for(let M=0;M<a;M++){const w=`R${s}F${M}`;if(E&&E.includes(w)){const x=document.createElement("div");x.style.width="30px",x.style.height="30px",x.style.marginRight="4px",x.style.border="1px solid transparent",x.style.cursor="default",L.appendChild(x);continue}const d=document.createElement("div");d.style.width="30px",d.style.height="30px",d.style.marginRight="4px",d.style.display="flex",d.style.alignItems="center",d.style.justifyContent="center",d.style.cursor="pointer",d.style.fontSize="0.7em",d.style.borderRadius="4px",s===0&&M<l&&(d.textContent="PMR"),u&&u.includes(w)?(d.style.backgroundColor="red",d.style.cursor="not-allowed"):(d.style.backgroundColor="lightgray",d.removeEventListener("click",()=>I(this,void 0,void 0,function*(){})),d.addEventListener("click",()=>I(this,void 0,void 0,function*(){const x=s===0&&M<l;if(t.includes(w))t.splice(t.indexOf(w),1),d.style.backgroundColor="lightgray";else{if(t.length>=n){yield k(`Vous ne pouvez pas d\xE9passer un total de ${n} places.`);return}const U=t.filter(q=>q.startsWith("R0F")).filter(q=>parseInt(q.split("F")[1],10)<l).length,P=t.length-U;if(x){if(U>=C){alert(`Vous ne devez s\xE9lectionner que ${C} place(s) PMR maximum.`);return}}else if(P>=n-C){alert(`Vous ne pouvez s\xE9lectionner que ${n-C} place(s) classiques maximum.`);return}t.push(w),d.style.backgroundColor="green"}v()}))),L.appendChild(d)}_.appendChild(L)}v()})})}
