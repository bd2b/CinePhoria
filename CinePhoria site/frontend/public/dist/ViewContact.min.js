"use strict";var V=function(v,e,s,c){function y(a){return a instanceof s?a:new s(function(n){n(a)})}return new(s||(s=Promise))(function(a,n){function o(t){try{r(c.next(t))}catch(d){n(d)}}function i(t){try{r(c.throw(t))}catch(d){n(d)}}function r(t){t.done?a(t.value):y(t.value).then(o,i)}r((c=c.apply(v,e||[])).next())})};import{validateEmail as g}from"./Helpers.js";import{userDataController as w}from"./DataControllerUser.js";import{Mail as I}from"./shared-models/Mail.js";import{sendMailApi as x}from"./NetworkController.js";import{showCustomAlert as b}from"./Helpers.js";export function onClickContact(){var v;let e=document.getElementById("modal-contact");if(e||(e=document.createElement("div"),e.id="modal-contact",e.classList.add("modal"),document.body.appendChild(e)),!e)return;const s=(v=w.compte())===null||v===void 0?void 0:v.email;let c="";s&&g(s)&&(c=s);const y=`
  <div class="modal__content-wrapper">
    <div class="modal__title">
      <div class="title__Contact title-h2">
        <h2>Formulaire de contact</h2>
      </div>
      <span class="close-modal" id="close-contact">\xD7</span>
    </div>
    <div class="modal__content" id="content__Contact">
    <div class="form__group">
      
      <input type="text" id="contact-mail" placeholder="Adresse mail de r\xE9ponse (facultatif)" value="${c}" />
      <input type="text" id="contact-titre" placeholder="Quel est le sujet de votre demande ?" />
      <div>
      <label for="contact-desc">Dites nous en plus</label>
      <textarea id="contact-desc" rows="4" cols="40" placeholder="D\xE9tailler votre demande"></textarea>
      </div>
      <div class="modal__btns">
        <button id="contactAnnulerBtn" class="button">Annuler</button>
        <button id="contactEnvoyerBtn" class="button inactif" disabled>Envoyer votre demande</button>
      </div>
      <div>
      <span id="contact-error" style="color: red; font-size: 0.9em; display: none;"></span>
      </div>
    </div>
    </div>
  </div>
  `;e.innerHTML=y,document.body.appendChild(e),e.style.display="flex";const a=document.getElementById("close-contact"),n=document.getElementById("contact-mail"),o=document.getElementById("contact-titre"),i=document.getElementById("contact-desc"),r=document.getElementById("contactAnnulerBtn"),t=document.getElementById("contactEnvoyerBtn"),d=document.getElementById("contact-error"),p=()=>{e.style.display="none"};function f(){const l=n?.value.trim()||"";if(l&&!g(l)){h("Veuillez indiquer un email valide si vous souhaitez un retour."),u(!0);return}if(!(o?.value.trim()||"").split(/\s+/).some(B=>B.length>=3)){h("Veuillez pr\xE9ciser le sujet de votre demande"),u(!0);return}if((i?.value.trim()||"").split(/\s+/).filter(Boolean).filter(B=>B.length>=2).length<3){h("Veuillez d\xE9crire plus pr\xE9cis\xE9ment votre demande en 3 mots."),u(!0);return}C(),u(!1)}function h(l){d&&(d.style.display="inline",d.textContent=l)}function C(){d&&(d.style.display="none",d.textContent="")}function u(l){t&&(l?(t.classList.add("inactif"),t.disabled=!0):(t.classList.remove("inactif"),t.disabled=!1))}n?.addEventListener("input",f),o?.addEventListener("input",f),i?.addEventListener("input",f),a?.addEventListener("click",p),e.addEventListener("click",l=>{l.target===e&&p()}),r?.addEventListener("click",p),t?.addEventListener("click",()=>V(this,void 0,void 0,function*(){u(!0),t.classList.add("loading");const l=n?.value.trim()||"",E=o?.value.trim()||"",_=i?.value.trim()||"",L=new I(l,E,_,"false");try{const m=yield x(L);console.log("Resultat envoi mail = "+m.statut),m.statut.startsWith("OK")?yield b(`
        Votre demande a bien \xE9t\xE9 envoy\xE9e !

        Mail : ${l||"Pas de mail"}
        Titre : ${E}
        Description : ${_}`):yield b(`
        Nous n'avons pas pu envoyer votre demande.
        Merci de la renouveler ult\xE9rieurement.`)}catch(m){yield b("Erreur r\xE9seau ou serveur, veuillez r\xE9essayer."),console.error("Erreur lors de l'envoi du mail",m)}finally{t.classList.remove("loading"),u(!1),p()}})),f()}
