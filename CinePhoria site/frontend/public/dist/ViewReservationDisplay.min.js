"use strict";var s=function(r,o,c,a){function u(i){return i instanceof c?i:new c(function(l){l(i)})}return new(c||(c=Promise))(function(i,l){function d(t){try{e(a.next(t))}catch(v){l(v)}}function m(t){try{e(a.throw(t))}catch(v){l(v)}}function e(t){t.done?i(t.value):u(t.value).then(d,m)}e((a=a.apply(r,o||[])).next())})};import{seanceCardView as p,basculerPanelReserve as y,afficherDetailsFilm as _}from"./ViewReservation.js";import{dataController as n}from"./DataController.js";import{updateTableContent as S,confirmUtilisateur as h,confirmMail as C}from"./ViewReservationPlaces.js";import{showCustomAlert as b}from"./Helpers.js";import{ReservationState as f}from"./shared-models/Reservation.js";import{cancelReserveApi as g,getReservationApi as R}from"./NetworkController.js";import{login as D}from"./Login.js";export function updateDisplayReservation(){return s(this,void 0,void 0,function*(){const r=n.selectedReservationUUID;if(r)try{const o=(yield R(r))[0];n.selectedFilmUUID=o.filmId||"",n.selectedSeanceUUID=o.seanceId,console.log("Date reservation = ",o.dateJour);const c=o.dateJour?new Date(o.dateJour):new Date;n.selectedSeanceDate=c;const a=document.getElementById("seances__cardseance-selected");if(!a){console.log("Pas de carte selectionn\xE9e");return}yield n.updateSeances([n.selectedSeanceUUID]);const u=p(n.seanceSelected(),n.selectedSeanceDate,"seances__cardseance-selected");a.replaceWith(u);const i=document.querySelector(".reservation__listFilms");i&&(i.style.display="none"),_(),y(),afficherDetailsReservation(o)}catch(o){console.log(o)}})}export function afficherDetailsReservation(r){return s(this,void 0,void 0,function*(){const o=document.querySelector(".commande__tabtarif");if(!o)return;o.innerHTML="";const c=yield S("",!0,n.selectedReservationUUID);o.appendChild(c);const a=document.querySelector(".panel__choisirSeats-button");if(a.classList.add("inactif"),a.disabled=!0,r.numberPMR===void 0||r.numberPMR===0){const e=document.querySelector(".commande__pmr");e.style.display="none"}else{const e=document.querySelector(".num__add-pmr"),t=document.querySelector(".num__remove-pmr");e.style.display="none",t.style.display="none";const v=document.getElementById("num__pmr");v&&(v.textContent=String(r.numberPMR))}const u=r.seatsReserved||n.selectedListSeats||"",i=document.querySelector(".commande__seats");if(u=="")i.style.display="none";else{const e=document.getElementById("text__seats");e.textContent=u,i.style.display="flex"}const l=document.getElementById("commande__mail-p");if(l){l.textContent=`R\xE9servation prise avec le mail : ${r.email}`;const e=document.getElementById("commande__mail-input");e&&(e.style.display="none");const t=document.getElementById("commande__mail-span");t&&(t.style.display="none")}const d=document.getElementById("statutMessage"),m=document.querySelector(".panel__changer-button");if(m&&(m.textContent="Annuler la reservation",m.removeEventListener("click",e=>s(this,void 0,void 0,function*(){})),m.addEventListener("click",e=>s(this,void 0,void 0,function*(){e.preventDefault(),e.stopPropagation();const t=yield g(n.selectedReservationUUID||"");t.result==="OK"?(n.reservationState=f.PendingChoiceSeance,n.sauverComplet(),window.location.reload(),yield b("La reservation est annul\xE9e")):console.log("Resultat de l'annulation : ",t.message)}))),d){if(d.style.display="flex",n.reservationState===f.ReserveCompteToConfirm){d.innerHTML="<p>Vous devez finaliser la creation de votre compte</p>";const e=document.querySelector(".panel__jereserve-button");if(!e)return;e.classList.remove("inactif"),e.disabled=!1,e.textContent="Finaliser le compte",e.removeEventListener("click",t=>s(this,void 0,void 0,function*(){})),e.addEventListener("click",t=>s(this,void 0,void 0,function*(){t.preventDefault(),t.stopPropagation(),yield n.sauverEtatGlobal(),yield h()}))}else if(n.reservationState===f.ReserveMailToConfirm){d.innerHTML="<p>Vous devez proceder \xE0 la v\xE9rification de votre email</p>";const e=document.querySelector(".panel__jereserve-button");if(!e)return;e.classList.remove("inactif"),e.disabled=!1,e.textContent="V\xE9rifier votre email",e.removeEventListener("click",t=>s(this,void 0,void 0,function*(){})),e.addEventListener("click",t=>s(this,void 0,void 0,function*(){t.preventDefault(),t.stopPropagation(),n.sauverComplet(),yield C()}))}else if(n.reservationState===f.ReserveToConfirm){d.innerHTML="<p>Vous devez vous connecter pour confirmer la reservation</p>";const e=document.querySelector(".panel__jereserve-button");if(!e)return;e.classList.remove("inactif"),e.disabled=!1,e.textContent="Connexion",e.removeEventListener("click",t=>s(this,void 0,void 0,function*(){})),e.addEventListener("click",t=>s(this,void 0,void 0,function*(){t.preventDefault(),t.stopPropagation(),n.sauverComplet(),yield D("Veuillez vous connecter pour valider la r\xE9servation")}))}}})}export function modalConfirmUtilisateur(){return s(this,void 0,void 0,function*(){})}
